<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Delhi Water-Logging Risk Management System</title>
    
    <!-- External Libraries (keep these) -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- ADD THESE TWO LINES FOR PDF EXPORT -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    
    <!-- CSS CONTENT GOES HERE -->
    <style>
    /* PASTE YOUR ENTIRE styles.css CONTENT HERE */
    /* CSS Custom Properties for consistent spacing */
:root {
    --nav-height: 60px;
    --alert-height: 48px;
    --header-total: calc(var(--alert-height) + var(--nav-height));
    --transition-speed: 0.3s;
    --transition-easing: ease;
}

* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

body {
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
    overflow-x: hidden;
    min-height: 100vh;
}
html {
    overflow-y: scroll;
}

/* Alert Banner - COMPLETELY FIXED */
.alert-banner {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    background: linear-gradient(90deg, #dc2626, #ef4444);
    color: white;
    z-index: 10000;
    animation: slideDown 0.5s ease-out;
    box-shadow: 0 2px 10px rgba(220, 38, 38, 0.3);
    height: var(--alert-height);
    display: flex !important;
    align-items: center;
    overflow: hidden !important;
}
.alert-closed .alert-banner{
    display:none !important;
}

.alert-closed .top-nav {
    top: 0 !important;
    transition: top 0.3s ease;
}

.alert-closed .dashboard-container {
    margin-top: var(--nav-height) !important;
    height: calc(100vh - var(--nav-height)) !important;
    transition: margin-top 0.3s ease, height 0.3s ease;
}

.alert-closed .sidebar {
    top: var(--nav-height) !important;
    height: calc(100vh - var(--nav-height)) !important;
    transition: top 0.3s ease, height 0.3s ease;
}

.alert-closed .main-content {
    height: calc(100vh - var(--nav-height)) !important;
    transition: height 0.3s ease;
}

/* Smooth transitions for all affected elements */
.top-nav,
.dashboard-container,
.sidebar,
.main-content {
    transition: all 0.3s ease;
}

.alert-container {
    display: flex;
    align-items: center;
    justify-content: space-between;
    width: 100%;
    padding: 0 1rem;
}

.alert-marquee-wrapper {
    flex: 1;
    overflow: hidden !important;
    position: relative;
    height: var(--alert-height);
    display: flex;
    align-items: center;
    background: transparent;
}

.alert-marquee {
    position: absolute;
    left: 0;
    top: 0;
    width: auto !important;
    min-width: 100%;
    height: 100%;
    white-space: nowrap;
    will-change: transform;
    backface-visibility: hidden;
    transform: translateZ(0);
    -webkit-font-smoothing: antialiased;
    display: flex;
    align-items: center;
    animation: marquee 400s linear infinite !important;
    pointer-events: none;
}

.alert-track {
    display: inline-flex;
    align-items: center;
    height: 100%;
    flex-shrink: 0;
}

@keyframes marquee {
    0% {
        transform: translateX(0);
    }
    100% {
        transform: translateX(-50%);
    }
}

.alert-item {
    display: inline-flex;
    align-items: center;
    padding: 0 2.5rem;
    font-size: 0.95rem;
    height: var(--alert-height);
    line-height: 1.4;
    border-right: 1px solid rgba(255, 255, 255, 0.3);
    flex-shrink: 0;
    white-space: nowrap;
    color: white;
}

.alert-item:last-child {
    border-right: none;
}

.alert-icon {
    margin-right: 0.75rem;
    font-size: 1.1rem;
    animation: pulse 2s infinite;
    flex-shrink: 0;
    display: inline-block;
}

.alert-text {
    white-space: nowrap;
    display: inline-block;
}

.alert-close {
    background: rgba(255, 255, 255, 0.2);
    border: none;
    color: white;
    font-size: 0.9rem;
    cursor: pointer;
    padding: 0.5rem 0.8rem;
    border-radius: 4px;
    transition: all 0.3s;
    flex-shrink: 0;
    height: 32px;
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 10001;
}

.alert-close:hover {
    background: rgba(255, 255, 255, 0.3);
}

@keyframes slideDown {
    from {
        transform: translateY(-100%);
        opacity: 0;
    }
    to {
        transform: translateY(0);
        opacity: 1;
    }
}

@keyframes pulse {
    0% { transform: scale(1); }
    50% { transform: scale(1.1); }
    100% { transform: scale(1); }
}

/* Top Navigation - FIXED positioning */
.top-nav {
    background: #1e3a8a;
    color: white;
    padding: 0.75rem 1.5rem;
    display: flex;
    justify-content: space-between;
    align-items: center;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    position: fixed;
    top: var(--alert-height);
    left: 0;
    right: 0;
    z-index: 9000;
    height: var(--nav-height);
}

.nav-left {
    display: flex;
    align-items: center;
    gap: 1rem;
}

.emblem {
    width: 40px;
    height: 40px;
    background: white;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.3rem;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}

.nav-title h1 {
    font-size: 1.1rem;
    font-weight: 600;
    margin-bottom: 0.15rem;
}

.nav-title p {
    font-size: 0.7rem;
    opacity: 0.9;
}
@media (max-width: 768px) {
    .nav-title h1 {
        white-space: normal !important;
        font-size: 0.9rem !important;
        line-height: 1.2;
    }
}

.nav-right {
    display: flex;
    align-items: center;
    gap: 30px; /* Increased gap between button group and user info */
    position: relative;
}

.nav-right > div:first-child {
    display: flex;
    align-items: center;
    gap: 12px;
}

.nav-item {
    background: rgba(255,255,255,0.2);
    padding: 0.5rem 1.2rem; /* Larger horizontal padding */
    border-radius: 6px;
    font-size: 0.85rem;
    cursor: pointer;
    transition: all 0.3s;
    border: none;
    color: white;
    display: flex;
    align-items: center;
    gap: 0.6rem;
    height: 38px; /* Taller buttons */
    min-width: 90px; /* Minimum width for consistency */
    justify-content: center;
    font-weight: 500;
}

.nav-item:hover {
    background: rgba(255,255,255,0.3);
    transform: translateY(-1px);
}

.user-info {
    display: flex;
    align-items: center;
    gap: 15px;
    padding: 0.5rem 1.2rem;
    background: rgba(255,255,255,0.1);
    border-radius: 6px;
    height: 38px;
    cursor: pointer;
    transition: all 0.3s;
    position: relative;
    border: 1px solid rgba(255,255,255,0.1);
}

.user-info:hover {
    background: rgba(255,255,255,0.2);
    border-color: rgba(255,255,255,0.3);
}

.user-name {
    font-size: 0.85rem;
    font-weight: 600;
}

.user-role {
    font-size: 0.7rem;
    opacity: 0.9;
}

.nav-item:hover {
    background: rgba(255,255,255,0.3);
}

.badge {
    background: #ef4444;
    color: white;
    border-radius: 10px;
    padding: 0.1rem 0.4rem;
    font-size: 0.65rem;
    font-weight: bold;
    margin-left: 0.25rem;
}

/* User Dropdown - FIXED */
.user-dropdown {
    position: absolute;
    top: 100%;
    right: 0;
    background: white;
    border-radius: 8px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    min-width: 200px;
    z-index: 1001;
    display: none;
    overflow: hidden;
    margin-top: 5px;
}

.user-dropdown.active {
    display: block;
    animation: dropdownSlide 0.2s ease-out;
}

@keyframes dropdownSlide {
    from {
        opacity: 0;
        transform: translateY(-10px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.user-dropdown a {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    padding: 0.75rem 1rem;
    color: #475569;
    text-decoration: none;
    font-size: 0.85rem;
    transition: all 0.3s;
    border-left: 3px solid transparent;
}

.user-dropdown a:hover {
    background: #f1f5f9;
    color: #1e3a8a;
    border-left-color: #1e3a8a;
}

.user-dropdown hr {
    border: none;
    border-top: 1px solid #e2e8f0;
    margin: 0.25rem 0;
}

.user-dropdown .logout {
    color: #dc2626;
}

.user-dropdown .logout:hover {
    color: #dc2626;
    background: #fef2f2;
    border-left-color: #dc2626;
}

/* Main Layout */
.dashboard-container {
    display: flex;
    min-height: calc(100vh - var(--header-total));
    margin-top: var(--header-total);
    position: relative;
}

/* Sidebar */
.sidebar {
    width: 260px;
    background: white;
    border-right: 1px solid #e2e8f0;
    overflow-y: auto;
    padding-top: 1rem;
    position: fixed;
    top: var(--header-total);
    left: 0;
    height: calc(100vh - var(--header-total));
    z-index: 800;
    overflow-y: auto;
}

.sidebar-section {
    padding: 1rem;
    border-bottom: 1px solid #e2e8f0;
}

.sidebar-section h3 {
    font-size: 0.75rem;
    color: #64748b;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    margin-bottom: 0.75rem;
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.sidebar-menu {
    list-style: none;
}

.sidebar-menu li {
    margin-bottom: 0.25rem;
}

.menu-item {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    padding: 0.75rem 1rem;
    color: #475569;
    text-decoration: none;
    border-radius: 6px;
    transition: all 0.3s;
    cursor: pointer;
}

.menu-item:hover {
    background: #f1f5f9;
    color: #1e3a8a;
}

.menu-item.active {
    background: #eff6ff;
    color: #1e3a8a;
    font-weight: 600;
}

.menu-icon {
    font-size: 1.1rem;
    width: 20px;
    text-align: center;
}

.system-status {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
}

.status-item {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    font-size: 0.85rem;
    color: #475569;
}

.status-indicator {
    width: 8px;
    height: 8px;
    border-radius: 50%;
    display: inline-block;
}

.status-indicator.active {
    background: #10b981;
    box-shadow: 0 0 0 2px rgba(16, 185, 129, 0.2);
}

.status-indicator.warning {
    background: #f59e0b;
    box-shadow: 0 0 0 2px rgba(245, 158, 11, 0.2);
}

.status-indicator.inactive {
    background: #6b7280;
    box-shadow: 0 0 0 2px rgba(107, 114, 128, 0.2);
}

/* Main Content Area */
.main-content {
    flex: 1;
    background: #f8fafc;
    margin-left: 260px;
    min-height: calc(100vh - var(--header-total));
    padding-bottom: 50px; /* Add some bottom padding */
}

.content-header {
    background: white;
    padding: 1.25rem 1.5rem;
    border-bottom: 1px solid #e2e8f0;
    position: sticky;
    top: 0;
    z-index: 700;
}

.content-header h2 {
    color: #1e293b;
    font-size: 1.4rem;
    margin-bottom: 0.4rem;
    display: flex;
    align-items: center;
    gap: 0.75rem;
}

.content-header p {
    color: #64748b;
    font-size: 0.85rem;
    margin-left: 2.25rem;
}

.content-body {
    padding: 1.5rem;
    min-height: 600px;
}

/* Stats Cards */
.stats-grid {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 1rem;
    margin-bottom: 1.5rem;
}

.stat-card {
    background: white;
    padding: 1.25rem;
    border-radius: 8px;
    border-left: 4px solid #1e3a8a;
    box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    transition: transform 0.3s, box-shadow 0.3s;
}

.stat-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 6px rgba(0,0,0,0.1);
}

.stat-card.high { border-left-color: #dc2626; }
.stat-card.medium { border-left-color: #f59e0b; }
.stat-card.low { border-left-color: #10b981; }

.stat-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 0.75rem;
}

.stat-icon {
    font-size: 1.5rem;
    color: #64748b;
}

.stat-trend {
    font-size: 0.8rem;
    font-weight: 600;
    padding: 0.1rem 0.4rem;
    border-radius: 4px;
}

.stat-trend.up {
    background: #fecaca;
    color: #991b1b;
}

.stat-trend.down {
    background: #bbf7d0;
    color: #166534;
}

.stat-trend.stable {
    background: #fef3c7;
    color: #92400e;
}

.stat-value {
    font-size: 2rem;
    font-weight: bold;
    color: #1e293b;
    margin-bottom: 0.25rem;
}

.stat-label {
    color: #64748b;
    font-size: 0.85rem;
}

/* Map and Filters Section */
.map-section {
    display: grid;
    grid-template-columns: 1fr 320px;
    gap: 1.5rem;
    margin-bottom: 1.5rem;
}

.map-container {
    background: white;
    border-radius: 8px;
    box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    overflow: hidden;
    position: relative;
    height: 500px;
}

.map-header {
    padding: 1rem 1.25rem;
    background: #f8fafc;
    border-bottom: 1px solid #e2e8f0;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.map-header h3 {
    color: #1e293b;
    font-size: 1.1rem;
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.map-controls {
    display: flex;
    gap: 0.5rem;
}

.map-btn {
    padding: 0.4rem 0.8rem;
    border: 1px solid #cbd5e1;
    background: white;
    border-radius: 4px;
    font-size: 0.8rem;
    cursor: pointer;
    transition: all 0.3s;
    display: flex;
    align-items: center;
    gap: 0.25rem;
}

.map-btn:hover {
    background: #f1f5f9;
}

#map {
    height: 100%;
    width: 100%;
    z-index: 1;
    position: relative;
    min-height: 400px;
}
.map-container{
    position: relative;
    height: 500px;
    width: 100%;
}

/* Filters Panel */
.filters-panel {
    background: white;
    border-radius: 8px;
    box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    padding: 1.25rem;
    height: fit-content;
}

.filters-panel h3 {
    color: #1e293b;
    font-size: 1rem;
    margin-bottom: 1.25rem;
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.filter-group {
    margin-bottom: 1.5rem;
}

.filter-group label {
    display: block;
    color: #475569;
    font-size: 0.85rem;
    margin-bottom: 0.5rem;
    font-weight: 500;
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.filter-group select {
    width: 100%;
    padding: 0.6rem;
    border: 1px solid #cbd5e1;
    border-radius: 4px;
    font-size: 0.9rem;
    background: white;
    cursor: pointer;
    transition: border-color 0.3s;
}

.filter-group select:focus {
    outline: none;
    border-color: #1e3a8a;
}

.legend {
    margin-top: 1.5rem;
    padding-top: 1.5rem;
    border-top: 1px solid #e2e8f0;
}

.legend h4 {
    color: #1e293b;
    font-size: 0.9rem;
    margin-bottom: 1rem;
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.legend-item {
    display: flex;
    align-items: center;
    margin: 0.6rem 0;
    font-size: 0.85rem;
}

.legend-color {
    width: 18px;
    height: 18px;
    border-radius: 50%;
    margin-right: 0.75rem;
    border: 2px solid white;
    box-shadow: 0 2px 4px rgba(0,0,0,0.2);
}

.action-btn {
    width: 100%;
    padding: 0.75rem;
    border: none;
    border-radius: 6px;
    font-size: 0.9rem;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s;
    margin-top: 0.5rem;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.5rem;
}

.action-btn.primary {
    background: #1e3a8a;
    color: white;
}

.action-btn.primary:hover {
    background: #1e40af;
}

.action-btn.secondary {
    background: white;
    color: #1e3a8a;
    border: 1px solid #1e3a8a;
}

.action-btn.secondary:hover {
    background: #f1f5f9;
}

/* Wards List */
.wards-section {
    background: white;
    border-radius: 8px;
    box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    padding: 1.25rem;
}

.wards-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 1rem;
}

.wards-header h3 {
    color: #1e293b;
    font-size: 1.1rem;
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.ward-count {
    color: #64748b;
    font-size: 0.85rem;
}

.ward-list {
    max-height: 300px;
    overflow-y: auto;
}

.ward-item {
    padding: 1rem;
    border: 1px solid #e2e8f0;
    border-radius: 6px;
    margin-bottom: 0.75rem;
    cursor: pointer;
    transition: all 0.3s;
    background: white;
}

.ward-item:hover {
    border-color: #1e3a8a;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    transform: translateY(-1px);
}

.ward-item.active {
    border-color: #1e3a8a;
    background: #eff6ff;
    box-shadow: 0 2px 4px rgba(30, 58, 138, 0.2);
}

.ward-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 0.5rem;
}

.ward-name {
    font-weight: 600;
    color: #1e293b;
    font-size: 0.95rem;
}

.risk-badge {
    padding: 0.25rem 0.6rem;
    border-radius: 12px;
    font-size: 0.7rem;
    font-weight: 600;
    text-transform: uppercase;
}

.risk-badge.high { background: #fecaca; color: #991b1b; }
.risk-badge.medium { background: #fef08a; color: #854d0e; }
.risk-badge.low { background: #bbf7d0; color: #166534; }

.ward-stats {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 0.5rem;
    font-size: 0.75rem;
    color: #64748b;
    margin-top: 0.5rem;
}

/* Analytics Page */
.analytics-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 1.5rem;
    margin-bottom: 1.5rem;
}

.analytics-card {
    background: white;
    border-radius: 8px;
    box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    padding: 1.25rem;
    height: 350px;
    display: flex;
    flex-direction: column;
}

.analytics-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 1rem;
}

.analytics-header h3 {
    color: #1e293b;
    font-size: 1rem;
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.analytics-header select {
    padding: 0.4rem 0.75rem;
    border: 1px solid #cbd5e1;
    border-radius: 4px;
    font-size: 0.85rem;
    background: white;
    cursor: pointer;
}

.chart-container {
    flex: 1;
    position: relative;
    width: 100%;
    height: 250px;
}

.insights-section {
    background: white;
    border-radius: 8px;
    box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    padding: 1.25rem;
}

.insights-section h3 {
    color: #1e293b;
    font-size: 1.1rem;
    margin-bottom: 1rem;
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.insights-grid {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 1rem;
}

.insight-card {
    padding: 1rem;
    border-radius: 6px;
    display: flex;
    gap: 0.75rem;
    align-items: flex-start;
}

.insight-card.positive {
    background: #f0fdf4;
    border-left: 4px solid #10b981;
}

.insight-card.warning {
    background: #fef3c7;
    border-left: 4px solid #f59e0b;
}

.insight-card.info {
    background: #eff6ff;
    border-left: 4px solid #3b82f6;
}

.insight-card.negative {
    background: #fef2f2;
    border-left: 4px solid #ef4444;
}

.insight-icon {
    font-size: 1.25rem;
    margin-top: 0.25rem;
}

.insight-content h4 {
    font-size: 0.9rem;
    font-weight: 600;
    margin-bottom: 0.25rem;
    color: #1e293b;
}

.insight-content p {
    font-size: 0.8rem;
    color: #64748b;
    line-height: 1.4;
}

/* Rainfall Page - FIXED STRUCTURE */
/* Fix for rainfall alerts text */
.rainfall-alerts .alert-content {
    overflow: visible !important;
    white-space: normal !important;
    word-wrap: break-word !important;
}

.rainfall-alerts .alert-content p {
    white-space: normal !important;
    overflow: visible !important;
    text-overflow: clip !important;
    max-height: none !important;
    line-height: 1.4;
    margin-bottom: 4px !important;
}

.rainfall-alerts .alert-item {
    height: auto !important;
    min-height: 70px;
    align-items: flex-start !important;
}

/* Responsive fix for mobile */
@media (max-width: 768px) {
    .rainfall-alerts .alert-content p {
        font-size: 0.8rem;
        line-height: 1.3;
    }
    
    .rainfall-alerts .alert-item {
        padding: 10px !important;
    }
}
.rainfall-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 1.5rem;
    margin-bottom: 1.5rem;
}

.rainfall-card {
    background: white;
    border-radius: 8px;
    box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    padding: 1.25rem;
    height: 350px;
    display: flex;
    flex-direction: column;
}

.rainfall-header {
    margin-bottom: 1rem;
}

.rainfall-header h3 {
    color: #1e293b;
    font-size: 1rem;
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.rainfall-stats {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 1rem;
    margin-bottom: 1.5rem;
}

.rainfall-stat {
    background: white;
    border-radius: 8px;
    box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    padding: 1.25rem;
    display: flex;
    gap: 1rem;
    align-items: center;
}

.stat-icon {
    font-size: 2rem;
    color: #3b82f6;
}

.stat-content .stat-value {
    font-size: 1.5rem;
    font-weight: bold;
    color: #1e293b;
    margin-bottom: 0.25rem;
}

.stat-content .stat-label {
    color: #64748b;
    font-size: 0.85rem;
}

/* ===== RAINFALL ALERTS ALIGNMENT FIX ===== */
.rainfall-alerts {
    background: white;
    border-radius: 8px;
    box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    padding: 1.25rem;
    position: relative;
}

.rainfall-alerts h3 {
    color: #1e293b;
    font-size: 1.1rem;
    margin-bottom: 0.75rem !important; /* Reduced gap below heading */
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.alert-list {
    display: flex;
    flex-direction: column;
    gap: 0.85rem; /* Reduced gap between alerts */
    margin-top: -5px; /* Shift alerts up closer to heading */
    width: 100%;
}

.alert-item {
    padding: 0.85rem 1rem; /* Adjusted padding for better alignment */
    border-radius: 6px;
    display: flex;
    gap: 0.85rem; /* Reduced gap between icon and text */
    align-items: flex-start;
    transition: all 0.3s;
    /* TEXT OVERFLOW FIX */
    width: 100% !important;
    max-width: 100% !important;
    box-sizing: border-box !important;
    overflow: hidden !important;
}

.alert-item.warning {
    background: #fef3c7;
    border-left: 4px solid #f59e0b;
}

.alert-item.info {
    background: #eff6ff;
    border-left: 4px solid #3b82f6;
}

.alert-item.positive {
    background: #f0fdf4;
    border-left: 4px solid #10b981;
}

.alert-icon {
    font-size: 1.2rem; /* Slightly smaller */
    margin-top: 0.1rem; /* Better vertical alignment */
    flex-shrink: 0;
}

.alert-content {
    flex: 1;
    /* TEXT OVERFLOW FIX */
    width: 100%;
    max-width: 100%;
    box-sizing: border-box;
    overflow: hidden;
    padding-top: 0.1rem; /* Slight padding for better alignment */
}

.alert-content h4 {
    font-size: 0.9rem;
    font-weight: 600;
    margin-bottom: 0.15rem !important; /* Reduced gap between title and text */
    color: #1e293b;
    line-height: 1.3;
    /* TEXT OVERFLOW FIX */
    word-break: break-word !important;
    overflow-wrap: break-word !important;
    white-space: normal !important;
    max-width: 100% !important;
    box-sizing: border-box !important;
}

.alert-content p {
    font-size: 0.8rem;
    color: #64748b;
    margin-bottom: 0.25rem !important; /* Reduced bottom margin */
    line-height: 1.4;
    /* TEXT OVERFLOW FIX */
    word-break: break-word !important;
    overflow-wrap: break-word !important;
    white-space: normal !important;
    max-width: 100% !important;
    box-sizing: border-box !important;
}

.alert-time {
    font-size: 0.75rem;
    color: #94a3b8;
    white-space: nowrap;
}

/* Complaints Page */
.complaints-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 1.5rem;
    background: white;
    padding: 1.25rem;
    border-radius: 8px;
    box-shadow: 0 1px 3px rgba(0,0,0,0.1);
}

.complaints-stats {
    display: flex;
    gap: 1rem;
}

.stat-badge {
    padding: 0.75rem 1.25rem;
    border-radius: 6px;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 0.25rem;
    min-width: 80px;
}

.stat-badge.pending {
    background: #fef3c7;
    color: #92400e;
}

.stat-badge.in-progress {
    background: #dbeafe;
    color: #1e40af;
}

.stat-badge.resolved {
    background: #dcfce7;
    color: #166534;
}

.stat-count {
    font-size: 1.5rem;
    font-weight: bold;
}

.stat-label {
    font-size: 0.85rem;
}

.btn-primary {
    background: #1e3a8a;
    color: white;
    border: none;
    padding: 0.75rem 1.5rem;
    border-radius: 6px;
    font-size: 0.9rem;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s;
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.btn-primary:hover {
    background: #1e40af;
}

.complaints-table-container {
    background: white;
    border-radius: 8px;
    box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    margin-bottom: 1.5rem;
    overflow: hidden;
    max-height: 400px;
    overflow-y: auto;
}

.complaints-table {
    width: 100%;
    border-collapse: collapse;
}

.complaints-table thead {
    background: #f8fafc;
    position: sticky;
    top: 0;
    z-index: 10;
}

.complaints-table th {
    padding: 1rem;
    text-align: left;
    font-size: 0.85rem;
    font-weight: 600;
    color: #475569;
    border-bottom: 1px solid #e2e8f0;
}

.complaints-table td {
    padding: 1rem;
    font-size: 0.9rem;
    color: #1e293b;
    border-bottom: 1px solid #f1f5f9;
}

.complaints-table tbody tr:hover {
    background: #f8fafc;
}

.status-badge {
    padding: 0.25rem 0.75rem;
    border-radius: 12px;
    font-size: 0.75rem;
    font-weight: 600;
    text-transform: uppercase;
}

.status-pending {
    background: #fef3c7;
    color: #92400e;
}

.status-in-progress {
    background: #dbeafe;
    color: #1e40af;
}

.status-resolved {
    background: #dcfce7;
    color: #166534;
}

.priority-badge {
    padding: 0.25rem 0.75rem;
    border-radius: 12px;
    font-size: 0.75rem;
    font-weight: 600;
    text-transform: uppercase;
}

.priority-low {
    background: #f1f5f9;
    color: #64748b;
}

.priority-medium {
    background: #fef3c7;
    color: #92400e;
}

.priority-high {
    background: #fecaca;
    color: #991b1b;
}

.priority-urgent {
    background: #fecaca;
    color: #991b1b;
    animation: pulse 2s infinite;
}

.action-buttons {
    display: flex;
    gap: 0.5rem;
}

.btn-icon {
    padding: 0.5rem;
    border-radius: 4px;
    border: none;
    cursor: pointer;
    font-size: 0.8rem;
    transition: all 0.3s;
}

.btn-icon.view {
    background: #dbeafe;
    color: #1e40af;
}

.btn-icon.edit {
    background: #fef3c7;
    color: #92400e;
}

.btn-icon.delete {
    background: #fecaca;
    color: #991b1b;
}

.btn-icon:hover {
    opacity: 0.9;
    transform: translateY(-1px);
}

/* Complaints Summary Section */
.complaints-summary-section {
    display: grid;
    grid-template-columns: 2fr 1fr;
    gap: 1.5rem;
    margin-top: 1.5rem;
}

.complaints-summary {
    background: white;
    border-radius: 8px;
    box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    padding: 1.25rem;
    height: 400px;
    display: flex;
    flex-direction: column;
}

.complaints-summary h3 {
    color: #1e293b;
    font-size: 1.1rem;
    margin-bottom: 1rem;
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.summary-chart {
    flex: 1;
    position: relative;
    width: 100%;
}

.complaints-insights {
    background: white;
    border-radius: 8px;
    box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    padding: 1.25rem;
    display: flex;
    flex-direction: column;
}

.complaints-insights h3 {
    color: #1e293b;
    font-size: 1.1rem;
    margin-bottom: 1rem;
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

/* Modals */
.modal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.5);
    z-index: 2000;
    align-items: center;
    justify-content: center;
}

.modal.active {
    display: flex;
}

.modal-content {
    background: white;
    border-radius: 8px;
    box-shadow: 0 10px 25px rgba(0,0,0,0.2);
    width: 90%;
    max-width: 500px;
    max-height: 90vh;
    overflow-y: auto;
    animation: modalSlideIn 0.3s ease-out;
}

@keyframes modalSlideIn {
    from {
        opacity: 0;
        transform: translateY(-20px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.modal-header {
    padding: 1.5rem;
    border-bottom: 1px solid #e2e8f0;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.modal-header h3 {
    color: #1e293b;
    font-size: 1.25rem;
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.modal-close {
    background: none;
    border: none;
    font-size: 1.25rem;
    color: #64748b;
    cursor: pointer;
    padding: 0.5rem;
    border-radius: 4px;
    transition: all 0.3s;
}

.modal-close:hover {
    background: #f1f5f9;
    color: #1e293b;
}

.modal-body {
    padding: 1.5rem;
}

.form-group {
    margin-bottom: 1.25rem;
}

.form-row {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 1rem;
}

.form-group label {
    display: block;
    color: #475569;
    font-size: 0.85rem;
    margin-bottom: 0.5rem;
    font-weight: 500;
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.form-group input,
.form-group select,
.form-group textarea {
    width: 100%;
    padding: 0.75rem;
    border: 1px solid #cbd5e1;
    border-radius: 6px;
    font-size: 0.9rem;
    font-family: inherit;
    transition: border-color 0.3s;
}

.form-group input:focus,
.form-group select:focus,
.form-group textarea:focus {
    outline: none;
    border-color: #1e3a8a;
}

.checkbox-group {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 0.75rem;
    margin-top: 0.5rem;
}

.checkbox-group label {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    font-weight: normal;
    cursor: pointer;
}

.checkbox-group input[type="checkbox"] {
    width: auto;
}

.severity-levels {
    display: flex;
    gap: 0.75rem;
    margin-top: 0.5rem;
}

.severity-label {
    flex: 1;
    padding: 0.75rem;
    border: 2px solid #e2e8f0;
    border-radius: 6px;
    text-align: center;
    cursor: pointer;
    transition: all 0.3s;
}

.severity-label:hover {
    border-color: #cbd5e1;
}

.severity-label input[type="radio"]:checked + span {
    font-weight: 600;
}

.severity-label.low input[type="radio"]:checked + span {
    color: #10b981;
}

.severity-label.medium input[type="radio"]:checked + span {
    color: #f59e0b;
}

.severity-label.high input[type="radio"]:checked + span {
    color: #ef4444;
}

.severity-label.critical input[type="radio"]:checked + span {
    color: #dc2626;
}

.form-actions {
    display: flex;
    gap: 1rem;
    margin-top: 2rem;
    justify-content: flex-end;
}

.btn-secondary {
    background: white;
    color: #475569;
    border: 1px solid #cbd5e1;
    padding: 0.75rem 1.5rem;
    border-radius: 6px;
    font-size: 0.9rem;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s;
}

.btn-secondary:hover {
    background: #f1f5f9;
}

.btn-danger {
    background: #dc2626;
    color: white;
    border: none;
    padding: 0.75rem 1.5rem;
    border-radius: 6px;
    font-size: 0.9rem;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s;
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.btn-danger:hover {
    background: #b91c1c;
}

/* Notifications Panel */
.notifications-panel {
    position: fixed;
    top: var(--header-total, 108px); /* Starts below the blue strip */
    right: -400px;
    width: 380px;
    height: calc(100vh - var(--header-total, 108px)); /* Full height minus header */
    background: white;
    box-shadow: -2px 0 10px rgba(0,0,0,0.1);
    z-index: 2001;
    transition: right 0.3s ease-out;
    display: flex;
    flex-direction: column;
}

/* When alert is closed, adjust notifications panel */
.alert-closed .notifications-panel {
    top: var(--nav-height, 60px);
    height: calc(100vh - var(--nav-height, 60px));
}

.notifications-panel.active {
    right: 0;
}

.notifications-header {
    padding: 1.5rem;
    border-bottom: 1px solid #e2e8f0;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.notifications-header h3 {
    color: #1e293b;
    font-size: 1.25rem;
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.notifications-close {
    background: none;
    border: none;
    font-size: 1.25rem;
    color: #64748b;
    cursor: pointer;
    padding: 0.5rem;
    border-radius: 4px;
    transition: all 0.3s;
}

.notifications-close:hover {
    background: #f1f5f9;
    color: #1e293b;
}

.notifications-list {
    flex: 1;
    overflow-y: auto;
    padding: 1rem;
}

.notification-item {
    padding: 1rem;
    border-radius: 6px;
    margin-bottom: 0.75rem;
    background: #f8fafc;
    border-left: 4px solid #3b82f6;
    cursor: pointer;
    transition: all 0.3s;
}

.notification-item:hover {
    background: #f1f5f9;
    transform: translateX(-2px);
}

.notification-item.unread {
    background: white;
    border-left-color: #ef4444;
    box-shadow: 0 2px 4px rgba(239, 68, 68, 0.1);
}

.notification-header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    margin-bottom: 0.5rem;
}

.notification-title {
    font-weight: 600;
    color: #1e293b;
    font-size: 0.9rem;
}

.notification-time {
    font-size: 0.75rem;
    color: #94a3b8;
}

.notification-message {
    font-size: 0.85rem;
    color: #64748b;
    line-height: 1.4;
}

/* Content Pages */
.content-page {
    display: none;
}

.content-page.active {
    display: block;
}

/* Menu Toggle for Mobile */
.menu-toggle {
    display: none;
    background: rgba(255,255,255,0.2);
    border: none;
    color: white;
    padding: 0.5rem;
    border-radius: 4px;
    cursor: pointer;
    font-size: 1.2rem;
}

/* Custom marker styles for Leaflet */
.custom-marker {
    background: transparent !important;
    border: none !important;
}

/* Responsive */
@media (max-width: 1200px) {
    .stats-grid,
    .insights-grid,
    .rainfall-stats,
    .analytics-grid,
    .rainfall-grid,
    .complaints-summary-section {
        grid-template-columns: 1fr;
    }
    
    .map-section {
        grid-template-columns: 1fr;
    }
    
    .form-row {
        grid-template-columns: 1fr;
    }
    
    .analytics-card,
    .rainfall-card {
        height: 300px;
    }
}

@media (max-width: 992px) {
    .main-content {
        margin-left: 0;
    }
    
    .sidebar {
        left: -260px;
        transition: left 0.3s;
    }
    
    .sidebar.active {
        left: 0;
    }
    
    .menu-toggle {
        display: block;
    }
}

@media (max-width: 768px) {
    .stats-grid,
    .insights-grid,
    .rainfall-stats {
        grid-template-columns: 1fr;
    }
    
    .alert-item {
        padding: 0.75rem;
        font-size: 0.85rem;
    }
    
    .alert-icon {
        font-size: 0.9rem;
        margin-right: 0.5rem;
    }
    
    .top-nav {
        padding: 0.5rem 1rem;
    }
    
    .nav-item {
        padding: 0.3rem 0.6rem;
        font-size: 0.75rem;
    }
    
    .user-info {
        padding: 0.3rem 0.6rem;
    }
    
    .nav-title h1 {
        font-size: 1rem;
    }
    
    .user-dropdown {
        position: fixed;
        top: var(--header-total);
        right: 0;
        width: 200px;
        margin-top: 0;
    }
    
    /* Mobile text overflow fix */
    .alert-content h4 {
        font-size: 0.85rem;
        line-height: 1.2;
    }
    
    .alert-content p {
        font-size: 0.75rem;
        line-height: 1.3;
    }
}

/* TEXT OVERFLOW FIX: Additional fix for responsive design */
.rainfall-alerts {
    overflow: hidden;
}

.alert-list {
    width: 100%;
}
/* ===== ALERTS PANEL TOGGLE STYLES ===== */
.alerts-panel {
    transition: all 0.3s ease;
    max-height: 200px;
    overflow: hidden;
    display: block;
}

.alerts-panel.hidden {
    display: none !important;
    max-height: 0;
    padding: 0;
    margin: 0;
    border: none;
    opacity: 0;
    overflow: hidden;
}

.active-alert-item {
    display: flex;
    align-items: center;
    padding: 6px 8px;
    margin-bottom: 4px;
    background: white;
    border-radius: 4px;
    font-size: 0.85rem;
    border-left: 3px solid #1e3a8a;
}

.active-alert-item:last-child {
    margin-bottom: 0;
}

.alert-toggle-btn {
    background: #1e3a8a;
    color: white;
    border: none;
    padding: 4px 10px;
    border-radius: 4px;
    font-size: 0.75rem;
    cursor: pointer;
    transition: all 0.3s;
    white-space: nowrap;
}

.alert-toggle-btn:hover {
    background: #1e40af;
}

/* ===== DEVELOPER SECTION STYLES ===== */
.developer-section {
    margin-top: auto;
    padding-top: 15px;
    border-top: 1px dashed #e2e8f0;
}

.dev-btn {
    background: #f1f5f9;
    color: #475569;
    border: 1px solid #cbd5e1;
    padding: 8px 12px;
    border-radius: 4px;
    font-size: 0.8rem;
    cursor: pointer;
    transition: all 0.3s;
    display: flex;
    align-items: center;
    gap: 8px;
    width: 100%;
    text-align: left;
}

.dev-btn:hover {
    background: #e2e8f0;
    transform: translateX(2px);
}

.dev-btn i {
    width: 16px;
    text-align: center;
}

/* ===== DARK THEME CSS VARIABLES ===== */
:root {
    --nav-height: 60px;
    --header-total: calc(var(--alert-height) + var(--nav-height));
    --transition-speed: 0.3s;
    --transition-easing: ease;
    
    /* Light theme colors (default) */
    --bg-primary: #ffffff;
    --bg-secondary: #f8fafc;
    --bg-sidebar: #ffffff;
    --text-primary: #1e293b;
    --text-secondary: #475569;
    --text-muted: #64748b;
    --border-color: #e2e8f0;
    --card-bg: #ffffff;
    --sidebar-border: #e2e8f0;
    --hover-bg: #f1f5f9;
    --nav-bg: #1e3a8a;
    --input-bg: #ffffff;
    --input-border: #cbd5e1;
    --modal-bg: #ffffff;
    --table-header-bg: #f8fafc;
    --table-row-hover: #f8fafc;
}

[data-theme="dark"] {
    /* Dark theme colors - IMPROVED CONTRAST */
    --bg-primary: #0a0e1a;  /* Darker background */
    --bg-secondary: #141b2b; /* Darker secondary */
    --bg-sidebar: #141b2b;
    --text-primary: #ffffff;  /* Pure white for primary text */
    --text-secondary: #e2e8f0; /* Much lighter gray (90% white) */
    --text-muted: #b0b9cc;    /* Lighter muted text */
    --border-color: #2a3346;
    --card-bg: #1a1f2e;      /* Slightly lighter than bg for cards */
    --sidebar-border: #2a3346;
    --hover-bg: #2d3748;      /* More visible hover state */
    --nav-bg: #0a1a2f;       /* Darker navy */
    --input-bg: #1e2636;
    --input-border: #3a4556;
    --modal-bg: #1a1f2e;
    --table-header-bg: #1e2636;
    --table-row-hover: #2d3748;
}


/* ===== APPLY CSS VARIABLES TO ELEMENTS ===== */
body {
    background-color: var(--bg-primary);
    color: var(--text-primary);
}

/* Top Navigation */
.top-nav {
    background: var(--nav-bg);
}

/* Sidebar */
.sidebar {
    background: var(--bg-sidebar);
    border-right-color: var(--sidebar-border);
}

.sidebar-section {
    border-bottom-color: var(--border-color);
}

.sidebar-section h3 {
    color: var(--text-muted);
}

.menu-item {
    color: var(--text-secondary);
}

.menu-item:hover {
    background: var(--hover-bg);
    color: var(--text-primary);
}

/* Main Content */
.main-content {
    background: var(--bg-secondary);
}

.content-header {
    background: var(--bg-primary);
    border-bottom-color: var(--border-color);
}

.content-header h2 {
    color: var(--text-primary);
}

.content-header p {
    color: var(--text-muted);
}

/* Cards */
.stat-card, .analytics-card, .rainfall-card, 
.filters-panel, .wards-section, .rainfall-alerts,
.complaints-summary, .complaints-insights, 
.complaints-header, .insights-section, .complaints-table-container {
    background: var(--card-bg);
}

/* Map Container */
.map-container {
    background: var(--card-bg);
}

.map-header {
    background: var(--bg-secondary);
    border-bottom-color: var(--border-color);
}

.map-header h3 {
    color: var(--text-primary);
}

/* Form Elements */
.form-group input,
.form-group select,
.form-group textarea {
    background: var(--input-bg);
    border-color: var(--input-border);
    color: var(--text-primary);
}

.form-group label {
    color: var(--text-secondary);
}

/* Tables */
.complaints-table thead {
    background: var(--table-header-bg);
}

.complaints-table th {
    color: var(--text-secondary);
    border-bottom-color: var(--border-color);
}

.complaints-table td {
    color: var(--text-primary);
    border-bottom-color: var(--hover-bg);
}

.complaints-table tbody tr:hover {
    background: var(--table-row-hover);
}

/* Modals */
.modal-content {
    background: var(--modal-bg);
}

.modal-header {
    border-bottom-color: var(--border-color);
}

/* Developer Section in Dark Mode */
[data-theme="dark"] .dev-btn {
    background: var(--bg-secondary);
    color: var(--text-secondary);
    border-color: var(--border-color);
}

[data-theme="dark"] .dev-btn:hover {
    background: var(--hover-bg);
}

/* Alerts Panel in Dark Mode */
[data-theme="dark"] #alerts-panel {
    background: var(--bg-secondary);
    border-color: var(--border-color);
}

[data-theme="dark"] .active-alert-item {
    background: var(--bg-primary);
}

/* System Status in Dark Mode */
[data-theme="dark"] .status-item {
    color: var(--text-secondary);
}

/* Fix for dropdowns in dark mode */
.user-dropdown {
    background: var(--modal-bg);
}

.user-dropdown a {
    color: var(--text-primary);
}

.user-dropdown a:hover {
    background: var(--hover-bg);
}

/* Fix for notifications in dark mode */
.notifications-panel {
    background: var(--modal-bg);
}

.notification-item {
    background: var(--bg-secondary);
}

.notification-title {
    color: var(--text-primary);
}

.notification-message {
    color: var(--text-secondary);
}

/* Fix for map buttons in dark mode */
.map-btn {
    background: var(--card-bg);
    border-color: var(--border-color);
    color: var(--text-primary);
}

.map-btn:hover {
    background: var(--hover-bg);
}

/* Fix for select dropdowns in dark mode */
select {
    background-color: var(--input-bg);
    color: var(--text-primary);
    border-color: var(--input-border);
}

/* Fix for checkbox/radio in dark mode */
input[type="checkbox"], input[type="radio"] {
    accent-color: #1e3a8a;
}

/* Fix for horizontal rule in dark mode */
hr {
    border-color: var(--border-color);
}
/* ===== DARK MODE TEXT VISIBILITY FIXES ===== */
/* ===== DARK THEME - COMPLETE FIXED VERSION ===== */
[data-theme="dark"] {
    --bg-primary: #0a0e1a;
    --bg-secondary: #141b2b;
    --bg-sidebar: #141b2b;
    --text-primary: #ffffff;
    --text-secondary: #f1f5f9;
    --text-muted: #cbd5e1;
    --border-color: #2a3346;
    --card-bg: #1a1f2e;
    --sidebar-border: #2a3346;
    --hover-bg: #2d3748;
    --nav-bg: #0a1a2f;
    --input-bg: #1e2636;
    --input-border: #4a5568;
    --modal-bg: #1a1f2e;
    --table-header-bg: #1e2636;
    --table-row-hover: #2d3748;
}

/* ===== BACKGROUNDS ===== */
[data-theme="dark"] body,
[data-theme="dark"] .main-content,
[data-theme="dark"] .content-body,
[data-theme="dark"] .dashboard-container {
    background-color: var(--bg-secondary) !important;
}

[data-theme="dark"] .sidebar,
[data-theme="dark"] .stat-card,
[data-theme="dark"] .filters-panel,
[data-theme="dark"] .wards-section,
[data-theme="dark"] .map-container,
[data-theme="dark"] .analytics-card,
[data-theme="dark"] .rainfall-card,
[data-theme="dark"] .rainfall-alerts,
[data-theme="dark"] .complaints-header,
[data-theme="dark"] .complaints-table-container,
[data-theme="dark"] .complaints-summary,
[data-theme="dark"] .complaints-insights,
[data-theme="dark"] .insights-section,
[data-theme="dark"] .modal-content,
[data-theme="dark"] .notifications-panel {
    background-color: var(--card-bg) !important;
    border-color: var(--border-color) !important;
}

/* ===== TEXT COLORS - ALL VISIBLE ===== */
[data-theme="dark"] h1,
[data-theme="dark"] h2,
[data-theme="dark"] h3,
[data-theme="dark"] h4,
[data-theme="dark"] p,
[data-theme="dark"] span,
[data-theme="dark"] div:not(.custom-marker):not(.leaflet-popup-content-wrapper),
[data-theme="dark"] .content-header h2,
[data-theme="dark"] .content-header p,
[data-theme="dark"] .stat-value,
[data-theme="dark"] .ward-name,
[data-theme="dark"] .map-header h3,
[data-theme="dark"] .filters-panel h3,
[data-theme="dark"] .wards-header h3,
[data-theme="dark"] .legend h4,
[data-theme="dark"] .analytics-header h3,
[data-theme="dark"] .rainfall-header h3,
[data-theme="dark"] .complaints-summary h3,
[data-theme="dark"] .complaints-insights h3,
[data-theme="dark"] .insights-section h3,
[data-theme="dark"] .modal-header h3 {
    color: #ffffff !important;
}

/* ===== SECONDARY TEXT ===== */
[data-theme="dark"] .stat-label,
[data-theme="dark"] .ward-stats div,
[data-theme="dark"] .filter-group label,
[data-theme="dark"] .legend-item span,
[data-theme="dark"] .ward-count,
[data-theme="dark"] .sidebar-section h3,
[data-theme="dark"] .status-item,
[data-theme="dark"] .alert-time,
[data-theme="dark"] .notification-time,
[data-theme="dark"] .form-group label {
    color: #e2e8f0 !important;
}

/* ===== MENU ITEMS ===== */
[data-theme="dark"] .menu-item {
    color: #e2e8f0 !important;
}

[data-theme="dark"] .menu-item:hover {
    background: var(--hover-bg) !important;
    color: #ffffff !important;
}

[data-theme="dark"] .menu-item.active {
    background: #1e3a8a !important;
    color: #ffffff !important;
}

/* ===== FORM ELEMENTS ===== */
[data-theme="dark"] select,
[data-theme="dark"] input,
[data-theme="dark"] textarea,
[data-theme="dark"] .filter-group select,
[data-theme="dark"] #riskFilter,
[data-theme="dark"] #zoneFilter,
[data-theme="dark"] #rainfallFilter,
[data-theme="dark"] #drainageFilter {
    background-color: var(--input-bg) !important;
    color: #ffffff !important;
    border-color: var(--input-border) !important;
}

[data-theme="dark"] select option {
    background-color: var(--card-bg) !important;
    color: #ffffff !important;
}

/* ===== BUTTONS ===== */
[data-theme="dark"] .map-btn,
[data-theme="dark"] .action-btn.secondary,
[data-theme="dark"] .btn-secondary {
    background: #2d3748 !important;
    color: #ffffff !important;
    border-color: #4a5568 !important;
}

[data-theme="dark"] .map-btn:hover,
[data-theme="dark"] .action-btn.secondary:hover,
[data-theme="dark"] .btn-secondary:hover {
    background: #3a4556 !important;
}

[data-theme="dark"] .action-btn.primary,
[data-theme="dark"] .btn-primary {
    background: #1e3a8a !important;
    color: #ffffff !important;
}

/* ===== WARD ITEMS ===== */
[data-theme="dark"] .ward-item {
    background: var(--card-bg) !important;
    border-color: var(--border-color) !important;
}

[data-theme="dark"] .ward-item:hover {
    border-color: #1e3a8a !important;
    background: var(--hover-bg) !important;
}

[data-theme="dark"] .ward-item.active {
    background: #1e3a8a !important;
    border-color: #1e3a8a !important;
}

[data-theme="dark"] .ward-item.active .ward-name,
[data-theme="dark"] .ward-item.active .ward-stats div {
    color: #ffffff !important;
}

/* ===== TABLES ===== */
[data-theme="dark"] .complaints-table thead {
    background: var(--table-header-bg) !important;
}

[data-theme="dark"] .complaints-table th {
    color: #ffffff !important;
    border-bottom-color: var(--border-color) !important;
}

[data-theme="dark"] .complaints-table td {
    color: #e2e8f0 !important;
    border-bottom-color: var(--border-color) !important;
}

[data-theme="dark"] .complaints-table tbody tr:hover {
    background: var(--table-row-hover) !important;
}

/* ===== NOTIFICATIONS ===== */
[data-theme="dark"] .notification-item {
    background: var(--bg-secondary) !important;
    border-left-color: #3b82f6 !important;
}

[data-theme="dark"] .notification-title {
    color: #ffffff !important;
}

[data-theme="dark"] .notification-message {
    color: #e2e8f0 !important;
}

/* ===== MODALS ===== */
[data-theme="dark"] .modal-header {
    border-bottom-color: var(--border-color) !important;
}

[data-theme="dark"] .modal-close {
    color: #e2e8f0 !important;
}

[data-theme="dark"] .modal-close:hover {
    background: var(--hover-bg) !important;
    color: #ffffff !important;
}

/* ===== RISK BADGES ===== */
[data-theme="dark"] .risk-badge.high {
    background: #991b1b !important;
    color: #ffffff !important;
}

[data-theme="dark"] .risk-badge.medium {
    background: #854d0e !important;
    color: #ffffff !important;
}

[data-theme="dark"] .risk-badge.low {
    background: #166534 !important;
    color: #ffffff !important;
}

/* ===== STATUS BADGES ===== */
[data-theme="dark"] .status-pending {
    background: #92400e !important;
    color: #ffffff !important;
}

[data-theme="dark"] .status-in-progress {
    background: #1e40af !important;
    color: #ffffff !important;
}

[data-theme="dark"] .status-resolved {
    background: #166534 !important;
    color: #ffffff !important;
}

/* ===== MAP POPUP ===== */
[data-theme="dark"] .leaflet-popup-content-wrapper,
[data-theme="dark"] .leaflet-popup-tip {
    background: var(--card-bg) !important;
    color: #ffffff !important;
}

[data-theme="dark"] .leaflet-popup-content {
    color: #ffffff !important;
}

[data-theme="dark"] .leaflet-container a.leaflet-popup-close-button {
    color: #e2e8f0 !important;
}

[data-theme="dark"] .leaflet-container a.leaflet-popup-close-button:hover {
    color: #ffffff !important;
}

/* ===== DARK THEME - ML RISK FACTOR BOX (WITH CLASS) ===== */
[data-theme="dark"] .leaflet-popup-content .ml-risk-factor-box {
    background: #1e2636 !important;
    border: 1px solid #4a5568 !important;
}

[data-theme="dark"] .leaflet-popup-content .ml-risk-factor-box strong {
    color: #ffffff !important;
}

[data-theme="dark"] .leaflet-popup-content .ml-risk-factor-box div {
    color: #ffffff !important;
}

[data-theme="dark"] .leaflet-popup-content .ml-risk-factor-box span {
    color: #e2e8f0 !important;
}

[data-theme="dark"] .leaflet-popup-content .ml-risk-factor-box strong {
    color: #ffffff !important;
}

/* ===== ALERTS PANEL ===== */
[data-theme="dark"] #alerts-panel {
    background: var(--bg-secondary) !important;
    border-color: var(--border-color) !important;
}

[data-theme="dark"] .active-alert-item {
    background: var(--card-bg) !important;
    color: #e2e8f0 !important;
}

/* ===== USER DROPDOWN ===== */
[data-theme="dark"] .user-dropdown {
    background: var(--card-bg) !important;
}

[data-theme="dark"] .user-dropdown a {
    color: #e2e8f0 !important;
}

[data-theme="dark"] .user-dropdown a:hover {
    background: var(--hover-bg) !important;
    color: #ffffff !important;
}

[data-theme="dark"] .user-dropdown hr {
    border-color: var(--border-color) !important;
}

[data-theme="dark"] .user-dropdown .logout {
    color: #fecaca !important;
}

[data-theme="dark"] .user-dropdown .logout:hover {
    color: #ffffff !important;
    background: #991b1b !important;
}
/* ===== DARK THEME - COMPLAINTS PAGE FIXES ===== */
[data-theme="dark"] .complaints-header,
[data-theme="dark"] .complaints-table-container,
[data-theme="dark"] .complaints-summary,
[data-theme="dark"] .complaints-insights {
    background-color: var(--card-bg) !important;
    color: #ffffff !important;
}

[data-theme="dark"] .complaints-header h2,
[data-theme="dark"] .complaints-header h3,
[data-theme="dark"] .complaints-summary h3,
[data-theme="dark"] .complaints-insights h3 {
    color: #ffffff !important;
}

[data-theme="dark"] .stat-badge.pending,
[data-theme="dark"] .stat-badge.in-progress,
[data-theme="dark"] .stat-badge.resolved {
    color: #ffffff !important;
}

[data-theme="dark"] .stat-badge.pending {
    background: #92400e !important;
}

[data-theme="dark"] .stat-badge.in-progress {
    background: #1e40af !important;
}

[data-theme="dark"] .stat-badge.resolved {
    background: #166534 !important;
}

[data-theme="dark"] .stat-count,
[data-theme="dark"] .stat-badge .stat-label {
    color: #ffffff !important;
}

[data-theme="dark"] .btn-primary {
    background: #1e3a8a !important;
    color: #ffffff !important;
}

[data-theme="dark"] .btn-primary:hover {
    background: #2563eb !important;
}

[data-theme="dark"] .complaints-table th {
    background: #1e2636 !important;
    color: #ffffff !important;
}

[data-theme="dark"] .complaints-table td {
    color: #e2e8f0 !important;
}

[data-theme="dark"] .status-pending {
    background: #92400e !important;
    color: #ffffff !important;
}

[data-theme="dark"] .status-in-progress {
    background: #1e40af !important;
    color: #ffffff !important;
}

[data-theme="dark"] .status-resolved {
    background: #166534 !important;
    color: #ffffff !important;
}

[data-theme="dark"] .priority-low {
    background: #4b5563 !important;
    color: #ffffff !important;
}

[data-theme="dark"] .priority-medium {
    background: #92400e !important;
    color: #ffffff !important;
}

[data-theme="dark"] .priority-high,
[data-theme="dark"] .priority-urgent {
    background: #991b1b !important;
    color: #ffffff !important;
}

[data-theme="dark"] .btn-icon.view {
    background: #1e40af !important;
    color: #ffffff !important;
}

[data-theme="dark"] .btn-icon.edit {
    background: #92400e !important;
    color: #ffffff !important;
}

[data-theme="dark"] .btn-icon.delete {
    background: #991b1b !important;
    color: #ffffff !important;
}

[data-theme="dark"] .insight-card.info {
    background: #1e3a8a !important;
    color: #ffffff !important;
}

[data-theme="dark"] .insight-card.positive {
    background: #166534 !important;
    color: #ffffff !important;
}

[data-theme="dark"] .insight-card.warning {
    background: #854d0e !important;
    color: #ffffff !important;
}

[data-theme="dark"] .insight-card.negative {
    background: #991b1b !important;
    color: #ffffff !important;
}

[data-theme="dark"] .insight-content h4,
[data-theme="dark"] .insight-content p {
    color: #ffffff !important;
}
/* ===== DARK THEME - DASHBOARD PAGE FIXES ===== */
[data-theme="dark"] .stats-grid .stat-card {
    background: var(--card-bg) !important;
    border-left-color: var(--border-color) !important;
}

[data-theme="dark"] .stat-card.high {
    border-left-color: #dc2626 !important;
}

[data-theme="dark"] .stat-card.medium {
    border-left-color: #f59e0b !important;
}

[data-theme="dark"] .stat-card.low {
    border-left-color: #10b981 !important;
}

[data-theme="dark"] .stat-icon {
    color: #e2e8f0 !important;
}

[data-theme="dark"] .stat-trend {
    color: #ffffff !important;
}

[data-theme="dark"] .stat-trend.up {
    background: #991b1b !important;
    color: #ffffff !important;
}

[data-theme="dark"] .stat-trend.down {
    background: #166534 !important;
    color: #ffffff !important;
}

[data-theme="dark"] .stat-trend.stable {
    background: #854d0e !important;
    color: #ffffff !important;
}

[data-theme="dark"] .map-header {
    background: var(--bg-secondary) !important;
    border-bottom-color: var(--border-color) !important;
}

[data-theme="dark"] .map-header h3 {
    color: #ffffff !important;
}

[data-theme="dark"] .legend {
    border-top-color: var(--border-color) !important;
}

[data-theme="dark"] .legend h4 {
    color: #ffffff !important;
}

[data-theme="dark"] .legend-item span {
    color: #e2e8f0 !important;
}

/* ===== DARK THEME - RAINFALL PAGE FIXES ===== */
[data-theme="dark"] .rainfall-stat {
    background: var(--card-bg) !important;
}

[data-theme="dark"] .rainfall-stat .stat-icon {
    color: #60a5fa !important;
}

[data-theme="dark"] .rainfall-stat .stat-value {
    color: #ffffff !important;
}

[data-theme="dark"] .rainfall-stat .stat-label {
    color: #e2e8f0 !important;
}

[data-theme="dark"] .rainfall-card {
    background: var(--card-bg) !important;
}

[data-theme="dark"] .rainfall-header h3 {
    color: #ffffff !important;
}

[data-theme="dark"] .rainfall-alerts {
    background: var(--card-bg) !important;
}

[data-theme="dark"] .rainfall-alerts h3 {
    color: #ffffff !important;
}

[data-theme="dark"] .alert-item.warning {
    background: #854d0e !important;
    border-left-color: #f59e0b !important;
}

[data-theme="dark"] .alert-item.info {
    background: #1e40af !important;
    border-left-color: #3b82f6 !important;
}

[data-theme="dark"] .alert-item.positive {
    background: #166534 !important;
    border-left-color: #10b981 !important;
}

[data-theme="dark"] .alert-item h4,
[data-theme="dark"] .alert-item p,
[data-theme="dark"] .alert-item .alert-time {
    color: #ffffff !important;
}

[data-theme="dark"] .alert-icon {
    color: #ffffff !important;
}

/* ===== DARK THEME - ANALYTICS PAGE FIXES ===== */
[data-theme="dark"] .analytics-card {
    background: var(--card-bg) !important;
}

[data-theme="dark"] .analytics-header h3 {
    color: #ffffff !important;
}

[data-theme="dark"] .analytics-header select {
    background: var(--input-bg) !important;
    color: #ffffff !important;
    border-color: var(--input-border) !important;
}

[data-theme="dark"] .insights-section {
    background: var(--card-bg) !important;
}

[data-theme="dark"] .insights-section h3 {
    color: #ffffff !important;
}

[data-theme="dark"] .insight-card.positive {
    background: #166534 !important;
    border-left-color: #10b981 !important;
}

[data-theme="dark"] .insight-card.warning {
    background: #854d0e !important;
    border-left-color: #f59e0b !important;
}

[data-theme="dark"] .insight-card.info {
    background: #1e40af !important;
    border-left-color: #3b82f6 !important;
}

[data-theme="dark"] .insight-card.negative {
    background: #991b1b !important;
    border-left-color: #ef4444 !important;
}

[data-theme="dark"] .insight-content h4,
[data-theme="dark"] .insight-content p {
    color: #ffffff !important;
}

[data-theme="dark"] .insight-icon {
    color: #ffffff !important;
}

/* ===== DARK THEME - SYSTEM STATUS & SIDEBAR FIXES ===== */
[data-theme="dark"] .system-status {
    background: var(--card-bg) !important;
}

[data-theme="dark"] .status-item {
    color: #e2e8f0 !important;
}

[data-theme="dark"] .status-indicator.active {
    background: #10b981 !important;
    box-shadow: 0 0 0 2px rgba(16, 185, 129, 0.3) !important;
}

[data-theme="dark"] .status-indicator.warning {
    background: #f59e0b !important;
    box-shadow: 0 0 0 2px rgba(245, 158, 11, 0.3) !important;
}

[data-theme="dark"] .status-indicator.inactive {
    background: #6b7280 !important;
    box-shadow: 0 0 0 2px rgba(107, 114, 128, 0.3) !important;
}

[data-theme="dark"] .developer-section {
    border-top-color: var(--border-color) !important;
}

[data-theme="dark"] .dev-btn {
    background: var(--bg-secondary) !important;
    color: #e2e8f0 !important;
    border-color: var(--border-color) !important;
}

[data-theme="dark"] .dev-btn:hover {
    background: var(--hover-bg) !important;
    color: #ffffff !important;
}

/* ===== DARK THEME - MODALS & FORMS FIXES ===== */
[data-theme="dark"] .modal-content {
    background: var(--card-bg) !important;
}

[data-theme="dark"] .modal-header {
    border-bottom-color: var(--border-color) !important;
}

[data-theme="dark"] .modal-header h3 {
    color: #ffffff !important;
}

[data-theme="dark"] .modal-close {
    color: #e2e8f0 !important;
}

[data-theme="dark"] .modal-close:hover {
    background: var(--hover-bg) !important;
    color: #ffffff !important;
}

[data-theme="dark"] .severity-label {
    border-color: var(--border-color) !important;
    color: #e2e8f0 !important;
}

[data-theme="dark"] .severity-label:hover {
    border-color: var(--input-border) !important;
}

[data-theme="dark"] .checkbox-group label {
    color: #e2e8f0 !important;
}
.notifications-close {
    cursor: pointer;
    z-index: 2002;
}

.notifications-panel.active {
    right: 0 !important;
}
/* ===== DARK THEME - MAP POPUP TEXT FIXES ===== */
/* ===== FIX MAP CONTROLS IN DARK THEME ===== */
[data-theme="dark"] .leaflet-control-zoom a,
[data-theme="dark"] .leaflet-control-zoom a:hover {
    background-color: #2d3748 !important;
    color: white !important;
    border-color: #4a5568 !important;
}

[data-theme="dark"] .leaflet-control-zoom {
    border: 1px solid #4a5568 !important;
}

[data-theme="dark"] .leaflet-control-attribution {
    background-color: rgba(26, 31, 46, 0.8) !important;
    color: #cbd5e1 !important;
}

[data-theme="dark"] .leaflet-popup-content-wrapper {
    background: #1a1f2e !important;
    color: #ffffff !important;
    border-radius: 8px !important;
    box-shadow: 0 4px 20px rgba(0,0,0,0.5) !important;
}

[data-theme="dark"] .leaflet-popup-content {
    color: #ffffff !important;
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif !important;
}

[data-theme="dark"] .leaflet-popup-content h3 {
    color: #ffffff !important;
    border-bottom-color: #4a5568 !important;
}

[data-theme="dark"] .leaflet-popup-content div,
[data-theme="dark"] .leaflet-popup-content span,
[data-theme="dark"] .leaflet-popup-content strong,
[data-theme="dark"] .leaflet-popup-content td {
    color: #e2e8f0 !important;
}

[data-theme="dark"] .leaflet-popup-content table tr td {
    color: #e2e8f0 !important;
    border-bottom-color: #2a3346 !important;
}

[data-theme="dark"] .leaflet-popup-content .ml-risk-factor {
    background: #1e2636 !important;
    color: #ffffff !important;
    border: 1px solid #4a5568 !important;
}
[data-theme="dark"] .leaflet-popup-content .ml-risk-factor div,
[data-theme="dark"] .leaflet-popup-content .ml-risk-factor span,
[data-theme="dark"] .leaflet-popup-content .ml-risk-factor strong {
    color: #ffffff !important;
}

[data-theme="dark"] .leaflet-popup-content .ml-risk-factor span:first-child {
    color: #e2e8f0 !important;  /* For the labels like "Rainfall Impact:" */
}

[data-theme="dark"] .leaflet-popup-content .ml-risk-factor strong {
    color: #ffffff !important;
    font-weight: 600;
}

[data-theme="dark"] .leaflet-popup-content .ml-recommendations {
    background: #0a0e1a !important;
    color: #ffffff !important;
    border-left-color: currentColor !important;
}

[data-theme="dark"] .leaflet-popup-content .ml-footer {
    background: #1e3a8a !important;
    color: #ffffff !important;
}

[data-theme="dark"] .leaflet-popup-tip {
    background: #1a1f2e !important;
}

[data-theme="dark"] .leaflet-container a.leaflet-popup-close-button {
    color: #e2e8f0 !important;
    font-size: 20px !important;
    font-weight: bold !important;
    padding: 8px 8px 0 0 !important;
}

[data-theme="dark"] .leaflet-container a.leaflet-popup-close-button:hover {
    color: #ffffff !important;
    background: transparent !important;
}

/* Risk score colors in dark mode */
[data-theme="dark"] .leaflet-popup-content .risk-high {
    color: #fecaca !important;
}

[data-theme="dark"] .leaflet-popup-content .risk-medium {
    color: #fef08a !important;
}

[data-theme="dark"] .leaflet-popup-content .risk-low {
    color: #bbf7d0 !important;
}

/* Simple popup styles - no !important conflicts */
.leaflet-popup-content-wrapper {
    border-radius: 8px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
}

.leaflet-popup-close-button {
    color: #64748b;
    font-size: 18px;
    padding: 6px 8px 0 0;
}

.leaflet-popup-close-button:hover {
    color: #1e293b;
    background: rgba(0,0,0,0.05);
    border-radius: 4px;
    text-decoration: none;
}

/* Dark theme */
[data-theme="dark"] .leaflet-popup-close-button {
    color: #cbd5e1;
}

[data-theme="dark"] .leaflet-popup-close-button:hover {
    color: #ffffff;
    background: rgba(255,255,255,0.1);
}

    </style>
</head>
<body>
    <!-- YOUR HTML CONTENT GOES HERE -->
   
    <!-- Alert Banner - COMPLETELY FIXED -->
    <div class="alert-banner">
        <div class="alert-container">
            <div class="alert-marquee-wrapper">
                <div class="alert-marquee">
                    <div class="alert-track" id="alertTrack">
                        <!-- Alerts will be loaded here -->
                    </div>
                </div>
            </div>
            <button class="alert-close" onclick="closeAlert()"></button>
        </div>
    </div>

    <!-- Top Navigation -->
    <nav class="top-nav">
        <div class="nav-left">
            <button class="menu-toggle" onclick="toggleSidebar()">
                
            </button>
            <div class="emblem">
                
            </div>
            <div class="nav-title">
             <h1 style="font-size: 1.1rem; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">Delhi Water-Logging Risk Management System</h1>
             <div style="display: flex; align-items: center; gap: 8px; flex-wrap: wrap;">
              <p style="font-size: 0.7rem; opacity: 0.9; margin: 0;">Government of NCT of Delhi  Delhi Municipal Corporation</p>
            <span style="background: rgba(255,255,255,0.3); padding: 2px 8px; border-radius: 12px; font-size: 0.65rem; font-weight: 600; white-space: nowrap;">
                 Coverage: Entire Delhi NCT (272 Wards)
            </span>
        </div>
    </div>
        
      <div class="nav-right">
    <div style="display: flex; align-items: center; gap: 15px; margin-right: 25px;">
        <button class="nav-item" onclick="refreshData()">
            <i class="fas fa-sync-alt"></i> Refresh
        </button>
        <button class="nav-item" onclick="showNotifications()">
            <i class="fas fa-bell"></i> Notifications <span class="badge">3</span>
        </button>
        <button class="nav-item" onclick="exportDashboard()">
            <i class="fas fa-download"></i> Export
        </button>
        
        <!-- THEME TOGGLE - NOW VISIBLE ON ALL PAGES -->
        <button class="nav-item" id="theme-toggle" title="Toggle dark/light theme">
            <i class="fas fa-moon"></i> Theme
        </button>
    </div>
    
    <div class="user-info" onclick="toggleUserDropdown()">
        <div>
            <div class="user-name">Dr. Rajesh Kumar</div>
            <div class="user-role">Administrator</div>
        </div>
        <i class="fas fa-chevron-down" style="margin-left: 10px;"></i>
    </div>
    <div class="user-dropdown" id="userDropdown">
        <a href="javascript:void(0);" onclick="openUserProfile(); return false;"><i class="fas fa-user"></i> Profile</a>
        <a href="javascript:void(0);" onclick="openPreferences(); return false;"><i class="fas fa-cog"></i> Settings</a>
        <a href="javascript:void(0);" onclick="openUserManagement(); return false;"><i class="fas fa-users"></i> User Management</a>
        <hr>
        <a href="javascript:void(0);" onclick="logout(); return false;" class="logout"><i class="fas fa-sign-out-alt"></i> Logout</a>
    </div>
</div>  
    </nav>

    <!-- Dashboard Container -->
    <div class="dashboard-container">
        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-section">
                <h3><i class="fas fa-tachometer-alt"></i> Dashboard</h3>
                <ul class="sidebar-menu">
                    <li>
                        <a class="menu-item active" onclick="showPage('risk-map',event)">
                            <span class="menu-icon"></span>
                            <span>Risk Map Overview</span>
                        </a>
                    </li>
                    <li>
                        <a class="menu-item" onclick="showPage('analytics',event)">
                            <span class="menu-icon"></span>
                            <span>Analytics & Trends</span>
                        </a>
                    </li>
                    <li>
                        <a class="menu-item" onclick="showPage('rainfall',event)">
                            <span class="menu-icon"></span>
                            <span>Rainfall Monitoring</span>
                        </a>
                    </li>
                    <li>
                        <a class="menu-item" onclick="showPage('complaints',event)">
                            <span class="menu-icon"></span>
                            <span>Complaints Management</span>
                        </a>
                    </li>
                </ul>

        <div class="sidebar-section">
    <h3><i class="fas fa-cogs"></i> System Status</h3>
    <div class="system-status">
        <div class="status-item">
            <span class="status-indicator active"></span>
            <span>IMD Data Feed</span>
        </div>
        <div class="status-item">
            <span class="status-indicator active"></span>
            <span>Drainage Sensors</span>
        </div>
        <div class="status-item">
            <span class="status-indicator warning"></span>
            <span>Camera Network (85%)</span>
        </div>
        <div class="status-item">
            <span class="status-indicator active"></span>
            <div style="display: flex; align-items: center; justify-content: space-between; width: 100%;">
                <span>Alert System</span>
                <button id="alert-toggle" class="alert-toggle-btn" style="background: #1e3a8a; color: white; border: none; padding: 2px 8px; border-radius: 3px; font-size: 0.7rem; cursor: pointer; margin-left: 10px;">
                    Hide Alerts
                </button>
            </div>
        </div>
    </div>
    <!-- Add this alerts panel -->
    <div id="alerts-panel" class="alerts-panel" style="margin-top: 10px; padding: 10px; background: #f8fafc; border-radius: 6px; border: 1px solid #e2e8f0; display: block;">
        <div class="active-alerts-list">
            <div class="active-alert-item">
                <span style="color: #dc2626;"></span>
                <span style="margin-left: 8px; font-size: 0.85rem;">Flood Alert in Ward 001</span>
            </div>
            <div class="active-alert-item">
                <span style="color: #f59e0b;"></span>
                <span style="margin-left: 8px; font-size: 0.85rem;">Drainage Block in Ward 003</span>
            </div>
            <div class="active-alert-item">
                <span style="color: #3b82f6;"></span>
                <span style="margin-left: 8px; font-size: 0.85rem;">ML Model Updated (v2.1)</span>
             </div>
          </div>
        </div>
    </div>  
            <div class="sidebar-section">
              <h3><i class="fas fa-plus-circle"></i> Quick Actions</h3>
              <div style="display: flex; flex-direction: column; gap: 0.5rem;">
                <button class="action-btn primary" onclick="openAddHotspotModal()">
                    <i class="fas fa-plus"></i> Add Hotspot
                </button>
                <button class="action-btn secondary" onclick="openEmergencyAlertModal()">
                   <i class="fas fa-bell"></i> Emergency Alert
                </button>
                <button class="action-btn primary" onclick="generateReport()">
                    <i class="fas fa-file-pdf"></i> Generate Report
                </button>
             </div>

            </div>
            <div class="developer-section" style="margin-top: 20px; padding-top: 15px; border-top: 1px dashed #e2e8f0;">
              <h3 style="font-size: 0.75rem; color: #64748b; margin-bottom: 10px;">
              <i class="fas fa-code"></i> DEVELOPER TOOLS
              </h3>
              <button class="dev-btn" onclick="debugMLData()" style="margin-bottom: 8px;">
              <i class="fas fa-bug"></i> Debug ML Data
              </button>
              <button class="dev-btn" onclick="verifyAllWardsOnMap()" style="margin-bottom: 8px;">
              <i class="fas fa-map-marked-alt"></i> Verify Map Wards
              </button>
              <button class="dev-btn" onclick="console.log('Markers:', markers.length, 'Wards:', allWards.length); alert(`Markers: ${markers.length}\nWards: ${allWards.length}`);">
               <i class="fas fa-chart-bar"></i> Count Markers
               </button>
               <!-- ADD THIS NEW BUTTON -->
              <button class="dev-btn" onclick="showAllWards()">
              <i class="fas fa-list"></i> Show All Wards
              </button>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Risk Map Page -->
            <div class="content-page active" id="risk-map">
                <div class="content-header">
                    <h2><i class="fas fa-map-marked-alt"></i> Delhi Water-Logging Risk Map</h2>
                    <p>Real-time monitoring of 272 wards  Updated: 15 Jan 2024, 14:30 IST</p>
                </div>
                
                <div class="content-body">
                    <!-- Stats Cards -->
                    <div class="stats-grid">
                        <div class="stat-card high">
                            <div class="stat-header">
                                <div class="stat-icon"></div>
                                <div class="stat-trend up">+3 today</div>
                            </div>
                            <div class="stat-value" id="highRiskCount">0</div>
                            <div class="stat-label">High Risk Wards</div>
                        </div>
                        
                        <div class="stat-card medium">
                            <div class="stat-header">
                                <div class="stat-icon"></div>
                                <div class="stat-trend stable">Stable</div>
                            </div>
                            <div class="stat-value" id="mediumRiskCount">0</div>
                            <div class="stat-label">Medium Risk Wards</div>
                        </div>
                        
                        <div class="stat-card low">
                            <div class="stat-header">
                                <div class="stat-icon"></div>
                                <div class="stat-trend down">-2 today</div>
                            </div>
                            <div class="stat-value" id="lowRiskCount">0</div>
                            <div class="stat-label">Low Risk Wards</div>
                        </div>
                        
                        <div class="stat-card">
                            <div class="stat-header">
                                <div class="stat-icon"></div>
                                <div class="stat-trend up">+1%</div>
                            </div>
                            <div class="stat-value" id="totalWards">272</div>
                            <div class="stat-label">Total Wards Monitored</div>
                        </div>
                    </div>

                    <!-- Map and Filters Section -->
                    <div class="map-section">
                        <div class="map-container">
                            <div class="map-header">
                                <h3><i class="fas fa-map"></i> Delhi Ward Risk Map</h3>
                                <div class="map-controls">
                                    <button class="map-btn" onclick="resetMapView()">
                                        <i class="fas fa-home"></i> Reset View
                                    </button>
                                    <button class="map-btn" onclick="exportMap()">
                                        <i class="fas fa-download"></i> Export
                                    </button>
                                </div>
                            </div>
                            <div id="map"></div>
                        </div>

                        <!-- Filters Panel -->
                        <div class="filters-panel">
                            <h3><i class="fas fa-filter"></i> Filter Wards</h3>
                            
                            <div class="filter-group">
                                <label for="riskFilter"><i class="fas fa-exclamation-triangle"></i> Risk Level</label>
                                <select id="riskFilter" onchange="applyFilters()">
                                    <option value="all">All Risk Levels</option>
                                    <option value="high">High Risk</option>
                                    <option value="medium">Medium Risk</option>
                                    <option value="low">Low Risk</option>
                                </select>
                            </div>
                            
                            <div class="filter-group">
                                <label for="zoneFilter"><i class="fas fa-layer-group"></i> Zone</label>
                                <select id="zoneFilter" onchange="applyFilters()">
                                    <option value="all">All Zones</option>
                                    <option value="north">North Delhi</option>
                                    <option value="south">South Delhi</option>
                                    <option value="east">East Delhi</option>
                                    <option value="west">West Delhi</option>
                                    <option value="central">Central Delhi</option>
                                    <option value="new-delhi">New Delhi</option>
                                </select>
                            </div>
                            
                            <div class="filter-group">
                                <label for="rainfallFilter"><i class="fas fa-cloud-rain"></i> Annual Rainfall</label>
                                <select id="rainfallFilter" onchange="applyFilters()">
                                    <option value="all">All Rainfall Levels</option>
                                    <option value="very-high">Very High (>1400mm)</option>
                                    <option value="high">High (1200-1400mm)</option>
                                    <option value="moderate">Moderate (800-1200mm)</option>
                                    <option value="low">Low (<800mm)</option>
                                </select>
                            </div>
                            
                            <div class="filter-group">
                                <label for="drainageFilter"><i class="fas fa-water"></i> Drainage Score</label>
                                <select id="drainageFilter" onchange="applyFilters()">
                                    <option value="all">All Scores</option>
                                    <option value="excellent">Excellent (8-10)</option>
                                    <option value="good">Good (6-8)</option>
                                    <option value="fair">Fair (4-6)</option>
                                    <option value="poor">Poor (<4)</option>
                                </select>
                            </div>
                            
                            <button class="action-btn primary" onclick="applyFilters()">
                                <i class="fas fa-search"></i> Apply Filters
                            </button>
                            <button class="action-btn secondary" onclick="resetFilters()">
                                <i class="fas fa-redo"></i> Reset Filters
                            </button>
                            
                            <div class="legend">
                                <h4><i class="fas fa-key"></i> Risk Legend</h4>
                                <div class="legend-item">
                                    <div class="legend-color" style="background-color: #dc2626;"></div>
                                    <span>High Risk</span>
                                </div>
                                <div class="legend-item">
                                    <div class="legend-color" style="background-color: #f59e0b;"></div>
                                    <span>Medium Risk</span>
                                </div>
                                <div class="legend-item">
                                    <div class="legend-color" style="background-color: #10b981;"></div>
                                    <span>Low Risk</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Wards List -->
                    <div class="wards-section">
                        <div class="wards-header">
                            <h3><i class="fas fa-list"></i> Filtered Wards</h3>
                            <div class="ward-count" id="wardCount">0 wards</div>
                        </div>
                        <div class="ward-list" id="wardList">
                            <!-- Wards will be loaded here -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- Analytics Page -->
            <div class="content-page" id="analytics">
                <div class="content-header">
                    <h2><i class="fas fa-chart-line"></i> Analytics & Trends</h2>
                    <p>Historical data analysis and predictive insights  Updated daily</p>
                </div>
                
                <div class="content-body">
                    <!-- Analytics Charts Grid -->
                    <div class="analytics-grid">
                        <div class="analytics-card">
                            <div class="analytics-header">
                                <h3><i class="fas fa-chart-area"></i> Risk Trends (30 Days)</h3>
                                <select id="trendPeriod" onchange="updateAnalyticsCharts()">
                                    <option value="7">Last 7 days</option>
                                    <option value="30" selected>Last 30 days</option>
                                    <option value="90">Last 90 days</option>
                                    <option value="365">Last year</option>
                                </select>
                            </div>
                            <div class="chart-container">
                                <canvas id="riskTrendChart"></canvas>
                            </div>
                        </div>
                        
                        <div class="analytics-card">
                            <div class="analytics-header">
                                <h3><i class="fas fa-chart-pie"></i> Zone Distribution</h3>
                            </div>
                            <div class="chart-container">
                                <canvas id="zoneDistributionChart"></canvas>
                            </div>
                        </div>
                        
                        <div class="analytics-card">
                            <div class="analytics-header">
                                <h3><i class="fas fa-project-diagram"></i> Rainfall vs Drainage</h3>
                            </div>
                            <div class="chart-container">
                                <canvas id="correlationChart"></canvas>
                            </div>
                        </div>
                        
                        <div class="analytics-card">
                            <div class="analytics-header">
                                <h3><i class="fas fa-chart-bar"></i> Top Risk Wards</h3>
                            </div>
                            <div class="chart-container">
                                <canvas id="topWardsChart"></canvas>
                            </div>
                        </div>
                    </div>

                    <!-- Insights Section -->
                    <div class="insights-section">
                        <h3><i class="fas fa-lightbulb"></i> Key Insights</h3>
                        <div class="insights-grid">
                            <div class="insight-card positive">
                                <div class="insight-icon"></div>
                                <div class="insight-content">
                                    <h4>Drainage Improvement</h4>
                                    <p>15 wards show 20% improvement in drainage capacity after recent upgrades</p>
                                </div>
                            </div>
                            
                            <div class="insight-card warning">
                                <div class="insight-icon"></div>
                                <div class="insight-content">
                                    <h4>Rainfall Increase</h4>
                                    <p>North Delhi wards show 12% higher rainfall compared to last year</p>
                                </div>
                            </div>
                            
                            <div class="insight-card info">
                                <div class="insight-icon"></div>
                                <div class="insight-content">
                                    <h4>Pattern Detection</h4>
                                    <p>Water-logging incidents peak 2-3 hours after heavy rainfall</p>
                                </div>
                            </div>
                            
                            <div class="insight-card negative">
                                <div class="insight-icon"></div>
                                <div class="insight-content">
                                    <h4>High Risk Clusters</h4>
                                    <p>3 clusters in Central Delhi need immediate attention</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Rainfall Page - FIXED STRUCTURE -->
            <div class="content-page" id="rainfall">
                <div class="content-header">
                    <h2><i class="fas fa-cloud-rain"></i> Rainfall Monitoring</h2>
                    <p>Real-time rainfall data from 25 IMD stations across Delhi</p>
                </div>
                
                <div class="content-body">
                    <!-- Rainfall Stats -->
                    <div class="rainfall-stats">
                        <div class="rainfall-stat">
                            <div class="stat-icon"></div>
                            <div class="stat-content">
                                <div class="stat-value" id="currentRainfall">0 mm/hr</div>
                                <div class="stat-label">Current Rainfall</div>
                            </div>
                        </div>
                        
                        <div class="rainfall-stat">
                            <div class="stat-icon"></div>
                            <div class="stat-content">
                                <div class="stat-value" id="todayRainfall">0 mm</div>
                                <div class="stat-label">Today's Total</div>
                            </div>
                        </div>
                        
                        <div class="rainfall-stat">
                            <div class="stat-icon"></div>
                            <div class="stat-content">
                                <div class="stat-value" id="monthlyRainfall">0 mm</div>
                                <div class="stat-label">This Month</div>
                            </div>
                        </div>
                        
                        <div class="rainfall-stat">
                            <div class="stat-icon"></div>
                            <div class="stat-content">
                                <div class="stat-value" id="annualRainfall">0 mm</div>
                                <div class="stat-label">Annual Total</div>
                            </div>
                        </div>
                    </div>

                    <!-- Rainfall Charts Grid -->
                    <div class="rainfall-grid">
                        <div class="rainfall-card">
                            <div class="rainfall-header">
                                <h3><i class="fas fa-chart-line"></i> Real-time Rainfall (24h)</h3>
                            </div>
                            <div class="chart-container">
                                <canvas id="rainfallRealTimeChart"></canvas>
                            </div>
                        </div>
                        
                        <div class="rainfall-card">
                            <div class="rainfall-header">
                                <h3><i class="fas fa-chart-bar"></i> Monthly Rainfall 2023</h3>
                            </div>
                            <div class="chart-container">
                                <canvas id="annualRainfallChart"></canvas>
                            </div>
                        </div>
                    </div>

                    <!-- Rainfall Alerts - FIXED STRUCTURE -->
                    <div class="rainfall-alerts">
                        <h3><i class="fas fa-bell"></i> Rainfall Alerts & Warnings</h3>
                        <div class="alert-list">
                            <div class="alert-item warning">
                                <div class="alert-icon"></div>
                                <div class="alert-content">
                                    <h4>Heavy Rainfall Warning</h4>
                                    <p>North Delhi: Expected 50mm rainfall in next 3 hours. Drainage teams put on standby.</p>
                                    <div class="alert-time">Updated: 2 hours ago</div>
                                </div>
                            </div>
                            
                            <div class="alert-item info">
                                <div class="alert-icon"></div>
                                <div class="alert-content">
                                    <h4>Moderate Rainfall</h4>
                                    <p>South and Central Delhi experiencing moderate rainfall (15mm/hr). Monitoring continues.</p>
                                    <div class="alert-time">Updated: 4 hours ago</div>
                                </div>
                            </div>
                            
                            <div class="alert-item positive">
                                <div class="alert-icon"></div>
                                <div class="alert-content">
                                    <h4>Rainfall Subsiding</h4>
                                    <p>East Delhi rainfall reduced to 5mm/hr. No water-logging reported.</p>
                                    <div class="alert-time">Updated: 6 hours ago</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Complaints Page -->
            <div class="content-page" id="complaints">
                <div class="content-header">
                    <h2><i class="fas fa-comments"></i> Complaints Management</h2>
                    <p>Citizen complaints tracking and resolution system</p>
                </div>
                
                <div class="content-body">
                    <!-- Complaints Header -->
                    <div class="complaints-header">
                        <div class="complaints-stats">
                            <div class="stat-badge pending">
                                <div class="stat-count" id="pendingCount">12</div>
                                <div class="stat-label">Pending</div>
                            </div>
                            <div class="stat-badge in-progress">
                                <div class="stat-count" id="inProgressCount">8</div>
                                <div class="stat-label">In Progress</div>
                            </div>
                            <div class="stat-badge resolved">
                                <div class="stat-count" id="resolvedCount">45</div>
                                <div class="stat-label">Resolved</div>
                            </div>
                        </div>
                        
                        <button class="btn-primary" onclick="openNewComplaintModal()">
                            <i class="fas fa-plus"></i> Register New Complaint
                        </button>
                    </div>

                    <!-- Complaints Table -->
                    <div class="complaints-table-container">
                        <table class="complaints-table">
                            <thead>
                                <tr>
                                    <th>Complaint ID</th>
                                    <th>Date</th>
                                    <th>Complainant</th>
                                    <th>Ward</th>
                                    <th>Type</th>
                                    <th>Status</th>
                                    <th>Priority</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="complaintsTableBody">
                                <!-- Complaints will be loaded here -->
                            </tbody>
                        </table>
                    </div>

                    <!-- Complaints Summary Section -->
                    <div class="complaints-summary-section">
                        <div class="complaints-summary">
                            <h3><i class="fas fa-chart-bar"></i> Complaints Trend (Last 6 Months)</h3>
                            <div class="summary-chart">
                                <canvas id="complaintsChart"></canvas>
                            </div>
                        </div>
                        
                        <div class="complaints-insights">
                            <h3><i class="fas fa-lightbulb"></i> Quick Insights</h3>
                            <div style="display: flex; flex-direction: column; gap: 1rem; margin-top: 1rem;">
                                <div class="insight-card info">
                                    <div class="insight-icon"></div>
                                    <div class="insight-content">
                                        <h4>Peak Season</h4>
                                        <p>Monsoon months (Jun-Sep) account for 65% of annual complaints</p>
                                    </div>
                                </div>
                                
                                <div class="insight-card positive">
                                    <div class="insight-icon"></div>
                                    <div class="insight-content">
                                        <h4>Resolution Rate</h4>
                                        <p>Average resolution time improved by 40% in last quarter</p>
                                    </div>
                                </div>
                                
                                <div class="insight-card warning">
                                    <div class="insight-icon"></div>
                                    <div class="insight-content">
                                        <h4>Hotspot Wards</h4>
                                        <p>Wards 126, 73, 179 receive 30% of all water-logging complaints</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Modals (same as before) -->
    <div class="modal" id="addHotspotModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-map-marker-alt"></i> Add New Hotspot</h3>
                <button class="modal-close" onclick="closeModal('addHotspotModal')"></button>
            </div>
            <form id="hotspotForm" onsubmit="submitHotspot(event)">
                <div class="modal-body">
                    <div class="form-group">
                        <label for="hotspotName"><i class="fas fa-signature"></i> Hotspot Name</label>
                        <input type="text" id="hotspotName" required placeholder="e.g., XYZ Road Junction">
                    </div>
                    
                    <div class="form-group">
                        <label for="hotspotWard"><i class="fas fa-map-pin"></i> Select Ward</label>
                        <select id="hotspotWard" required>
                            <option value="">Select Ward</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label><i class="fas fa-exclamation-triangle"></i> Severity Level</label>
                        <div class="severity-levels">
                            <label class="severity-label low">
                                <input type="radio" name="severity" value="low" required>
                                <span>Low</span>
                            </label>
                            <label class="severity-label medium">
                                <input type="radio" name="severity" value="medium">
                                <span>Medium</span>
                            </label>
                            <label class="severity-label high">
                                <input type="radio" name="severity" value="high">
                                <span>High</span>
                            </label>
                            <label class="severity-label critical">
                                <input type="radio" name="severity" value="critical">
                                <span>Critical</span>
                            </label>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="waterDepth"><i class="fas fa-water"></i> Water Depth (cm)</label>
                            <input type="number" id="waterDepth" min="0" max="500" required placeholder="e.g., 30">
                        </div>
                        
                        <div class="form-group">
                            <label for="affectedArea"><i class="fas fa-ruler-combined"></i> Affected Area (sq m)</label>
                            <input type="number" id="affectedArea" min="0" required placeholder="e.g., 1500">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="hotspotNotes"><i class="fas fa-sticky-note"></i> Additional Notes</label>
                        <textarea id="hotspotNotes" rows="3" placeholder="Describe the hotspot location, causes, and any immediate actions taken..."></textarea>
                    </div>
                    
                    <div class="form-actions">
                        <button type="button" class="btn-secondary" onclick="closeModal('addHotspotModal')">Cancel</button>
                        <button type="submit" class="btn-primary">Add Hotspot</button>
                    </div>
                </div>
            </form>
        </div>
    </div>

    <div class="modal" id="emergencyAlertModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-bell"></i> Send Emergency Alert</h3>
                <button class="modal-close" onclick="closeModal('emergencyAlertModal')"></button>
            </div>
            <form id="emergencyAlertForm" onsubmit="sendEmergencyAlert(event)">
                <div class="modal-body">
                    <div class="form-group">
                        <label for="alertType"><i class="fas fa-exclamation-circle"></i> Alert Type</label>
                        <select id="alertType" required>
                            <option value="">Select Alert Type</option>
                            <option value="heavy-rain">Heavy Rainfall Warning</option>
                            <option value="flood-warning">Flood Warning</option>
                            <option value="road-closure">Road Closure</option>
                            <option value="drainage-maintenance">Drainage Maintenance</option>
                            <option value="other">Other Emergency</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label><i class="fas fa-layer-group"></i> Affected Zones</label>
                        <div class="checkbox-group">
                            <label>
                                <input type="checkbox" name="zones" value="north"> North Delhi
                            </label>
                            <label>
                                <input type="checkbox" name="zones" value="south"> South Delhi
                            </label>
                            <label>
                                <input type="checkbox" name="zones" value="east"> East Delhi
                            </label>
                            <label>
                                <input type="checkbox" name="zones" value="west"> West Delhi
                            </label>
                            <label>
                                <input type="checkbox" name="zones" value="central"> Central Delhi
                            </label>
                            <label>
                                <input type="checkbox" name="zones" value="new-delhi"> New Delhi
                            </label>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label><i class="fas fa-exclamation-triangle"></i> Alert Severity</label>
                        <div class="severity-levels">
                            <label class="severity-label low">
                                <input type="radio" name="severity" value="low" required>
                                <span>Low</span>
                            </label>
                            <label class="severity-label medium">
                                <input type="radio" name="severity" value="medium">
                                <span>Medium</span>
                            </label>
                            <label class="severity-label high">
                                <input type="radio" name="severity" value="high">
                                <span>High</span>
                            </label>
                            <label class="severity-label critical">
                                <input type="radio" name="severity" value="critical">
                                <span>Critical</span>
                            </label>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="alertMessage"><i class="fas fa-comment-alt"></i> Alert Message</label>
                        <textarea id="alertMessage" rows="4" required placeholder="Enter detailed alert message for citizens..."></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label><i class="fas fa-broadcast-tower"></i> Broadcast Channels</label>
                        <div class="checkbox-group">
                            <label>
                                <input type="checkbox" name="channels" value="sms" checked> SMS Alerts
                            </label>
                            <label>
                                <input type="checkbox" name="channels" value="app" checked> Mobile App
                            </label>
                            <label>
                                <input type="checkbox" name="channels" value="website"> Website
                            </label>
                            <label>
                                <input type="checkbox" name="channels" value="social-media"> Social Media
                            </label>
                            <label>
                                <input type="checkbox" name="channels" value="public-address"> Public Address
                            </label>
                        </div>
                    </div>
                    
                    <div class="form-actions">
                        <button type="button" class="btn-secondary" onclick="closeModal('emergencyAlertModal')">Cancel</button>
                        <button type="submit" class="btn-danger">
                            <i class="fas fa-bell"></i> Send Emergency Alert
                        </button>
                    </div>
                </div>
            </form>
        </div>
    </div>

    <div class="modal" id="newComplaintModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-comment-medical"></i> Register New Complaint</h3>
                <button class="modal-close" onclick="closeModal('newComplaintModal')"></button>
            </div>
            <form id="complaintForm" onsubmit="submitComplaint(event)">
                <div class="modal-body">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="complaintName"><i class="fas fa-user"></i> Full Name</label>
                            <input type="text" id="complaintName" required placeholder="Enter your full name">
                        </div>
                        
                        <div class="form-group">
                            <label for="complaintPhone"><i class="fas fa-phone"></i> Phone Number</label>
                            <input type="tel" id="complaintPhone" required placeholder="Enter 10-digit mobile number">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="complaintEmail"><i class="fas fa-envelope"></i> Email Address</label>
                        <input type="email" id="complaintEmail" placeholder="Enter email address (optional)">
                    </div>
                    
                    <div class="form-group">
                        <label for="complaintAddress"><i class="fas fa-home"></i> Full Address</label>
                        <input type="text" id="complaintAddress" required placeholder="Enter complete address">
                    </div>
                    
                    <div class="form-group">
                        <label for="complaintWard"><i class="fas fa-map-pin"></i> Select Ward</label>
                        <select id="complaintWard" required>
                            <option value="">Select Ward</option>
                        </select>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="complaintPriority"><i class="fas fa-exclamation-circle"></i> Priority Level</label>
                            <select id="complaintPriority" required>
                                <option value="">Select Priority</option>
                                <option value="low">Low Priority</option>
                                <option value="medium">Medium Priority</option>
                                <option value="high">High Priority</option>
                                <option value="urgent">Urgent</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="complaintType"><i class="fas fa-tag"></i> Complaint Type</label>
                            <select id="complaintType" required>
                                <option value="">Select Type</option>
                                <option value="water-logging">Water-logging</option>
                                <option value="drainage-blockage">Drainage Blockage</option>
                                <option value="road-flooding">Road Flooding</option>
                                <option value="sewer-backup">Sewer Backup</option>
                                <option value="other">Other</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="complaintDescription"><i class="fas fa-align-left"></i> Complaint Details</label>
                        <textarea id="complaintDescription" rows="4" required placeholder="Describe the issue in detail, including location, time, and any photos you have taken..."></textarea>
                    </div>
                    
                    <div class="form-actions">
                        <button type="button" class="btn-secondary" onclick="closeModal('newComplaintModal')">Cancel</button>
                        <button type="submit" class="btn-primary">Submit Complaint</button>
                    </div>
                </div>
            </form>
        </div>
    </div>

    <!-- Notifications Panel -->
    <div class="notifications-panel" id="notificationsPanel">
        <div class="notifications-header">
            <h3><i class="fas fa-bell"></i> Notifications</h3>
            <button class="notifications-close" onclick="closeNotifications()"></button>
        </div>
        <div class="notifications-list">
            <!-- Notifications will be loaded here -->
        </div>
    </div>

    
    <!-- External JS Libraries -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    
    <!-- JAVASCRIPT CONTENT GOES HERE -->
    <script>
    // PASTE YOUR ENTIRE script.js CONTENT HERE
    // Alert System with Moving Headlines - COMPLETELY FIXED
const alertsData = [
    { icon: '', text: 'HIGH RAINFALL ALERT: Heavy showers expected in North Delhi wards. Drainage teams put on standby.', type: 'critical' },
    { icon: '', text: 'Drainage maintenance scheduled for tomorrow in Central Delhi zones 5-8 from 10 AM to 4 PM.', type: 'warning' },
    { icon: '', text: 'New water-logging hotspots detected in 5 wards. Field teams dispatched for assessment.', type: 'info' },
    { icon: '', text: 'IMD predicts moderate rainfall across Delhi in next 24 hours. Be prepared for local water accumulation.', type: 'info' },
    { icon: '', text: 'System maintenance: Some drainage sensors may be temporarily offline during updates.', type: 'maintenance' },
    { icon: '', text: 'Risk level increased in 3 wards due to recent infrastructure changes. Review required.', type: 'warning' },
    { icon: '', text: 'Road closures expected in South Delhi due to drainage repair work. Plan alternative routes.', type: 'warning' },
    { icon: '', text: 'Emergency response teams fully operational across all zones. All systems green.', type: 'positive' }
];

// Correct Delhi Ward Coordinates from CSV (Parsed and formatted)
// Complete Delhi Ward Coordinates - ALL 289 WARDS
const actualWardCoordinates = [
    // Cantonment Wards (8)
    { wardNo: "CANT_1", wardName: "DELHI CANTT CHARGE 1", lng: 77.13054954550006, lat: 28.622003401500052 },
    { wardNo: "CANT_2", wardName: "DELHI CANTT CHARGE 2", lng: 77.13936651000006, lat: 28.610229239500057 },
    { wardNo: "CANT_3", wardName: "DELHI CANTT CHARGE 3", lng: 77.14784660650005, lat: 28.593773734500076 },
    { wardNo: "CANT_4", wardName: "DELHI CANTT CHARGE 4", lng: 77.14334604650006, lat: 28.56592405850003 },
    { wardNo: "CANT_5", wardName: "DELHI CANTT CHARGE 5", lng: 77.13384187100004, lat: 28.57474325700005 },
    { wardNo: "CANT_6", wardName: "DELHI CANTT CHARGE 6", lng: 77.10626808300006, lat: 28.573183573500074 },
    { wardNo: "CANT_7", wardName: "DELHI CANTT CHARGE 7", lng: 77.11005448200007, lat: 28.59485790000005 },
    { wardNo: "CANT_8", wardName: "DELHI CANTT CHARGE 8", lng: 77.12360107650005, lat: 28.600375404500056 },
    
    // NDMC Wards (9)
    { wardNo: "NDMC_1", wardName: "NDMC CHARGE 1", lng: 77.22864108300004, lat: 28.616813283000056 },
    { wardNo: "NDMC_2", wardName: "NDMC CHARGE 2", lng: 77.21272293600006, lat: 28.63741817500005 },
    { wardNo: "NDMC_3", wardName: "NDMC CHARGE 3", lng: 77.18619568550005, lat: 28.619796772500052 },
    { wardNo: "NDMC_4", wardName: "NDMC CHARGE 4", lng: 77.21527864300003, lat: 28.62117535750005 },
    { wardNo: "NDMC_5", wardName: "NDMC CHARGE 5", lng: 77.22106828500006, lat: 28.60168441850007 },
    { wardNo: "NDMC_6", wardName: "NDMC CHARGE 6", lng: 77.21827901600005, lat: 28.58489630650007 },
    { wardNo: "NDMC_7", wardName: "NDMC CHARGE 7", lng: 77.20409910950005, lat: 28.570621317000047 },
    { wardNo: "NDMC_8", wardName: "NDMC CHARGE 8", lng: 77.19661165150006, lat: 28.577248492000052 },
    { wardNo: "NDMC_9", wardName: "NDMC CHARGE 9", lng: 77.18965869100006, lat: 28.58928413250004 },
    
    // Regular Ward Numbers 1-272
    { wardNo: "1", wardName: "NARELA", lng: 77.11346808000005, lat: 28.844765256000045 },
    { wardNo: "2", wardName: "BANKNER", lng: 77.07670003600003, lat: 28.852885344500066 },
    { wardNo: "3", wardName: "ALIPUR", lng: 77.10512273150007, lat: 28.791734201000054 },
    { wardNo: "4", wardName: "BAKHTAWAR PUR", lng: 77.16921303500004, lat: 28.818902421000047 },
    { wardNo: "5", wardName: "BHALASWA JAHAGIR PUR", lng: 77.15652433200006, lat: 28.761972933000038 },
    { wardNo: "6", wardName: "MUKUND PUR", lng: 77.18875139250005, lat: 28.747376305000074 },
    { wardNo: "7", wardName: "BURARI", lng: 77.20195213550005, lat: 28.76756720100005 },
    { wardNo: "8", wardName: "JHARODA", lng: 77.21320802600007, lat: 28.74385380900003 },
    { wardNo: "9", wardName: "MALKAGANJ", lng: 77.20786754200006, lat: 28.673632412000046 },
    { wardNo: "10", wardName: "TIMAR PUR", lng: 77.21829698250005, lat: 28.701381185500054 },
    { wardNo: "11", wardName: "MUKHERJEE NAGAR", lng: 77.21559305350004, lat: 28.713587780500035 },
    { wardNo: "12", wardName: "G.T.B. NAGAR", lng: 77.20512318850007, lat: 28.699144944500063 },
    { wardNo: "13", wardName: "DHIR PUR", lng: 77.19606367900005, lat: 28.720098870500067 },
    { wardNo: "14", wardName: "ADARASH NAGAR", lng: 77.17403698800007, lat: 28.714340254000035 },
    { wardNo: "15", wardName: "SARAI PIPAL THALA", lng: 77.16149650700007, lat: 28.724577638000056 },
    { wardNo: "16", wardName: "JAHANGIRPURI-I", lng: 77.16875040300008, lat: 28.727268305500047 },
    { wardNo: "17", wardName: "SAMAYPUR BADLI", lng: 77.14634641950008, lat: 28.737881851000054 },
    { wardNo: "18", wardName: "LIBAS PUR", lng: 77.14651710000004, lat: 28.757729534500044 },
    { wardNo: "19", wardName: "BHALSWA", lng: 77.16129887750006, lat: 28.743285249500076 },
    { wardNo: "20", wardName: "JAHANGIR PURI -II", lng: 77.16807217500005, lat: 28.73239629950004 },
    { wardNo: "21", wardName: "ROHINI", lng: 77.11532759300005, lat: 28.732450941500048 },
    { wardNo: "22", wardName: "RITHALA", lng: 77.10760208150006, lat: 28.716766724500047 },
    { wardNo: "23", wardName: "BUDH VIHAR", lng: 77.08692286350004, lat: 28.71562059550007 },
    { wardNo: "24", wardName: "VIJAY VIHAR", lng: 77.09403302900006, lat: 28.708892069500052 },
    { wardNo: "25", wardName: "POOTH KALAN", lng: 77.07399161500004, lat: 28.71854580750005 },
    { wardNo: "26", wardName: "SAHIBABAD DAULAT PUR", lng: 77.10033920250007, lat: 28.745611759500065 },
    { wardNo: "27", wardName: "BEGUMPUR", lng: 77.01401559550007, lat: 28.756514748500052 },
    { wardNo: "28", wardName: "BAWANA", lng: 77.00657305300007, lat: 28.808736115000045 },
    { wardNo: "29", wardName: "KARALA", lng: 77.00174011650006, lat: 28.738469518000045 },
    { wardNo: "30", wardName: "MUNDAKA", lng: 76.99703743650005, lat: 28.68841292700006 },
    { wardNo: "31", wardName: "NANGLOI JAT WEST", lng: 77.04872200600005, lat: 28.682999255000055 },
    { wardNo: "32", wardName: "NILOTHI", lng: 77.05521682550005, lat: 28.668871240000044 },
    { wardNo: "33", wardName: "PREM NAGAR", lng: 77.05830253850004, lat: 28.706390841500053 },
    { wardNo: "34", wardName: "NITHARI", lng: 77.03709331500008, lat: 28.70460507000007 },
    { wardNo: "35", wardName: "KIRARI SULEMAN NAGAR", lng: 77.05735930750004, lat: 28.697285730500028 },
    { wardNo: "36", wardName: "PRATAP VIHAR", lng: 77.04940023450004, lat: 28.691466878000057 },
    { wardNo: "37", wardName: "SULTANPURI EAST", lng: 77.07918836900006, lat: 28.69736105350006 },
    { wardNo: "38", wardName: "MANGOL PURI NORTH", lng: 77.08697676250006, lat: 28.700091447000062 },
    { wardNo: "39", wardName: "SULTANPUR MAJRA", lng: 77.07352449100006, lat: 28.697597383000044 },
    { wardNo: "40", wardName: "SULTANPURI SOUTH", lng: 77.07011987650006, lat: 28.688819153500077 },
    { wardNo: "41", wardName: "GURU HARKISHAN NAGAR", lng: 77.08493309550005, lat: 28.66629401250006 },
    { wardNo: "42", wardName: "PERAGHARHI", lng: 77.08551250850007, lat: 28.67906270450004 },
    { wardNo: "43", wardName: "NANGLOI EAST", lng: 77.06384065250003, lat: 28.673568869500016 },
    { wardNo: "44", wardName: "QUAMMRUDDIN NAGAR", lng: 77.06361607350004, lat: 28.657066744000048 },
    { wardNo: "45", wardName: "ROHINI SOUTH", lng: 77.10851836300006, lat: 28.702699175500044 },
    { wardNo: "46", wardName: "MANGOLPURI EAST", lng: 77.09691662100005, lat: 28.69005622350005 },
    { wardNo: "47", wardName: "MANGOLPURI", lng: 77.09149079700003, lat: 28.697357153500036 },
    { wardNo: "48", wardName: "MANGOLPURI WEST", lng: 77.08373833600007, lat: 28.690087764000054 },
    { wardNo: "49", wardName: "ROHINI NORTH", lng: 77.13329839050004, lat: 28.735002518500067 },
    { wardNo: "50", wardName: "ROHINI CENTRAL", lng: 77.12435117000007, lat: 28.720213227500068 },
    { wardNo: "51", wardName: "ROHINI EAST", lng: 77.12798485550005, lat: 28.709128334500065 },
    { wardNo: "52", wardName: "NAHARPUR", lng: 77.11743863400008, lat: 28.71090526450007 },
    { wardNo: "53", wardName: "PITAMPURA SOUTH", lng: 77.14407817350008, lat: 28.701308553000032 },
    { wardNo: "54", wardName: "PITAMPUR NORTH", lng: 77.14407817350008, lat: 28.71774317750007 },
    { wardNo: "55", wardName: "SHALIMAR BAGH NORTH", lng: 77.15431447650008, lat: 28.718578615500036 },
    { wardNo: "56", wardName: "SHALIMAR BAGH SOUTH", lng: 77.16195464800003, lat: 28.70964052900004 },
    { wardNo: "57", wardName: "PASCHIM VIHAR SOUTH", lng: 77.10273321300005, lat: 28.666987539000047 },
    { wardNo: "58", wardName: "PASCHIM VIHAR NORTH", lng: 77.10450289350007, lat: 28.675965282500073 },
    { wardNo: "59", wardName: "RANI BAGH", lng: 77.12689789350006, lat: 28.682857156500035 },
    { wardNo: "60", wardName: "SARASWATI VIHAR", lng: 77.11308180500004, lat: 28.69125380250003 },
    { wardNo: "61", wardName: "TRI NAGAR", lng: 77.16141565850006, lat: 28.677915995000063 },
    { wardNo: "62", wardName: "RAMPURA", lng: 77.14604548400004, lat: 28.680788372500047 },
    { wardNo: "63", wardName: "KOHAT ENCLAVE", lng: 77.13611460850007, lat: 28.693680802000046 },
    { wardNo: "64", wardName: "SHAKUR PUR", lng: 77.14782863950006, lat: 28.690359588000064 },
    { wardNo: "65", wardName: "NIMRI COLONY", lng: 77.17353842300005, lat: 28.682057468500062 },
    { wardNo: "66", wardName: "SAWAN PARK", lng: 77.17957061050004, lat: 28.69199426250003 },
    { wardNo: "67", wardName: "WAJIRPUR", lng: 77.16483823950006, lat: 28.689212780000048 },
    { wardNo: "68", wardName: "ASHOK VIHAR", lng: 77.16668876900007, lat: 28.697620804500076 },
    { wardNo: "69", wardName: "KAMLA NAGAR", lng: 77.19425806500007, lat: 28.677037136000052 },
    { wardNo: "70", wardName: "RANA PRATAP BAGH", lng: 77.19438382950005, lat: 28.688527435000026 },
    { wardNo: "71", wardName: "SANGAM PARK", lng: 77.18381964200006, lat: 28.69841666000005 },
    { wardNo: "72", wardName: "MODEL TOWN", lng: 77.19122175950008, lat: 28.70116650500003 },
    { wardNo: "73", wardName: "SHASTRI NAGAR", lng: 77.18098545700005, lat: 28.67380589700005 },
    { wardNo: "74", wardName: "INDER LOK COLONY", lng: 77.17426156700003, lat: 28.66518275550007 },
    { wardNo: "75", wardName: "KISHAN GANJ", lng: 77.19448264400006, lat: 28.667204899500064 },
    { wardNo: "76", wardName: "DEPUTY GANJ", lng: 77.20752169050007, lat: 28.663685465000043 },
    { wardNo: "77", wardName: "KASHMERE GATE", lng: 77.23073864900007, lat: 28.676169215000073 },
    { wardNo: "78", wardName: "MAJNU KA TILA", lng: 77.21922224700006, lat: 28.683482030500073 },
    { wardNo: "79", wardName: "JAMA MASJID", lng: 77.23521225900006, lat: 28.649992912000044 },
    { wardNo: "80", wardName: "CHANDNI CHOWK", lng: 77.23341113700008, lat: 28.65769468950006 },
    { wardNo: "81", wardName: "MINTO ROAD", lng: 77.23098568600005, lat: 28.636093620000054 },
    { wardNo: "82", wardName: "KUCHA PANDIT", lng: 77.22614376650006, lat: 28.64775827750003 },
    { wardNo: "83", wardName: "BAZAR SITARAM", lng: 77.23036135650005, lat: 28.64642200450004 },
    { wardNo: "84", wardName: "TURKMAN GATE", lng: 77.23567938300005, lat: 28.64397417400005 },
    { wardNo: "85", wardName: "IDGAH ROAD", lng: 77.21586703950004, lat: 28.652121558500056 },
    { wardNo: "86", wardName: "BALLIMARAN", lng: 77.22560028550006, lat: 28.65324501850006 },
    { wardNo: "87", wardName: "RAM NAGAR", lng: 77.21510347150007, lat: 28.64911024150004 },
    { wardNo: "88", wardName: "QASABPURA", lng: 77.20886467150004, lat: 28.653887317000056 },
    { wardNo: "89", wardName: "PAHAR GANJ", lng: 77.21091283100006, lat: 28.642696831500047 },
    { wardNo: "90", wardName: "MODEL BASTI", lng: 77.20347478050004, lat: 28.652523299500047 },
    { wardNo: "91", wardName: "KAROL BAGH", lng: 77.19159006900006, lat: 28.65503411450007 },
    { wardNo: "92", wardName: "DEV NAGAR", lng: 77.18033867000005, lat: 28.653627315500046 },
    { wardNo: "93", wardName: "BALJIT NAGAR", lng: 77.15934055000005, lat: 28.65607106400006 },
    { wardNo: "94", wardName: "WEST PATEL NAGAR", lng: 77.16116413050005, lat: 28.658699731500064 },
    { wardNo: "95", wardName: "EAST PATEL NAGAR", lng: 77.17402800550005, lat: 28.65342184450006 },
    { wardNo: "96", wardName: "NEW RANJIT NAGAR", lng: 77.16072844750005, lat: 28.648250937500052 },
    { wardNo: "97", wardName: "KIRTI NAGAR", lng: 77.14302265300006, lat: 28.655286106000034 },
    { wardNo: "98", wardName: "MANSAROWER GARDEN", lng: 77.13362627500007, lat: 28.641896311500062 },
    { wardNo: "99", wardName: "MOTI NAGAR", lng: 77.14709202100008, lat: 28.670345933500045 },
    { wardNo: "100", wardName: "KARAM PURA", lng: 77.15581466250006, lat: 28.66573485850006 },
    { wardNo: "101", wardName: "RAJA GARDEN", lng: 77.12482278550004, lat: 28.653847884000072 },
    { wardNo: "102", wardName: "RAGHUBIR NAGAR", lng: 77.11489640150006, lat: 28.657284975500062 },
    { wardNo: "103", wardName: "PUNJABI BAGH", lng: 77.12759857950007, lat: 28.66768154850007 },
    { wardNo: "104", wardName: "MADIPUR", lng: 77.11529615200004, lat: 28.671007878500035 },
    { wardNo: "105", wardName: "RAJOURI GARDEN", lng: 77.11813033650006, lat: 28.644967247000068 },
    { wardNo: "106", wardName: "TAGORE GARDEN", lng: 77.10396839650005, lat: 28.64644555700005 },
    { wardNo: "107", wardName: "VISHNU GARDEN", lng: 77.09602728900006, lat: 28.64853083400007 },
    { wardNo: "108", wardName: "KHYALA", lng: 77.10372135950007, lat: 28.65227509600004 },
    { wardNo: "109", wardName: "JANAK PURI NORTH", lng: 77.09653483750006, lat: 28.628729560000068 },
    { wardNo: "110", wardName: "NANGAL RAYA", lng: 77.11025660300007, lat: 28.615178338000078 },
    { wardNo: "111", wardName: "HARI NAGAR", lng: 77.12097350450006, lat: 28.62687242800004 },
    { wardNo: "112", wardName: "SUBHASH NAGAR", lng: 77.11668854050006, lat: 28.636019093000044 },
    { wardNo: "113", wardName: "MAHAVIR NAGAR", lng: 77.07578824600006, lat: 28.63351961300006 },
    { wardNo: "114", wardName: "TILAK NAGAR", lng: 77.09533558600006, lat: 28.638478987500065 },
    { wardNo: "115", wardName: "MAJOR BHUPINDAR SINGH NAGAR", lng: 77.09220046600007, lat: 28.65378091300005 },
    { wardNo: "116", wardName: "VIKASPURI EAST", lng: 77.08343740000007, lat: 28.647533246500046 },
    { wardNo: "117", wardName: "JANAK PURI WEST", lng: 77.07811937400007, lat: 28.622480533000044 },
    { wardNo: "118", wardName: "JANAK PURI SOUTH", lng: 77.09706035200006, lat: 28.617051383000074 },
    { wardNo: "119", wardName: "MILAP NAGAR", lng: 77.06256953600007, lat: 28.619389610500065 },
    { wardNo: "120", wardName: "SITA PURI", lng: 77.07858200600006, lat: 28.611342052000055 },
    { wardNo: "121", wardName: "KUNWAR SINGH NAGAR", lng: 77.04016555300007, lat: 28.643665119000048 },
    { wardNo: "122", wardName: "HASTSAL", lng: 77.02585089900006, lat: 28.646396557500054 },
    { wardNo: "123", wardName: "VIKAS PURI", lng: 77.05907508950006, lat: 28.62783470200003 },
    { wardNo: "124", wardName: "VIKAS NAGAR", lng: 77.06866011400007, lat: 28.640244761000048 },
    { wardNo: "125", wardName: "MOHAN GARDEN", lng: 77.03315869400004, lat: 28.62733005250007 },
    { wardNo: "126", wardName: "NAWADA", lng: 77.04030479200006, lat: 28.62323780750006 },
    { wardNo: "127", wardName: "UTTAM NAGAR", lng: 77.04390703600006, lat: 28.617414386000036 },
    { wardNo: "128", wardName: "BINDAPUR", lng: 77.06794595300005, lat: 28.613313480000073 },
    { wardNo: "129", wardName: "DABRI", lng: 77.09459447600005, lat: 28.60763153350004 },
    { wardNo: "130", wardName: "MANGLAPURI", lng: 77.08376528550005, lat: 28.596120062500063 },
    { wardNo: "131", wardName: "SAGARPUR", lng: 77.10251312500006, lat: 28.60128279150004 },
    { wardNo: "132", wardName: "SAGARPUR WEST", lng: 77.09880757500005, lat: 28.603550260000077 },
    { wardNo: "133", wardName: "CHHAWLA", lng: 76.95184768600006, lat: 28.544827347500046 },
    { wardNo: "134", wardName: "NANGLI SAKRAVATI", lng: 76.99819626300004, lat: 28.579979940000044 },
    { wardNo: "135", wardName: "KAKRAULA", lng: 77.02826736750006, lat: 28.60032636400004 },
    { wardNo: "136", wardName: "MATIALA", lng: 77.05183916000007, lat: 28.587412344000057 },
    { wardNo: "137", wardName: "ROSHANPURA", lng: 76.99549233400003, lat: 28.609814082500066 },
    { wardNo: "138", wardName: "NAJAFGARH", lng: 76.97837942800004, lat: 28.612986173000053 },
    { wardNo: "139", wardName: "DICHAON KALAN", lng: 76.97009246950006, lat: 28.64130161500006 },
    { wardNo: "140", wardName: "KHERA", lng: 76.90937084800004, lat: 28.581362037000076 },
    { wardNo: "141", wardName: "BIJWASAN", lng: 77.04413610700004, lat: 28.54867316900004 },
    { wardNo: "142", wardName: "RAJ NAGAR", lng: 77.08300620900008, lat: 28.57320547650005 },
    { wardNo: "143", wardName: "KAPASHERA", lng: 77.09143240650008, lat: 28.542216852000053 },
    { wardNo: "144", wardName: "MAHIPALPUR", lng: 77.12939970200006, lat: 28.537370125500047 },
    { wardNo: "145", wardName: "PALAM", lng: 77.08062567350007, lat: 28.584880287500027 },
    { wardNo: "146", wardName: "SADH NAGAR", lng: 77.09556914850006, lat: 28.594787629500075 },
    { wardNo: "147", wardName: "MAHAVIR ENCLAVE", lng: 77.06915867900005, lat: 28.596806453000056 },
    { wardNo: "148", wardName: "MADHU VIHAR", lng: 77.05755693700004, lat: 28.60878690000007 },
    { wardNo: "149", wardName: "RAJENDER NAGAR", lng: 77.18091359200005, lat: 28.637063024000042 },
    { wardNo: "150", wardName: "PUSA", lng: 77.16065209050007, lat: 28.629136663000054 },
    { wardNo: "151", wardName: "INDER PURI", lng: 77.14846644350007, lat: 28.63162714400005 },
    { wardNo: "152", wardName: "NARAINA", lng: 77.13831548100003, lat: 28.62926924000007 },
    { wardNo: "153", wardName: "DARYAGANJ", lng: 77.24832766200007, lat: 28.632189574500046 },
    { wardNo: "154", wardName: "NIZAMUDDIN", lng: 77.25271593250005, lat: 28.601169540500052 },
    { wardNo: "155", wardName: "LAJPAT NAGAR", lng: 77.24566864950006, lat: 28.573706156000043 },
    { wardNo: "156", wardName: "BHOGAL", lng: 77.25545130250006, lat: 28.57875105000005 },
    { wardNo: "157", wardName: "KASTURBA NAGAR", lng: 77.23347851050005, lat: 28.582580755000038 },
    { wardNo: "158", wardName: "KOTLA MUBARAKPUR", lng: 77.21857546000004, lat: 28.57395874200006 },
    { wardNo: "159", wardName: "ANDREWSGANJ", lng: 77.22793590500004, lat: 28.56615166250006 },
    { wardNo: "160", wardName: "AMAR COLONY", lng: 77.24321624850006, lat: 28.56444415650006 },
    { wardNo: "161", wardName: "MALVIYA NAGAR", lng: 77.19502163350006, lat: 28.53885420700007 },
    { wardNo: "162", wardName: "HAUZ RANI", lng: 77.21164495800005, lat: 28.53445103100006 },
    { wardNo: "163", wardName: "SAFDARJANG ENCLAVE", lng: 77.19561452150006, lat: 28.557934453500053 },
    { wardNo: "164", wardName: "HAUZ KHAS", lng: 77.20876585700006, lat: 28.555078188500033 },
    { wardNo: "165", wardName: "VASANT VIHAR", lng: 77.16106531550005, lat: 28.560293127500046 },
    { wardNo: "166", wardName: "MUNIRKA", lng: 77.17847466550006, lat: 28.55715378800005 },
    { wardNo: "167", wardName: "R. K. PURAM", lng: 77.17902263850004, lat: 28.568167710500063 },
    { wardNo: "168", wardName: "NANAK PURA", lng: 77.16678309250005, lat: 28.57803618150004 },
    { wardNo: "169", wardName: "LADOSARAI", lng: 77.19081302650005, lat: 28.52458834300006 },
    { wardNo: "170", wardName: "MEHRAULI", lng: 77.18737247850004, lat: 28.51627412950006 },
    { wardNo: "171", wardName: "VASANTKUNJ", lng: 77.16382314350005, lat: 28.539426004000063 },
    { wardNo: "172", wardName: "KISHANGARH", lng: 77.13533307450007, lat: 28.513564937500064 },
    { wardNo: "173", wardName: "DEOLI", lng: 77.20532530950007, lat: 28.49815921700005 },
    { wardNo: "174", wardName: "CHHATARPUR", lng: 77.15685221650006, lat: 28.49653009550005 },
    { wardNo: "175", wardName: "AYA NAGAR", lng: 77.15480855000007, lat: 28.44750415750005 },
    { wardNo: "176", wardName: "BHATI", lng: 77.20545556500005, lat: 28.449811010000047 },
    { wardNo: "177", wardName: "SAID UL AJAIB", lng: 77.22531731600006, lat: 28.472945735500048 },
    { wardNo: "178", wardName: "SANGAM VIHAR", lng: 77.22336797200003, lat: 28.48493264250004 },
    { wardNo: "179", wardName: "TIGRI", lng: 77.22925642850007, lat: 28.500387287000052 },
    { wardNo: "180", wardName: "DAKSHINPURI EXT.", lng: 77.24080427200005, lat: 28.52677582900003 },
    { wardNo: "181", wardName: "KHANPUR", lng: 77.22485019200005, lat: 28.510874765500063 },
    { wardNo: "182", wardName: "AMBEDKAR NAGAR", lng: 77.23261163650005, lat: 28.51662565350003 },
    { wardNo: "183", wardName: "MADANGIR", lng: 77.23522124250005, lat: 28.520548553000054 },
    { wardNo: "184", wardName: "PUSHP VIHAR", lng: 77.22397433450007, lat: 28.52436445750004 },
    { wardNo: "185", wardName: "TUGHLAKABAD EXTN", lng: 77.25100913350008, lat: 28.517031800500035 },
    { wardNo: "186", wardName: "SANGAM VIHAR WEST", lng: 77.24949547250006, lat: 28.494047336500074 },
    { wardNo: "187", wardName: "SANGAM VIHAR CENTRAL", lng: 77.25160202150005, lat: 28.494004846500047 },
    { wardNo: "188", wardName: "SANGAM VIHAR EAST", lng: 77.26055373350005, lat: 28.49867001900006 },
    { wardNo: "189", wardName: "CHIRAG DELHI", lng: 77.23452953950007, lat: 28.53430495750007 },
    { wardNo: "190", wardName: "CHITRANJAN PARK", lng: 77.24946403100006, lat: 28.533160299500054 },
    { wardNo: "191", wardName: "SHAPUR JAT", lng: 77.22688487650007, lat: 28.54270910100007 },
    { wardNo: "192", wardName: "GREATER KAILASH-I", lng: 77.24454575500005, lat: 28.55229314050004 },
    { wardNo: "193", wardName: "SRI NIWASPURI", lng: 77.26846339950006, lat: 28.559953817000064 },
    { wardNo: "194", wardName: "EAST OF KAILASH", lng: 77.25849659100004, lat: 28.55114480000006 },
    { wardNo: "195", wardName: "GOVIND PURI", lng: 77.26236833050007, lat: 28.53071420550006 },
    { wardNo: "196", wardName: "KALKAJI", lng: 77.26038305350005, lat: 28.538053622000064 },
    { wardNo: "197", wardName: "TUGHLAKABAD", lng: 77.27683569750005, lat: 28.515653518500073 },
    { wardNo: "198", wardName: "PUL PEHLAD", lng: 77.28180338150005, lat: 28.495859838500053 },
    { wardNo: "199", wardName: "TEKHAND", lng: 77.28598953050005, lat: 28.51208056850004 },
    { wardNo: "200", wardName: "HARKESH NAGAR", lng: 77.27539390200005, lat: 28.54036968050005 },
    { wardNo: "201", wardName: "JAITPUR", lng: 77.32807111000008, lat: 28.509264578000028 },
    { wardNo: "202", wardName: "MEETHEYPUR", lng: 77.32520548450003, lat: 28.496104631000037 },
    { wardNo: "203", wardName: "BADAR PUR", lng: 77.30423880550006, lat: 28.501882979000044 },
    { wardNo: "204", wardName: "MOLARBAND", lng: 77.31191940100007, lat: 28.495954346500042 },
    { wardNo: "205", wardName: "ZAKIR NAGAR", lng: 77.27803944000004, lat: 28.571938965000044 },
    { wardNo: "206", wardName: "OKHLA", lng: 77.28411654300007, lat: 28.560313318000055 },
    { wardNo: "207", wardName: "MADANPUR KHADAR", lng: 77.32044441350007, lat: 28.52499137950005 },
    { wardNo: "208", wardName: "SARITA VIHAR", lng: 77.30405015950004, lat: 28.536478395000046 },
    { wardNo: "209", wardName: "MAYUR VIHAR PHASE-I", lng: 77.30056918800005, lat: 28.604318893000027 },
    { wardNo: "210", wardName: "DALLOPURA", lng: 77.31266500300006, lat: 28.608250539500062 },
    { wardNo: "211", wardName: "TRILOK PURI", lng: 77.28867998500004, lat: 28.596742510500064 },
    { wardNo: "212", wardName: "NEW ASHOK NAGAR", lng: 77.30286887500002, lat: 28.594771583000067 },
    { wardNo: "213", wardName: "KALYAN PURI", lng: 77.31532850750006, lat: 28.61572682350004 },
    { wardNo: "214", wardName: "KHICHRIPUR", lng: 77.32069594150005, lat: 28.61317017400006 },
    { wardNo: "215", wardName: "KONDLI", lng: 77.33170479550006, lat: 28.61107365850006 },
    { wardNo: "216", wardName: "GHAROLI", lng: 77.33477254200005, lat: 28.617611030000035 },
    { wardNo: "217", wardName: "VINOD NAGAR", lng: 77.29511192200007, lat: 28.622248159000065 },
    { wardNo: "218", wardName: "MANDAWALI", lng: 77.29539938300007, lat: 28.62894648750006 },
    { wardNo: "219", wardName: "MAYUR VIHAR PHASE II", lng: 77.30486313500006, lat: 28.619921813500042 },
    { wardNo: "220", wardName: "PATPARGANJ", lng: 77.29004093250003, lat: 28.609054674500044 },
    { wardNo: "221", wardName: "KISHAN KUNJ", lng: 77.27271692250005, lat: 28.635845464000056 },
    { wardNo: "222", wardName: "LAXMI NAGAR", lng: 77.27954411800005, lat: 28.63754071400004 },
    { wardNo: "223", wardName: "SHAKARPUR", lng: 77.28536071000005, lat: 28.62828014400006 },
    { wardNo: "224", wardName: "PANDAV NAGAR", lng: 77.27838978300008, lat: 28.620765362500066 },
    { wardNo: "225", wardName: "ANAND VIHAR", lng: 77.30857317700006, lat: 28.65690612150007 },
    { wardNo: "226", wardName: "VISHWASH NAGAR", lng: 77.29480649500005, lat: 28.66163592250004 },
    { wardNo: "227", wardName: "I.P EXTENTION", lng: 77.31436281850003, lat: 28.638276851500052 },
    { wardNo: "228", wardName: "PREET VIHAR", lng: 77.29541285800008, lat: 28.640831657000035 },
    { wardNo: "229", wardName: "KRISHNA NAGAR", lng: 77.27669645900005, lat: 28.65361507150007 },
    { wardNo: "230", wardName: "GEETA COLONY", lng: 77.27424405850007, lat: 28.64931116850005 },
    { wardNo: "231", wardName: "GHONDLI", lng: 77.28357755400006, lat: 28.650217729500042 },
    { wardNo: "232", wardName: "ANARKALI", lng: 77.29007237350007, lat: 28.650296654000044 },
    { wardNo: "233", wardName: "DHARAMPURA", lng: 77.25863133850004, lat: 28.666554539500055 },
    { wardNo: "234", wardName: "GANDHI NAGAR", lng: 77.26007762650005, lat: 28.661375972500053 },
    { wardNo: "235", wardName: "AZAD NAGAR", lng: 77.27870419350006, lat: 28.665407815000066 },
    { wardNo: "236", wardName: "RAGHUBAR PURA", lng: 77.27184106450005, lat: 28.666282593000034 },
    { wardNo: "237", wardName: "SHAHDARA", lng: 77.28696869400008, lat: 28.667961608500036 },
    { wardNo: "238", wardName: "JHILMIL", lng: 77.30268472000003, lat: 28.669266105000048 },
    { wardNo: "239", wardName: "VIVEK VIHAR", lng: 77.31061235250004, lat: 28.675165197500036 },
    { wardNo: "240", wardName: "DILSHAD COLONY", lng: 77.32622058050003, lat: 28.681501905500056 },
    { wardNo: "241", wardName: "DILSHAD GARDEN", lng: 77.31000149800008, lat: 28.684949477500055 },
    { wardNo: "242", wardName: "NEW SEEMA PURI", lng: 77.32383555350006, lat: 28.688188646500038 },
    { wardNo: "243", wardName: "NAND NAGRI", lng: 77.30756257200005, lat: 28.69463467500006 },
    { wardNo: "244", wardName: "SUNDER NAGARI", lng: 77.31693200050003, lat: 28.694611062000064 },
    { wardNo: "245", wardName: "DURGA PURI", lng: 77.29862882650008, lat: 28.68844075900006 },
    { wardNo: "246", wardName: "ASHOK NAGAR", lng: 77.29672889000005, lat: 28.695146820500042 },
    { wardNo: "247", wardName: "RAM NAGAR", lng: 77.29059339650007, lat: 28.678731633500036 },
    { wardNo: "248", wardName: "WELCOME COLONY", lng: 77.28037955150006, lat: 28.67911780350005 },
    { wardNo: "249", wardName: "CHAUHAN BANGER", lng: 77.27113588700004, lat: 28.682427868500042 },
    { wardNo: "250", wardName: "ZAFFRABAD", lng: 77.26716084200004, lat: 28.67431823900003 },
    { wardNo: "251", wardName: "NEW USMANPUR", lng: 77.25843820050008, lat: 28.67822325150007 },
    { wardNo: "252", wardName: "MAUJPUR", lng: 77.27541635950007, lat: 28.689303732500036 },
    { wardNo: "253", wardName: "BHAJANPURA", lng: 77.25856396500006, lat: 28.697680073500038 },
    { wardNo: "254", wardName: "BRAHAM PURI", lng: 77.25795760250006, lat: 28.688153164000056 },
    { wardNo: "255", wardName: "GHONDA", lng: 77.26524293900005, lat: 28.690501515500046 },
    { wardNo: "256", wardName: "YAMUNA VIHAR", lng: 77.27180513250005, lat: 28.699874752000056 },
    { wardNo: "257", wardName: "SUBHASH MOHALLA", lng: 77.27406888700006, lat: 28.69452045050005 },
    { wardNo: "258", wardName: "KARDAM PURI", lng: 77.28429171450006, lat: 28.69389378300005 },
    { wardNo: "259", wardName: "JANTA COLONY", lng: 77.27925216600005, lat: 28.683984365500066 },
    { wardNo: "260", wardName: "BABAR PUR", lng: 77.28541011700005, lat: 28.686998654000064 },
    { wardNo: "261", wardName: "JIWANPUR", lng: 77.28263881450005, lat: 28.71335524850005 },
    { wardNo: "262", wardName: "GOKALPUR", lng: 77.28881024050006, lat: 28.70728502500006 },
    { wardNo: "263", wardName: "SABOLI", lng: 77.30622857400007, lat: 28.706634906000062 },
    { wardNo: "264", wardName: "HARSH VIHAR", lng: 77.31859837550004, lat: 28.705776097500035 },
    { wardNo: "265", wardName: "SHIV VIHAR", lng: 77.27925665800007, lat: 28.725763371000056 },
    { wardNo: "266", wardName: "KARAWAL NAGAR EAST", lng: 77.27201623650006, lat: 28.719394334500066 },
    { wardNo: "267", wardName: "NEHRU VIHAR", lng: 77.26406614650006, lat: 28.708664044000045 },
    { wardNo: "268", wardName: "MUSTAFABAD", lng: 77.26973900700006, lat: 28.709916568500034 },
    { wardNo: "269", wardName: "KHAJOORI KHAS", lng: 77.26077382050005, lat: 28.707962744000042 },
    { wardNo: "270", wardName: "TUKHMIR PUR", lng: 77.26258392600005, lat: 28.71385603400006 },
    { wardNo: "271", wardName: "KARAWAL NAGAR WEST", lng: 77.26758305050004, lat: 28.726637753500057 },
    { wardNo: "272", wardName: "SONIA VIHAR", lng: 77.25078006300006, lat: 28.732074320000066 }
];

// Rainfall Data from deepseek-rainfall-data.txt
const rainfallData = {
    "DEL_CANTT_001": { annual_avg: 679.5, jan_2026: 14, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_CANTT_002": { annual_avg: 679.5, jan_2026: 14, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_CANTT_003": { annual_avg: 679.5, jan_2026: 14, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_CANTT_004": { annual_avg: 679.5, jan_2026: 14, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_CANTT_005": { annual_avg: 679.5, jan_2026: 14, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_CANTT_006": { annual_avg: 679.5, jan_2026: 14, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_CANTT_007": { annual_avg: 679.5, jan_2026: 14, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_CANTT_008": { annual_avg: 679.5, jan_2026: 14, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_NDMC_001": { annual_avg: 705.3, jan_2026: 19.2, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_NDMC_002": { annual_avg: 705.3, jan_2026: 19.2, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_NDMC_003": { annual_avg: 705.3, jan_2026: 19.2, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_NDMC_004": { annual_avg: 705.3, jan_2026: 19.2, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_NDMC_005": { annual_avg: 705.3, jan_2026: 19.2, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_NDMC_006": { annual_avg: 705.3, jan_2026: 19.2, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_NDMC_007": { annual_avg: 705.3, jan_2026: 19.2, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_NDMC_008": { annual_avg: 705.3, jan_2026: 19.2, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_NDMC_009": { annual_avg: 705.3, jan_2026: 19.2, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_080": { annual_avg: 724.8, jan_2026: 24.5, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_081": { annual_avg: 724.8, jan_2026: 24.5, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_082": { annual_avg: 724.8, jan_2026: 24.5, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_083": { annual_avg: 724.8, jan_2026: 24.5, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_084": { annual_avg: 724.8, jan_2026: 24.5, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_085": { annual_avg: 724.8, jan_2026: 24.5, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_086": { annual_avg: 724.8, jan_2026: 24.5, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_087": { annual_avg: 724.8, jan_2026: 24.5, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_088": { annual_avg: 724.8, jan_2026: 24.5, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_089": { annual_avg: 724.8, jan_2026: 24.5, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_090": { annual_avg: 724.8, jan_2026: 24.5, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_091": { annual_avg: 724.8, jan_2026: 24.5, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_092": { annual_avg: 724.8, jan_2026: 24.5, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_093": { annual_avg: 692.4, jan_2026: 17, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_094": { annual_avg: 692.4, jan_2026: 17, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_095": { annual_avg: 692.4, jan_2026: 17, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_096": { annual_avg: 692.4, jan_2026: 17, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_097": { annual_avg: 692.4, jan_2026: 17, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_098": { annual_avg: 692.4, jan_2026: 17, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_099": { annual_avg: 692.4, jan_2026: 17, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_100": { annual_avg: 692.4, jan_2026: 17, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_101": { annual_avg: 692.4, jan_2026: 17, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_102": { annual_avg: 692.4, jan_2026: 17, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_103": { annual_avg: 692.4, jan_2026: 17, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_104": { annual_avg: 692.4, jan_2026: 17, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_105": { annual_avg: 692.4, jan_2026: 17, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_106": { annual_avg: 692.4, jan_2026: 17, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_107": { annual_avg: 692.4, jan_2026: 17, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_108": { annual_avg: 692.4, jan_2026: 17, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_109": { annual_avg: 692.4, jan_2026: 17, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_110": { annual_avg: 692.4, jan_2026: 17, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_111": { annual_avg: 692.4, jan_2026: 17, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_112": { annual_avg: 692.4, jan_2026: 17, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_113": { annual_avg: 692.4, jan_2026: 17, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_114": { annual_avg: 692.4, jan_2026: 17, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_115": { annual_avg: 692.4, jan_2026: 17, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_116": { annual_avg: 692.4, jan_2026: 17, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_117": { annual_avg: 692.4, jan_2026: 17, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_118": { annual_avg: 692.4, jan_2026: 17, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_119": { annual_avg: 692.4, jan_2026: 17, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_120": { annual_avg: 692.4, jan_2026: 17, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_121": { annual_avg: 692.4, jan_2026: 17, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_122": { annual_avg: 692.4, jan_2026: 17, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_123": { annual_avg: 692.4, jan_2026: 17, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_124": { annual_avg: 692.4, jan_2026: 17, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_125": { annual_avg: 692.4, jan_2026: 17, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_126": { annual_avg: 692.4, jan_2026: 17, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_127": { annual_avg: 692.4, jan_2026: 17, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_128": { annual_avg: 692.4, jan_2026: 17, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_129": { annual_avg: 692.4, jan_2026: 17, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_130": { annual_avg: 692.4, jan_2026: 17, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_131": { annual_avg: 679.5, jan_2026: 14, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_132": { annual_avg: 679.5, jan_2026: 14, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_133": { annual_avg: 679.5, jan_2026: 14, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_134": { annual_avg: 679.5, jan_2026: 14, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_135": { annual_avg: 679.5, jan_2026: 14, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_136": { annual_avg: 679.5, jan_2026: 14, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_137": { annual_avg: 679.5, jan_2026: 14, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_138": { annual_avg: 679.5, jan_2026: 14, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_139": { annual_avg: 679.5, jan_2026: 14, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_140": { annual_avg: 679.5, jan_2026: 14, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_141": { annual_avg: 679.5, jan_2026: 14, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_142": { annual_avg: 679.5, jan_2026: 14, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_143": { annual_avg: 710.2, jan_2026: 15.7, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_144": { annual_avg: 710.2, jan_2026: 15.7, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_145": { annual_avg: 679.5, jan_2026: 14, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_146": { annual_avg: 679.5, jan_2026: 14, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_147": { annual_avg: 679.5, jan_2026: 14, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_148": { annual_avg: 679.5, jan_2026: 14, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_149": { annual_avg: 724.8, jan_2026: 24.5, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_150": { annual_avg: 645.8, jan_2026: 11, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_151": { annual_avg: 645.8, jan_2026: 11, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_152": { annual_avg: 645.8, jan_2026: 11, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_153": { annual_avg: 715.1, jan_2026: 19, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_154": { annual_avg: 715.1, jan_2026: 19, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_155": { annual_avg: 720.9, jan_2026: 20.4, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_156": { annual_avg: 720.9, jan_2026: 20.4, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_157": { annual_avg: 720.9, jan_2026: 20.4, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_158": { annual_avg: 710.2, jan_2026: 15.7, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_159": { annual_avg: 710.2, jan_2026: 15.7, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_160": { annual_avg: 720.9, jan_2026: 20.4, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_161": { annual_avg: 710.2, jan_2026: 15.7, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_162": { annual_avg: 710.2, jan_2026: 15.7, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_163": { annual_avg: 710.2, jan_2026: 15.7, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_164": { annual_avg: 710.2, jan_2026: 15.7, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_165": { annual_avg: 710.2, jan_2026: 15.7, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_166": { annual_avg: 710.2, jan_2026: 15.7, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_167": { annual_avg: 710.2, jan_2026: 15.7, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_168": { annual_avg: 710.2, jan_2026: 15.7, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_169": { annual_avg: 710.2, jan_2026: 15.7, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_170": { annual_avg: 710.2, jan_2026: 15.7, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_171": { annual_avg: 710.2, jan_2026: 15.7, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_172": { annual_avg: 710.2, jan_2026: 15.7, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_173": { annual_avg: 710.2, jan_2026: 15.7, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_174": { annual_avg: 710.2, jan_2026: 15.7, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_175": { annual_avg: 710.2, jan_2026: 15.7, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_176": { annual_avg: 710.2, jan_2026: 15.7, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_177": { annual_avg: 710.2, jan_2026: 15.7, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_178": { annual_avg: 720.9, jan_2026: 20.4, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_179": { annual_avg: 720.9, jan_2026: 20.4, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_180": { annual_avg: 720.9, jan_2026: 20.4, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_181": { annual_avg: 720.9, jan_2026: 20.4, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_182": { annual_avg: 720.9, jan_2026: 20.4, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_183": { annual_avg: 720.9, jan_2026: 20.4, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_184": { annual_avg: 720.9, jan_2026: 20.4, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_185": { annual_avg: 720.9, jan_2026: 20.4, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_186": { annual_avg: 720.9, jan_2026: 20.4, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_187": { annual_avg: 720.9, jan_2026: 20.4, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_188": { annual_avg: 720.9, jan_2026: 20.4, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_189": { annual_avg: 720.9, jan_2026: 20.4, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_190": { annual_avg: 720.9, jan_2026: 20.4, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_191": { annual_avg: 710.2, jan_2026: 15.7, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_192": { annual_avg: 710.2, jan_2026: 15.7, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_193": { annual_avg: 720.9, jan_2026: 20.4, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_194": { annual_avg: 720.9, jan_2026: 20.4, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_195": { annual_avg: 720.9, jan_2026: 20.4, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_196": { annual_avg: 720.9, jan_2026: 20.4, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_197": { annual_avg: 720.9, jan_2026: 20.4, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_198": { annual_avg: 720.9, jan_2026: 20.4, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_199": { annual_avg: 720.9, jan_2026: 20.4, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_200": { annual_avg: 720.9, jan_2026: 20.4, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_201": { annual_avg: 720.9, jan_2026: 20.4, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_202": { annual_avg: 720.9, jan_2026: 20.4, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_203": { annual_avg: 720.9, jan_2026: 20.4, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_204": { annual_avg: 720.9, jan_2026: 20.4, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_205": { annual_avg: 720.9, jan_2026: 20.4, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_206": { annual_avg: 720.9, jan_2026: 20.4, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_207": { annual_avg: 720.9, jan_2026: 20.4, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_208": { annual_avg: 720.9, jan_2026: 20.4, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_209": { annual_avg: 715.1, jan_2026: 19, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_210": { annual_avg: 715.1, jan_2026: 19, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_211": { annual_avg: 715.1, jan_2026: 19, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_212": { annual_avg: 715.1, jan_2026: 19, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_213": { annual_avg: 715.1, jan_2026: 19, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_214": { annual_avg: 715.1, jan_2026: 19, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_215": { annual_avg: 715.1, jan_2026: 19, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_216": { annual_avg: 715.1, jan_2026: 19, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_217": { annual_avg: 715.1, jan_2026: 19, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_218": { annual_avg: 715.1, jan_2026: 19, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_219": { annual_avg: 715.1, jan_2026: 19, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_220": { annual_avg: 715.1, jan_2026: 19, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_221": { annual_avg: 715.1, jan_2026: 19, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_222": { annual_avg: 715.1, jan_2026: 19, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_223": { annual_avg: 715.1, jan_2026: 19, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_224": { annual_avg: 715.1, jan_2026: 19, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_225": { annual_avg: 715.1, jan_2026: 19, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_226": { annual_avg: 715.1, jan_2026: 19, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_227": { annual_avg: 715.1, jan_2026: 19, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_228": { annual_avg: 715.1, jan_2026: 19, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_229": { annual_avg: 698.7, jan_2026: 20.2, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_230": { annual_avg: 698.7, jan_2026: 20.2, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_231": { annual_avg: 698.7, jan_2026: 20.2, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_232": { annual_avg: 698.7, jan_2026: 20.2, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_233": { annual_avg: 698.7, jan_2026: 20.2, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_234": { annual_avg: 698.7, jan_2026: 20.2, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_235": { annual_avg: 698.7, jan_2026: 20.2, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_236": { annual_avg: 698.7, jan_2026: 20.2, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_237": { annual_avg: 698.7, jan_2026: 20.2, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_238": { annual_avg: 698.7, jan_2026: 20.2, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_239": { annual_avg: 698.7, jan_2026: 20.2, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_240": { annual_avg: 698.7, jan_2026: 20.2, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_241": { annual_avg: 698.7, jan_2026: 20.2, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_242": { annual_avg: 698.7, jan_2026: 20.2, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_243": { annual_avg: 698.7, jan_2026: 20.2, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_244": { annual_avg: 698.7, jan_2026: 20.2, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_245": { annual_avg: 698.7, jan_2026: 20.2, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_246": { annual_avg: 698.7, jan_2026: 20.2, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_247": { annual_avg: 698.7, jan_2026: 20.2, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_248": { annual_avg: 698.7, jan_2026: 20.2, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_249": { annual_avg: 698.7, jan_2026: 20.2, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_250": { annual_avg: 698.7, jan_2026: 20.2, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_251": { annual_avg: 698.7, jan_2026: 20.2, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_252": { annual_avg: 698.7, jan_2026: 20.2, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_253": { annual_avg: 698.7, jan_2026: 20.2, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_254": { annual_avg: 698.7, jan_2026: 20.2, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_255": { annual_avg: 698.7, jan_2026: 20.2, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_256": { annual_avg: 698.7, jan_2026: 20.2, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_257": { annual_avg: 698.7, jan_2026: 20.2, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_258": { annual_avg: 698.7, jan_2026: 20.2, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_259": { annual_avg: 698.7, jan_2026: 20.2, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_260": { annual_avg: 698.7, jan_2026: 20.2, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_261": { annual_avg: 631.5, jan_2026: 15, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_262": { annual_avg: 631.5, jan_2026: 15, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_263": { annual_avg: 631.5, jan_2026: 15, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_264": { annual_avg: 631.5, jan_2026: 15, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_265": { annual_avg: 631.5, jan_2026: 15, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_266": { annual_avg: 631.5, jan_2026: 15, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_267": { annual_avg: 631.5, jan_2026: 15, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_268": { annual_avg: 631.5, jan_2026: 15, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_269": { annual_avg: 631.5, jan_2026: 15, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_270": { annual_avg: 631.5, jan_2026: 15, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_271": { annual_avg: 631.5, jan_2026: 15, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_272": { annual_avg: 631.5, jan_2026: 15, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_001": { annual_avg: 631.5, jan_2026: 15, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_002": { annual_avg: 645.8, jan_2026: 11, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_003": { annual_avg: 645.8, jan_2026: 11, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_004": { annual_avg: 631.5, jan_2026: 15, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_005": { annual_avg: 631.5, jan_2026: 15, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_006": { annual_avg: 631.5, jan_2026: 15, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_007": { annual_avg: 631.5, jan_2026: 15, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_008": { annual_avg: 631.5, jan_2026: 15, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_009": { annual_avg: 645.8, jan_2026: 11, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_010": { annual_avg: 631.5, jan_2026: 15, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_011": { annual_avg: 631.5, jan_2026: 15, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_012": { annual_avg: 631.5, jan_2026: 15, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_013": { annual_avg: 631.5, jan_2026: 15, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_014": { annual_avg: 645.8, jan_2026: 11, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_015": { annual_avg: 645.8, jan_2026: 11, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_016": { annual_avg: 645.8, jan_2026: 11, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_017": { annual_avg: 645.8, jan_2026: 11, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_018": { annual_avg: 645.8, jan_2026: 11, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_019": { annual_avg: 631.5, jan_2026: 15, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_020": { annual_avg: 645.8, jan_2026: 11, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_021": { annual_avg: 645.8, jan_2026: 11, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_022": { annual_avg: 645.8, jan_2026: 11, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_023": { annual_avg: 645.8, jan_2026: 11, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_024": { annual_avg: 645.8, jan_2026: 11, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_025": { annual_avg: 645.8, jan_2026: 11, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_026": { annual_avg: 645.8, jan_2026: 11, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_027": { annual_avg: 645.8, jan_2026: 11, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_028": { annual_avg: 645.8, jan_2026: 11, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_029": { annual_avg: 645.8, jan_2026: 11, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_030": { annual_avg: 645.8, jan_2026: 11, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_031": { annual_avg: 645.8, jan_2026: 11, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_032": { annual_avg: 645.8, jan_2026: 11, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_033": { annual_avg: 645.8, jan_2026: 11, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_034": { annual_avg: 645.8, jan_2026: 11, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_035": { annual_avg: 645.8, jan_2026: 11, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_036": { annual_avg: 645.8, jan_2026: 11, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_037": { annual_avg: 645.8, jan_2026: 11, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_038": { annual_avg: 645.8, jan_2026: 11, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_039": { annual_avg: 645.8, jan_2026: 11, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_040": { annual_avg: 645.8, jan_2026: 11, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_041": { annual_avg: 645.8, jan_2026: 11, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_042": { annual_avg: 645.8, jan_2026: 11, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_043": { annual_avg: 645.8, jan_2026: 11, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_044": { annual_avg: 645.8, jan_2026: 11, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_045": { annual_avg: 645.8, jan_2026: 11, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_046": { annual_avg: 645.8, jan_2026: 11, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_047": { annual_avg: 645.8, jan_2026: 11, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_048": { annual_avg: 645.8, jan_2026: 11, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_049": { annual_avg: 645.8, jan_2026: 11, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_050": { annual_avg: 645.8, jan_2026: 11, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_051": { annual_avg: 645.8, jan_2026: 11, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_052": { annual_avg: 645.8, jan_2026: 11, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_053": { annual_avg: 645.8, jan_2026: 11, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_054": { annual_avg: 645.8, jan_2026: 11, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_055": { annual_avg: 645.8, jan_2026: 11, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_056": { annual_avg: 645.8, jan_2026: 11, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_057": { annual_avg: 645.8, jan_2026: 11, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_058": { annual_avg: 645.8, jan_2026: 11, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_059": { annual_avg: 645.8, jan_2026: 11, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_060": { annual_avg: 645.8, jan_2026: 11, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_061": { annual_avg: 645.8, jan_2026: 11, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_062": { annual_avg: 645.8, jan_2026: 11, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_063": { annual_avg: 645.8, jan_2026: 11, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_064": { annual_avg: 645.8, jan_2026: 11, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_065": { annual_avg: 645.8, jan_2026: 11, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_066": { annual_avg: 645.8, jan_2026: 11, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_067": { annual_avg: 645.8, jan_2026: 11, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
    "DEL_068": { annual_avg: 645.8, jan_2026: 11, normal_jan: 19, normal_feb: 20, normal_mar: 15 },
};

// Drainage Data from deepseek-drainage-data.txt
const drainageData = {
    "DEL_CANTT_001": { capacity_score: 78, flood_risk: 32, flood_events: 2, system_age: 35, sewage_coverage: 85, drainage_length: null },
    "DEL_CANTT_002": { capacity_score: 75, flood_risk: 34, flood_events: 3, system_age: 32, sewage_coverage: 82, drainage_length: null },
    "DEL_CANTT_003": { capacity_score: 80, flood_risk: 30, flood_events: 1, system_age: 38, sewage_coverage: 88, drainage_length: null },
    "DEL_CANTT_004": { capacity_score: 72, flood_risk: 36, flood_events: 4, system_age: 30, sewage_coverage: 80, drainage_length: null },
    "DEL_CANTT_005": { capacity_score: 77, flood_risk: 33, flood_events: 2, system_age: 34, sewage_coverage: 84, drainage_length: null },
    "DEL_CANTT_006": { capacity_score: 70, flood_risk: 38, flood_events: 5, system_age: 28, sewage_coverage: 78, drainage_length: null },
    "DEL_CANTT_007": { capacity_score: 76, flood_risk: 34, flood_events: 3, system_age: 33, sewage_coverage: 83, drainage_length: null },
    "DEL_CANTT_008": { capacity_score: 79, flood_risk: 31, flood_events: 2, system_age: 36, sewage_coverage: 87, drainage_length: null },
    "DEL_NDMC_001": { capacity_score: 85, flood_risk: 28, flood_events: 1, system_age: 42, sewage_coverage: 92, drainage_length: null },
    "DEL_NDMC_002": { capacity_score: 88, flood_risk: 25, flood_events: 1, system_age: 45, sewage_coverage: 94, drainage_length: null },
    "DEL_NDMC_003": { capacity_score: 83, flood_risk: 29, flood_events: 2, system_age: 40, sewage_coverage: 90, drainage_length: null },
    "DEL_NDMC_004": { capacity_score: 86, flood_risk: 27, flood_events: 1, system_age: 43, sewage_coverage: 93, drainage_length: null },
    "DEL_NDMC_005": { capacity_score: 87, flood_risk: 26, flood_events: 1, system_age: 44, sewage_coverage: 93, drainage_length: null },
    "DEL_NDMC_006": { capacity_score: 84, flood_risk: 28, flood_events: 2, system_age: 41, sewage_coverage: 91, drainage_length: null },
    "DEL_NDMC_007": { capacity_score: 82, flood_risk: 30, flood_events: 2, system_age: 39, sewage_coverage: 89, drainage_length: null },
    "DEL_NDMC_008": { capacity_score: 81, flood_risk: 31, flood_events: 2, system_age: 38, sewage_coverage: 88, drainage_length: null },
    "DEL_NDMC_009": { capacity_score: 83, flood_risk: 29, flood_events: 2, system_age: 40, sewage_coverage: 90, drainage_length: null },
    "DEL_080": { capacity_score: 65, flood_risk: 42, flood_events: 6, system_age: 55, sewage_coverage: 72, drainage_length: null },
    "DEL_081": { capacity_score: 68, flood_risk: 40, flood_events: 5, system_age: 50, sewage_coverage: 75, drainage_length: null },
    "DEL_082": { capacity_score: 63, flood_risk: 45, flood_events: 7, system_age: 58, sewage_coverage: 70, drainage_length: null },
    "DEL_083": { capacity_score: 64, flood_risk: 43, flood_events: 6, system_age: 56, sewage_coverage: 71, drainage_length: null },
    "DEL_084": { capacity_score: 62, flood_risk: 46, flood_events: 8, system_age: 60, sewage_coverage: 68, drainage_length: null },
    "DEL_085": { capacity_score: 66, flood_risk: 41, flood_events: 5, system_age: 52, sewage_coverage: 73, drainage_length: null },
    "DEL_086": { capacity_score: 61, flood_risk: 47, flood_events: 8, system_age: 62, sewage_coverage: 67, drainage_length: null },
    "DEL_087": { capacity_score: 63, flood_risk: 44, flood_events: 7, system_age: 57, sewage_coverage: 69, drainage_length: null },
    "DEL_088": { capacity_score: 60, flood_risk: 48, flood_events: 9, system_age: 65, sewage_coverage: 65, drainage_length: null },
    "DEL_089": { capacity_score: 67, flood_risk: 39, flood_events: 4, system_age: 48, sewage_coverage: 74, drainage_length: null },
    "DEL_090": { capacity_score: 69, flood_risk: 38, flood_events: 4, system_age: 46, sewage_coverage: 76, drainage_length: null },
    "DEL_091": { capacity_score: 71, flood_risk: 37, flood_events: 3, system_age: 42, sewage_coverage: 78, drainage_length: null },
    "DEL_092": { capacity_score: 73, flood_risk: 36, flood_events: 3, system_age: 40, sewage_coverage: 79, drainage_length: null },
    "DEL_093": { capacity_score: 68, flood_risk: 41, flood_events: 5, system_age: 45, sewage_coverage: 75, drainage_length: null },
    "DEL_094": { capacity_score: 72, flood_risk: 39, flood_events: 4, system_age: 42, sewage_coverage: 78, drainage_length: null },
    "DEL_095": { capacity_score: 75, flood_risk: 37, flood_events: 3, system_age: 38, sewage_coverage: 82, drainage_length: null },
    "DEL_096": { capacity_score: 70, flood_risk: 40, flood_events: 4, system_age: 44, sewage_coverage: 76, drainage_length: null },
    "DEL_097": { capacity_score: 74, flood_risk: 38, flood_events: 3, system_age: 39, sewage_coverage: 80, drainage_length: null },
    "DEL_098": { capacity_score: 71, flood_risk: 41, flood_events: 4, system_age: 43, sewage_coverage: 77, drainage_length: null },
    "DEL_099": { capacity_score: 76, flood_risk: 36, flood_events: 2, system_age: 36, sewage_coverage: 83, drainage_length: null },
    "DEL_100": { capacity_score: 73, flood_risk: 40, flood_events: 3, system_age: 41, sewage_coverage: 79, drainage_length: null },
    "DEL_101": { capacity_score: 69, flood_risk: 42, flood_events: 5, system_age: 46, sewage_coverage: 75, drainage_length: null },
    "DEL_102": { capacity_score: 67, flood_risk: 44, flood_events: 6, system_age: 49, sewage_coverage: 73, drainage_length: null },
    "DEL_103": { capacity_score: 78, flood_risk: 35, flood_events: 2, system_age: 34, sewage_coverage: 85, drainage_length: null },
    "DEL_104": { capacity_score: 65, flood_risk: 46, flood_events: 7, system_age: 53, sewage_coverage: 71, drainage_length: null },
    "DEL_105": { capacity_score: 77, flood_risk: 36, flood_events: 2, system_age: 35, sewage_coverage: 84, drainage_length: null },
    "DEL_106": { capacity_score: 74, flood_risk: 39, flood_events: 3, system_age: 40, sewage_coverage: 81, drainage_length: null },
    "DEL_107": { capacity_score: 70, flood_risk: 43, flood_events: 5, system_age: 45, sewage_coverage: 76, drainage_length: null },
    "DEL_108": { capacity_score: 68, flood_risk: 45, flood_events: 6, system_age: 48, sewage_coverage: 74, drainage_length: null },
    "DEL_109": { capacity_score: 72, flood_risk: 41, flood_events: 4, system_age: 43, sewage_coverage: 79, drainage_length: null },
    "DEL_110": { capacity_score: 71, flood_risk: 42, flood_events: 4, system_age: 44, sewage_coverage: 78, drainage_length: null },
    "DEL_111": { capacity_score: 69, flood_risk: 44, flood_events: 5, system_age: 47, sewage_coverage: 75, drainage_length: null },
    "DEL_112": { capacity_score: 73, flood_risk: 40, flood_events: 3, system_age: 41, sewage_coverage: 80, drainage_length: null },
    "DEL_113": { capacity_score: 66, flood_risk: 47, flood_events: 7, system_age: 52, sewage_coverage: 72, drainage_length: null },
    "DEL_114": { capacity_score: 70, flood_risk: 43, flood_events: 5, system_age: 46, sewage_coverage: 77, drainage_length: null },
    "DEL_115": { capacity_score: 68, flood_risk: 46, flood_events: 6, system_age: 49, sewage_coverage: 74, drainage_length: null },
    "DEL_116": { capacity_score: 65, flood_risk: 48, flood_events: 8, system_age: 55, sewage_coverage: 70, drainage_length: null },
    "DEL_117": { capacity_score: 71, flood_risk: 42, flood_events: 4, system_age: 45, sewage_coverage: 78, drainage_length: null },
    "DEL_118": { capacity_score: 72, flood_risk: 41, flood_events: 3, system_age: 42, sewage_coverage: 79, drainage_length: null },
    "DEL_119": { capacity_score: 63, flood_risk: 50, flood_events: 9, system_age: 60, sewage_coverage: 68, drainage_length: null },
    "DEL_120": { capacity_score: 69, flood_risk: 44, flood_events: 6, system_age: 48, sewage_coverage: 76, drainage_length: null },
    "DEL_121": { capacity_score: 60, flood_risk: 52, flood_events: 10, system_age: 65, sewage_coverage: 65, drainage_length: null },
    "DEL_122": { capacity_score: 58, flood_risk: 54, flood_events: 11, system_age: 68, sewage_coverage: 63, drainage_length: null },
    "DEL_123": { capacity_score: 64, flood_risk: 49, flood_events: 8, system_age: 58, sewage_coverage: 69, drainage_length: null },
    "DEL_124": { capacity_score: 62, flood_risk: 51, flood_events: 9, system_age: 62, sewage_coverage: 67, drainage_length: null },
    "DEL_125": { capacity_score: 59, flood_risk: 53, flood_events: 10, system_age: 66, sewage_coverage: 64, drainage_length: null },
    "DEL_126": { capacity_score: 61, flood_risk: 52, flood_events: 9, system_age: 63, sewage_coverage: 66, drainage_length: null },
    "DEL_127": { capacity_score: 63, flood_risk: 50, flood_events: 8, system_age: 59, sewage_coverage: 68, drainage_length: null },
    "DEL_128": { capacity_score: 67, flood_risk: 47, flood_events: 7, system_age: 51, sewage_coverage: 73, drainage_length: null },
    "DEL_129": { capacity_score: 70, flood_risk: 44, flood_events: 6, system_age: 47, sewage_coverage: 76, drainage_length: null },
    "DEL_130": { capacity_score: 66, flood_risk: 48, flood_events: 7, system_age: 53, sewage_coverage: 72, drainage_length: null },
    "DEL_131": { capacity_score: 74, flood_risk: 36, flood_events: 3, system_age: 39, sewage_coverage: 81, drainage_length: null },
    "DEL_132": { capacity_score: 73, flood_risk: 37, flood_events: 3, system_age: 40, sewage_coverage: 80, drainage_length: null },
    "DEL_133": { capacity_score: 55, flood_risk: 58, flood_events: 12, system_age: 72, sewage_coverage: 60, drainage_length: null },
    "DEL_134": { capacity_score: 57, flood_risk: 56, flood_events: 11, system_age: 70, sewage_coverage: 62, drainage_length: null },
    "DEL_135": { capacity_score: 60, flood_risk: 53, flood_events: 10, system_age: 66, sewage_coverage: 65, drainage_length: null },
    "DEL_136": { capacity_score: 62, flood_risk: 50, flood_events: 9, system_age: 62, sewage_coverage: 67, drainage_length: null },
    "DEL_137": { capacity_score: 58, flood_risk: 55, flood_events: 11, system_age: 68, sewage_coverage: 63, drainage_length: null },
    "DEL_138": { capacity_score: 56, flood_risk: 57, flood_events: 12, system_age: 70, sewage_coverage: 61, drainage_length: null },
    "DEL_139": { capacity_score: 53, flood_risk: 59, flood_events: 13, system_age: 75, sewage_coverage: 58, drainage_length: null },
    "DEL_140": { capacity_score: 50, flood_risk: 62, flood_events: 14, system_age: 78, sewage_coverage: 55, drainage_length: null },
    "DEL_141": { capacity_score: 61, flood_risk: 51, flood_events: 10, system_age: 64, sewage_coverage: 66, drainage_length: null },
    "DEL_142": { capacity_score: 68, flood_risk: 45, flood_events: 6, system_age: 49, sewage_coverage: 74, drainage_length: null },
    "DEL_143": { capacity_score: 72, flood_risk: 38, flood_events: 3, system_age: 41, sewage_coverage: 79, drainage_length: null },
    "DEL_144": { capacity_score: 75, flood_risk: 35, flood_events: 2, system_age: 37, sewage_coverage: 82, drainage_length: null },
    "DEL_145": { capacity_score: 71, flood_risk: 40, flood_events: 4, system_age: 44, sewage_coverage: 77, drainage_length: null },
    "DEL_146": { capacity_score: 70, flood_risk: 41, flood_events: 5, system_age: 46, sewage_coverage: 76, drainage_length: null },
    "DEL_147": { capacity_score: 65, flood_risk: 47, flood_events: 7, system_age: 54, sewage_coverage: 71, drainage_length: null },
    "DEL_148": { capacity_score: 67, flood_risk: 46, flood_events: 6, system_age: 50, sewage_coverage: 73, drainage_length: null },
    "DEL_149": { capacity_score: 78, flood_risk: 33, flood_events: 2, system_age: 35, sewage_coverage: 85, drainage_length: null },
    "DEL_150": { capacity_score: 76, flood_risk: 34, flood_events: 2, system_age: 36, sewage_coverage: 83, drainage_length: null },
    "DEL_151": { capacity_score: 77, flood_risk: 33, flood_events: 2, system_age: 35, sewage_coverage: 84, drainage_length: null },
    "DEL_152": { capacity_score: 75, flood_risk: 35, flood_events: 2, system_age: 37, sewage_coverage: 82, drainage_length: null },
    "DEL_153": { capacity_score: 62, flood_risk: 45, flood_events: 7, system_age: 58, sewage_coverage: 70, drainage_length: null },
    "DEL_154": { capacity_score: 68, flood_risk: 40, flood_events: 5, system_age: 50, sewage_coverage: 75, drainage_length: null },
    "DEL_155": { capacity_score: 80, flood_risk: 30, flood_events: 1, system_age: 38, sewage_coverage: 88, drainage_length: null },
    "DEL_156": { capacity_score: 82, flood_risk: 28, flood_events: 1, system_age: 36, sewage_coverage: 90, drainage_length: null },
    "DEL_157": { capacity_score: 79, flood_risk: 31, flood_events: 2, system_age: 39, sewage_coverage: 87, drainage_length: null },
    "DEL_158": { capacity_score: 77, flood_risk: 32, flood_events: 2, system_age: 37, sewage_coverage: 85, drainage_length: null },
    "DEL_159": { capacity_score: 78, flood_risk: 31, flood_events: 2, system_age: 36, sewage_coverage: 86, drainage_length: null },
    "DEL_160": { capacity_score: 81, flood_risk: 29, flood_events: 1, system_age: 37, sewage_coverage: 89, drainage_length: null },
    "DEL_161": { capacity_score: 74, flood_risk: 36, flood_events: 3, system_age: 40, sewage_coverage: 81, drainage_length: null },
    "DEL_162": { capacity_score: 73, flood_risk: 37, flood_events: 3, system_age: 41, sewage_coverage: 80, drainage_length: null },
    "DEL_163": { capacity_score: 79, flood_risk: 30, flood_events: 2, system_age: 38, sewage_coverage: 87, drainage_length: null },
    "DEL_164": { capacity_score: 80, flood_risk: 29, flood_events: 1, system_age: 37, sewage_coverage: 88, drainage_length: null },
    "DEL_165": { capacity_score: 82, flood_risk: 27, flood_events: 1, system_age: 35, sewage_coverage: 90, drainage_length: null },
    "DEL_166": { capacity_score: 78, flood_risk: 31, flood_events: 2, system_age: 36, sewage_coverage: 86, drainage_length: null },
    "DEL_167": { capacity_score: 81, flood_risk: 28, flood_events: 1, system_age: 36, sewage_coverage: 89, drainage_length: null },
    "DEL_168": { capacity_score: 76, flood_risk: 33, flood_events: 2, system_age: 37, sewage_coverage: 84, drainage_length: null },
    "DEL_169": { capacity_score: 70, flood_risk: 42, flood_events: 4, system_age: 46, sewage_coverage: 77, drainage_length: null },
    "DEL_170": { capacity_score: 68, flood_risk: 45, flood_events: 6, system_age: 50, sewage_coverage: 75, drainage_length: null },
    "DEL_171": { capacity_score: 72, flood_risk: 40, flood_events: 3, system_age: 43, sewage_coverage: 79, drainage_length: null },
    "DEL_172": { capacity_score: 65, flood_risk: 48, flood_events: 7, system_age: 55, sewage_coverage: 72, drainage_length: null },
    "DEL_173": { capacity_score: 63, flood_risk: 51, flood_events: 8, system_age: 60, sewage_coverage: 69, drainage_length: null },
    "DEL_174": { capacity_score: 61, flood_risk: 53, flood_events: 9, system_age: 63, sewage_coverage: 67, drainage_length: null },
    "DEL_175": { capacity_score: 58, flood_risk: 56, flood_events: 10, system_age: 68, sewage_coverage: 63, drainage_length: null },
    "DEL_176": { capacity_score: 57, flood_risk: 57, flood_events: 11, system_age: 70, sewage_coverage: 62, drainage_length: null },
    "DEL_177": { capacity_score: 60, flood_risk: 55, flood_events: 10, system_age: 65, sewage_coverage: 65, drainage_length: null },
    "DEL_178": { capacity_score: 52, flood_risk: 62, flood_events: 13, system_age: 76, sewage_coverage: 57, drainage_length: null },
    "DEL_179": { capacity_score: 55, flood_risk: 60, flood_events: 12, system_age: 73, sewage_coverage: 60, drainage_length: null },
    "DEL_180": { capacity_score: 58, flood_risk: 58, flood_events: 11, system_age: 69, sewage_coverage: 63, drainage_length: null },
    "DEL_181": { capacity_score: 60, flood_risk: 56, flood_events: 10, system_age: 66, sewage_coverage: 65, drainage_length: null },
    "DEL_182": { capacity_score: 62, flood_risk: 53, flood_events: 9, system_age: 63, sewage_coverage: 67, drainage_length: null },
    "DEL_183": { capacity_score: 64, flood_risk: 51, flood_events: 8, system_age: 60, sewage_coverage: 69, drainage_length: null },
    "DEL_184": { capacity_score: 66, flood_risk: 48, flood_events: 7, system_age: 54, sewage_coverage: 72, drainage_length: null },
    "DEL_185": { capacity_score: 68, flood_risk: 46, flood_events: 6, system_age: 50, sewage_coverage: 74, drainage_length: null },
    "DEL_186": { capacity_score: 54, flood_risk: 61, flood_events: 12, system_age: 74, sewage_coverage: 59, drainage_length: null },
    "DEL_187": { capacity_score: 53, flood_risk: 63, flood_events: 13, system_age: 76, sewage_coverage: 58, drainage_length: null },
    "DEL_188": { capacity_score: 56, flood_risk: 59, flood_events: 11, system_age: 71, sewage_coverage: 61, drainage_length: null },
    "DEL_189": { capacity_score: 75, flood_risk: 34, flood_events: 2, system_age: 38, sewage_coverage: 82, drainage_length: null },
    "DEL_190": { capacity_score: 78, flood_risk: 31, flood_events: 2, system_age: 36, sewage_coverage: 85, drainage_length: null },
    "DEL_191": { capacity_score: 71, flood_risk: 41, flood_events: 4, system_age: 44, sewage_coverage: 78, drainage_length: null },
    "DEL_192": { capacity_score: 83, flood_risk: 28, flood_events: 1, system_age: 39, sewage_coverage: 91, drainage_length: null },
    "DEL_193": { capacity_score: 80, flood_risk: 30, flood_events: 1, system_age: 38, sewage_coverage: 88, drainage_length: null },
    "DEL_194": { capacity_score: 79, flood_risk: 29, flood_events: 1, system_age: 37, sewage_coverage: 87, drainage_length: null },
    "DEL_195": { capacity_score: 77, flood_risk: 32, flood_events: 2, system_age: 39, sewage_coverage: 86, drainage_length: null },
    "DEL_196": { capacity_score: 81, flood_risk: 28, flood_events: 1, system_age: 36, sewage_coverage: 89, drainage_length: null },
    "DEL_197": { capacity_score: 65, flood_risk: 49, flood_events: 8, system_age: 56, sewage_coverage: 71, drainage_length: null },
    "DEL_198": { capacity_score: 62, flood_risk: 52, flood_events: 9, system_age: 62, sewage_coverage: 67, drainage_length: null },
    "DEL_199": { capacity_score: 68, flood_risk: 47, flood_events: 7, system_age: 51, sewage_coverage: 74, drainage_length: null },
    "DEL_200": { capacity_score: 73, flood_risk: 40, flood_events: 3, system_age: 42, sewage_coverage: 80, drainage_length: null },
    "DEL_201": { capacity_score: 70, flood_risk: 44, flood_events: 5, system_age: 48, sewage_coverage: 76, drainage_length: null },
    "DEL_202": { capacity_score: 66, flood_risk: 50, flood_events: 8, system_age: 54, sewage_coverage: 72, drainage_length: null },
    "DEL_203": { capacity_score: 64, flood_risk: 52, flood_events: 9, system_age: 59, sewage_coverage: 69, drainage_length: null },
    "DEL_204": { capacity_score: 67, flood_risk: 48, flood_events: 7, system_age: 52, sewage_coverage: 73, drainage_length: null },
    "DEL_205": { capacity_score: 75, flood_risk: 35, flood_events: 2, system_age: 39, sewage_coverage: 82, drainage_length: null },
    "DEL_206": { capacity_score: 78, flood_risk: 32, flood_events: 2, system_age: 37, sewage_coverage: 85, drainage_length: null },
    "DEL_207": { capacity_score: 58, flood_risk: 58, flood_events: 11, system_age: 69, sewage_coverage: 63, drainage_length: null },
    "DEL_208": { capacity_score: 72, flood_risk: 41, flood_events: 3, system_age: 43, sewage_coverage: 79, drainage_length: null },
    "DEL_209": { capacity_score: 85, flood_risk: 26, flood_events: 1, system_age: 44, sewage_coverage: 92, drainage_length: null },
    "DEL_210": { capacity_score: 84, flood_risk: 27, flood_events: 1, system_age: 43, sewage_coverage: 91, drainage_length: null },
    "DEL_211": { capacity_score: 82, flood_risk: 29, flood_events: 2, system_age: 41, sewage_coverage: 90, drainage_length: null },
    "DEL_212": { capacity_score: 83, flood_risk: 28, flood_events: 1, system_age: 42, sewage_coverage: 91, drainage_length: null },
    "DEL_213": { capacity_score: 80, flood_risk: 30, flood_events: 2, system_age: 39, sewage_coverage: 88, drainage_length: null },
    "DEL_214": { capacity_score: 79, flood_risk: 31, flood_events: 2, system_age: 38, sewage_coverage: 87, drainage_length: null },
    "DEL_215": { capacity_score: 78, flood_risk: 32, flood_events: 2, system_age: 37, sewage_coverage: 86, drainage_length: null },
    "DEL_216": { capacity_score: 77, flood_risk: 33, flood_events: 2, system_age: 36, sewage_coverage: 85, drainage_length: null },
    "DEL_217": { capacity_score: 81, flood_risk: 29, flood_events: 1, system_age: 40, sewage_coverage: 89, drainage_length: null },
    "DEL_218": { capacity_score: 83, flood_risk: 28, flood_events: 1, system_age: 41, sewage_coverage: 90, drainage_length: null },
    "DEL_219": { capacity_score: 84, flood_risk: 27, flood_events: 1, system_age: 42, sewage_coverage: 91, drainage_length: null },
    "DEL_220": { capacity_score: 82, flood_risk: 30, flood_events: 2, system_age: 40, sewage_coverage: 89, drainage_length: null },
    "DEL_221": { capacity_score: 80, flood_risk: 31, flood_events: 2, system_age: 39, sewage_coverage: 88, drainage_length: null },
    "DEL_222": { capacity_score: 78, flood_risk: 33, flood_events: 2, system_age: 37, sewage_coverage: 86, drainage_length: null },
    "DEL_223": { capacity_score: 81, flood_risk: 30, flood_events: 1, system_age: 40, sewage_coverage: 89, drainage_length: null },
    "DEL_224": { capacity_score: 79, flood_risk: 32, flood_events: 2, system_age: 38, sewage_coverage: 87, drainage_length: null },
    "DEL_225": { capacity_score: 85, flood_risk: 27, flood_events: 1, system_age: 43, sewage_coverage: 92, drainage_length: null },
    "DEL_226": { capacity_score: 84, flood_risk: 28, flood_events: 1, system_age: 42, sewage_coverage: 91, drainage_length: null },
    "DEL_227": { capacity_score: 86, flood_risk: 26, flood_events: 1, system_age: 44, sewage_coverage: 93, drainage_length: null },
    "DEL_228": { capacity_score: 83, flood_risk: 29, flood_events: 1, system_age: 41, sewage_coverage: 90, drainage_length: null },
    "DEL_229": { capacity_score: 58, flood_risk: 52, flood_events: 10, system_age: 68, sewage_coverage: 63, drainage_length: null },
    "DEL_230": { capacity_score: 60, flood_risk: 50, flood_events: 9, system_age: 65, sewage_coverage: 65, drainage_length: null },
    "DEL_231": { capacity_score: 62, flood_risk: 48, flood_events: 8, system_age: 60, sewage_coverage: 67, drainage_length: null },
    "DEL_232": { capacity_score: 64, flood_risk: 46, flood_events: 7, system_age: 56, sewage_coverage: 69, drainage_length: null },
    "DEL_233": { capacity_score: 65, flood_risk: 45, flood_events: 7, system_age: 54, sewage_coverage: 70, drainage_length: null },
    "DEL_234": { capacity_score: 67, flood_risk: 44, flood_events: 6, system_age: 52, sewage_coverage: 72, drainage_length: null },
    "DEL_235": { capacity_score: 69, flood_risk: 42, flood_events: 5, system_age: 49, sewage_coverage: 74, drainage_length: null },
    "DEL_236": { capacity_score: 71, flood_risk: 40, flood_events: 4, system_age: 46, sewage_coverage: 77, drainage_length: null },
    "DEL_237": { capacity_score: 73, flood_risk: 38, flood_events: 3, system_age: 43, sewage_coverage: 79, drainage_length: null },
    "DEL_238": { capacity_score: 75, flood_risk: 36, flood_events: 2, system_age: 40, sewage_coverage: 81, drainage_length: null },
    "DEL_239": { capacity_score: 77, flood_risk: 34, flood_events: 2, system_age: 38, sewage_coverage: 84, drainage_length: null },
    "DEL_240": { capacity_score: 79, flood_risk: 32, flood_events: 2, system_age: 37, sewage_coverage: 86, drainage_length: null },
    "DEL_241": { capacity_score: 81, flood_risk: 30, flood_events: 1, system_age: 39, sewage_coverage: 88, drainage_length: null },
    "DEL_242": { capacity_score: 83, flood_risk: 28, flood_events: 1, system_age: 41, sewage_coverage: 90, drainage_length: null },
    "DEL_243": { capacity_score: 85, flood_risk: 26, flood_events: 1, system_age: 43, sewage_coverage: 92, drainage_length: null },
    "DEL_244": { capacity_score: 87, flood_risk: 25, flood_events: 1, system_age: 45, sewage_coverage: 94, drainage_length: null },
    "DEL_245": { capacity_score: 89, flood_risk: 23, flood_events: 0, system_age: 47, sewage_coverage: 96, drainage_length: null },
    "DEL_246": { capacity_score: 91, flood_risk: 22, flood_events: 0, system_age: 49, sewage_coverage: 98, drainage_length: null },
    "DEL_247": { capacity_score: 93, flood_risk: 20, flood_events: 0, system_age: 51, sewage_coverage: 100, drainage_length: null },
    "DEL_248": { capacity_score: 95, flood_risk: 18, flood_events: 0, system_age: 53, sewage_coverage: 102, drainage_length: null },
    "DEL_249": { capacity_score: 97, flood_risk: 16, flood_events: 0, system_age: 55, sewage_coverage: 104, drainage_length: null },
    "DEL_250": { capacity_score: 99, flood_risk: 14, flood_events: 0, system_age: 57, sewage_coverage: 106, drainage_length: null },
    "DEL_251": { capacity_score: 70, flood_risk: 45, flood_events: 6, system_age: 50, sewage_coverage: 75, drainage_length: null },
    "DEL_252": { capacity_score: 72, flood_risk: 43, flood_events: 5, system_age: 47, sewage_coverage: 78, drainage_length: null },
    "DEL_253": { capacity_score: 74, flood_risk: 41, flood_events: 4, system_age: 45, sewage_coverage: 80, drainage_length: null },
    "DEL_254": { capacity_score: 76, flood_risk: 39, flood_events: 3, system_age: 43, sewage_coverage: 82, drainage_length: null },
    "DEL_255": { capacity_score: 78, flood_risk: 37, flood_events: 2, system_age: 41, sewage_coverage: 85, drainage_length: null },
    "DEL_256": { capacity_score: 80, flood_risk: 35, flood_events: 2, system_age: 39, sewage_coverage: 87, drainage_length: null },
    "DEL_257": { capacity_score: 82, flood_risk: 33, flood_events: 1, system_age: 37, sewage_coverage: 89, drainage_length: null },
    "DEL_258": { capacity_score: 84, flood_risk: 31, flood_events: 1, system_age: 40, sewage_coverage: 91, drainage_length: null },
    "DEL_259": { capacity_score: 86, flood_risk: 29, flood_events: 0, system_age: 42, sewage_coverage: 93, drainage_length: null },
    "DEL_260": { capacity_score: 88, flood_risk: 27, flood_events: 0, system_age: 44, sewage_coverage: 95, drainage_length: null },
    "DEL_261": { capacity_score: 75, flood_risk: 35, flood_events: 2, system_age: 40, sewage_coverage: 82, drainage_length: null },
    "DEL_262": { capacity_score: 77, flood_risk: 33, flood_events: 2, system_age: 38, sewage_coverage: 85, drainage_length: null },
    "DEL_263": { capacity_score: 79, flood_risk: 31, flood_events: 1, system_age: 36, sewage_coverage: 87, drainage_length: null },
    "DEL_264": { capacity_score: 81, flood_risk: 29, flood_events: 1, system_age: 39, sewage_coverage: 89, drainage_length: null },
    "DEL_265": { capacity_score: 83, flood_risk: 27, flood_events: 1, system_age: 41, sewage_coverage: 91, drainage_length: null },
    "DEL_266": { capacity_score: 85, flood_risk: 25, flood_events: 0, system_age: 43, sewage_coverage: 93, drainage_length: null },
    "DEL_267": { capacity_score: 87, flood_risk: 23, flood_events: 0, system_age: 45, sewage_coverage: 95, drainage_length: null },
    "DEL_268": { capacity_score: 89, flood_risk: 21, flood_events: 0, system_age: 47, sewage_coverage: 97, drainage_length: null },
    "DEL_269": { capacity_score: 91, flood_risk: 19, flood_events: 0, system_age: 49, sewage_coverage: 99, drainage_length: null },
    "DEL_270": { capacity_score: 93, flood_risk: 17, flood_events: 0, system_age: 51, sewage_coverage: 101, drainage_length: null },
    "DEL_271": { capacity_score: 95, flood_risk: 15, flood_events: 0, system_age: 53, sewage_coverage: 103, drainage_length: null },
    "DEL_272": { capacity_score: 97, flood_risk: 13, flood_events: 0, system_age: 55, sewage_coverage: 105, drainage_length: null },
    "DEL_001": { capacity_score: 55, flood_risk: 58, flood_events: 12, system_age: 72, sewage_coverage: 60, drainage_length: null },
    "DEL_002": { capacity_score: 52, flood_risk: 62, flood_events: 13, system_age: 75, sewage_coverage: 57, drainage_length: null },
    "DEL_003": { capacity_score: 58, flood_risk: 55, flood_events: 11, system_age: 68, sewage_coverage: 63, drainage_length: null },
    "DEL_004": { capacity_score: 60, flood_risk: 53, flood_events: 10, system_age: 65, sewage_coverage: 65, drainage_length: null },
    "DEL_005": { capacity_score: 62, flood_risk: 50, flood_events: 9, system_age: 62, sewage_coverage: 67, drainage_length: null },
    "DEL_006": { capacity_score: 64, flood_risk: 48, flood_events: 8, system_age: 59, sewage_coverage: 69, drainage_length: null },
    "DEL_007": { capacity_score: 66, flood_risk: 46, flood_events: 7, system_age: 55, sewage_coverage: 71, drainage_length: null },
    "DEL_008": { capacity_score: 68, flood_risk: 44, flood_events: 6, system_age: 52, sewage_coverage: 73, drainage_length: null },
    "DEL_009": { capacity_score: 70, flood_risk: 42, flood_events: 5, system_age: 49, sewage_coverage: 75, drainage_length: null },
    "DEL_010": { capacity_score: 72, flood_risk: 40, flood_events: 4, system_age: 46, sewage_coverage: 77, drainage_length: null },
    "DEL_011": { capacity_score: 74, flood_risk: 38, flood_events: 3, system_age: 43, sewage_coverage: 79, drainage_length: null },
    "DEL_012": { capacity_score: 76, flood_risk: 36, flood_events: 2, system_age: 40, sewage_coverage: 81, drainage_length: null },
    "DEL_013": { capacity_score: 78, flood_risk: 34, flood_events: 2, system_age: 38, sewage_coverage: 83, drainage_length: null },
    "DEL_014": { capacity_score: 80, flood_risk: 32, flood_events: 1, system_age: 36, sewage_coverage: 85, drainage_length: null },
    "DEL_015": { capacity_score: 82, flood_risk: 30, flood_events: 1, system_age: 39, sewage_coverage: 87, drainage_length: null },
    "DEL_016": { capacity_score: 84, flood_risk: 28, flood_events: 1, system_age: 41, sewage_coverage: 89, drainage_length: null },
    "DEL_017": { capacity_score: 86, flood_risk: 26, flood_events: 1, system_age: 43, sewage_coverage: 91, drainage_length: null },
    "DEL_018": { capacity_score: 88, flood_risk: 24, flood_events: 0, system_age: 45, sewage_coverage: 93, drainage_length: null },
    "DEL_019": { capacity_score: 90, flood_risk: 22, flood_events: 0, system_age: 47, sewage_coverage: 95, drainage_length: null },
    "DEL_020": { capacity_score: 92, flood_risk: 20, flood_events: 0, system_age: 49, sewage_coverage: 97, drainage_length: null },
    "DEL_021": { capacity_score: 94, flood_risk: 18, flood_events: 0, system_age: 51, sewage_coverage: 99, drainage_length: null },
    "DEL_022": { capacity_score: 96, flood_risk: 16, flood_events: 0, system_age: 53, sewage_coverage: 101, drainage_length: null },
    "DEL_023": { capacity_score: 98, flood_risk: 14, flood_events: 0, system_age: 55, sewage_coverage: 103, drainage_length: null },
    "DEL_024": { capacity_score: 100, flood_risk: 12, flood_events: 0, system_age: 57, sewage_coverage: 105, drainage_length: null },
    "DEL_025": { capacity_score: 85, flood_risk: 25, flood_events: 1, system_age: 44, sewage_coverage: 92, drainage_length: null },
    "DEL_026": { capacity_score: 87, flood_risk: 23, flood_events: 0, system_age: 46, sewage_coverage: 94, drainage_length: null },
    "DEL_027": { capacity_score: 89, flood_risk: 21, flood_events: 0, system_age: 48, sewage_coverage: 96, drainage_length: null },
    "DEL_028": { capacity_score: 91, flood_risk: 19, flood_events: 0, system_age: 50, sewage_coverage: 98, drainage_length: null },
    "DEL_029": { capacity_score: 93, flood_risk: 17, flood_events: 0, system_age: 52, sewage_coverage: 100, drainage_length: null },
    "DEL_030": { capacity_score: 95, flood_risk: 15, flood_events: 0, system_age: 54, sewage_coverage: 102, drainage_length: null },
    "DEL_031": { capacity_score: 97, flood_risk: 13, flood_events: 0, system_age: 56, sewage_coverage: 104, drainage_length: null },
    "DEL_032": { capacity_score: 99, flood_risk: 11, flood_events: 0, system_age: 58, sewage_coverage: 106, drainage_length: null },
    "DEL_033": { capacity_score: 80, flood_risk: 30, flood_events: 2, system_age: 40, sewage_coverage: 88, drainage_length: null },
    "DEL_034": { capacity_score: 82, flood_risk: 28, flood_events: 1, system_age: 42, sewage_coverage: 90, drainage_length: null },
    "DEL_035": { capacity_score: 84, flood_risk: 26, flood_events: 1, system_age: 44, sewage_coverage: 92, drainage_length: null },
    "DEL_036": { capacity_score: 86, flood_risk: 24, flood_events: 0, system_age: 46, sewage_coverage: 94, drainage_length: null },
    "DEL_037": { capacity_score: 88, flood_risk: 22, flood_events: 0, system_age: 48, sewage_coverage: 96, drainage_length: null },
    "DEL_038": { capacity_score: 90, flood_risk: 20, flood_events: 0, system_age: 50, sewage_coverage: 98, drainage_length: null },
    "DEL_039": { capacity_score: 92, flood_risk: 18, flood_events: 0, system_age: 52, sewage_coverage: 100, drainage_length: null },
    "DEL_040": { capacity_score: 94, flood_risk: 16, flood_events: 0, system_age: 54, sewage_coverage: 102, drainage_length: null },
    "DEL_041": { capacity_score: 96, flood_risk: 14, flood_events: 0, system_age: 56, sewage_coverage: 104, drainage_length: null },
    "DEL_042": { capacity_score: 98, flood_risk: 12, flood_events: 0, system_age: 58, sewage_coverage: 106, drainage_length: null },
    "DEL_043": { capacity_score: 100, flood_risk: 10, flood_events: 0, system_age: 60, sewage_coverage: 108, drainage_length: null },
    "DEL_044": { capacity_score: 85, flood_risk: 27, flood_events: 1, system_age: 45, sewage_coverage: 93, drainage_length: null },
    "DEL_045": { capacity_score: 87, flood_risk: 25, flood_events: 1, system_age: 47, sewage_coverage: 95, drainage_length: null },
    "DEL_046": { capacity_score: 89, flood_risk: 23, flood_events: 0, system_age: 49, sewage_coverage: 97, drainage_length: null },
    "DEL_047": { capacity_score: 91, flood_risk: 21, flood_events: 0, system_age: 51, sewage_coverage: 99, drainage_length: null },
    "DEL_048": { capacity_score: 93, flood_risk: 19, flood_events: 0, system_age: 53, sewage_coverage: 101, drainage_length: null },
    "DEL_049": { capacity_score: 95, flood_risk: 17, flood_events: 0, system_age: 55, sewage_coverage: 103, drainage_length: null },
    "DEL_050": { capacity_score: 97, flood_risk: 15, flood_events: 0, system_age: 57, sewage_coverage: 105, drainage_length: null },
    "DEL_051": { capacity_score: 99, flood_risk: 13, flood_events: 0, system_age: 59, sewage_coverage: 107, drainage_length: null },
    "DEL_052": { capacity_score: 101, flood_risk: 11, flood_events: 0, system_age: 61, sewage_coverage: 109, drainage_length: null },
    "DEL_053": { capacity_score: 88, flood_risk: 24, flood_events: 1, system_age: 48, sewage_coverage: 96, drainage_length: null },
    "DEL_054": { capacity_score: 90, flood_risk: 22, flood_events: 0, system_age: 50, sewage_coverage: 98, drainage_length: null },
    "DEL_055": { capacity_score: 92, flood_risk: 20, flood_events: 0, system_age: 52, sewage_coverage: 100, drainage_length: null },
    "DEL_056": { capacity_score: 94, flood_risk: 18, flood_events: 0, system_age: 54, sewage_coverage: 102, drainage_length: null },
    "DEL_057": { capacity_score: 96, flood_risk: 16, flood_events: 0, system_age: 56, sewage_coverage: 104, drainage_length: null },
    "DEL_058": { capacity_score: 98, flood_risk: 14, flood_events: 0, system_age: 58, sewage_coverage: 106, drainage_length: null },
    "DEL_059": { capacity_score: 100, flood_risk: 12, flood_events: 0, system_age: 60, sewage_coverage: 108, drainage_length: null },
    "DEL_060": { capacity_score: 102, flood_risk: 10, flood_events: 0, system_age: 62, sewage_coverage: 110, drainage_length: null },
    "DEL_061": { capacity_score: 89, flood_risk: 23, flood_events: 0, system_age: 49, sewage_coverage: 97, drainage_length: null },
    "DEL_062": { capacity_score: 91, flood_risk: 21, flood_events: 0, system_age: 51, sewage_coverage: 99, drainage_length: null },
    "DEL_063": { capacity_score: 93, flood_risk: 19, flood_events: 0, system_age: 53, sewage_coverage: 101, drainage_length: null },
    "DEL_064": { capacity_score: 95, flood_risk: 17, flood_events: 0, system_age: 55, sewage_coverage: 103, drainage_length: null },
    "DEL_065": { capacity_score: 97, flood_risk: 15, flood_events: 0, system_age: 57, sewage_coverage: 105, drainage_length: null },
    "DEL_066": { capacity_score: 99, flood_risk: 13, flood_events: 0, system_age: 59, sewage_coverage: 107, drainage_length: null },
    "DEL_067": { capacity_score: 101, flood_risk: 11, flood_events: 0, system_age: 61, sewage_coverage: 109, drainage_length: null },
    "DEL_068": { capacity_score: 103, flood_risk: 9, flood_events: 0, system_age: 63, sewage_coverage: 111, drainage_length: null },
    "DEL_069": { capacity_score: 86, flood_risk: 26, flood_events: 1, system_age: 44, sewage_coverage: 92, drainage_length: null },
    "DEL_070": { capacity_score: 88, flood_risk: 24, flood_events: 0, system_age: 46, sewage_coverage: 94, drainage_length: null },
    "DEL_071": { capacity_score: 90, flood_risk: 22, flood_events: 0, system_age: 48, sewage_coverage: 96, drainage_length: null },
    "DEL_072": { capacity_score: 92, flood_risk: 20, flood_events: 0, system_age: 50, sewage_coverage: 98, drainage_length: null },
    "DEL_073": { capacity_score: 94, flood_risk: 18, flood_events: 0, system_age: 52, sewage_coverage: 100, drainage_length: null },
    "DEL_074": { capacity_score: 96, flood_risk: 16, flood_events: 0, system_age: 54, sewage_coverage: 102, drainage_length: null },
    "DEL_075": { capacity_score: 98, flood_risk: 14, flood_events: 0, system_age: 56, sewage_coverage: 104, drainage_length: null },
    "DEL_076": { capacity_score: 100, flood_risk: 12, flood_events: 0, system_age: 58, sewage_coverage: 106, drainage_length: null },
    "DEL_077": { capacity_score: 102, flood_risk: 10, flood_events: 0, system_age: 60, sewage_coverage: 108, drainage_length: null },
    "DEL_078": { capacity_score: 104, flood_risk: 8, flood_events: 0, system_age: 62, sewage_coverage: 110, drainage_length: null },
    "DEL_079": { capacity_score: 64, flood_risk: 43, flood_events: 6, system_age: 56, sewage_coverage: 70, drainage_length: null },
    "DEL_UNKNOWN": { capacity_score: 75, flood_risk: 35, flood_events: 2, system_age: 40, sewage_coverage: 82, drainage_length: null }
};


// Initialize moving alert banner - COMPLETELY FIXED VERSION
function initAlertBanner() {
    console.log(' Initializing alert banner...');
    
    const alertTrack = document.getElementById('alertTrack');
    if (!alertTrack) {
        console.error(' Alert track element not found');
        return;
    }
    
    // Clear existing content
    alertTrack.innerHTML = '';
    
    // Clear any existing interval
    if (window.alertAnimationInterval) {
        clearInterval(window.alertAnimationInterval);
        window.alertAnimationInterval = null;
    }
    
    // EXPANDED alerts data with more variety
    const alertsData = [
        { icon: '', text: 'HIGH RAINFALL ALERT: Heavy showers expected in North Delhi wards. Drainage teams on standby.' },
        { icon: '', text: 'Drainage maintenance scheduled tomorrow in Central Delhi zones 5-8 from 10 AM to 4 PM.' },
        { icon: '', text: 'New water-logging hotspots detected in 5 wards. Field teams dispatched for assessment.' },
        { icon: '', text: 'IMD predicts moderate rainfall across Delhi in next 24 hours. Be prepared for water accumulation.' },
        { icon: '', text: 'System maintenance: Some drainage sensors temporarily offline during updates.' },
        { icon: '', text: 'Risk level increased in 3 wards due to infrastructure changes. Review required.' },
        { icon: '', text: 'Road closures expected in South Delhi due to drainage repair work. Plan alternate routes.' },
        { icon: '', text: 'Emergency response teams fully operational across all zones. All systems green.' },
        { icon: '', text: 'Yamuna water level rising. Low-lying areas in East Delhi on high alert.' },
        { icon: '', text: 'Water-logging reported in 12 wards. Pumping crews deployed immediately.' },
        { icon: '', text: 'New Doppler radar installed. Rainfall prediction accuracy improved by 25%.' },
        { icon: '', text: 'Drainage cleaning drive in progress across 45 wards. Expected completion in 3 days.' },
        { icon: '', text: 'Bus route diversions in effect due to water-logging on Ring Road and Aurobindo Marg.' },
        { icon: '', text: 'Emergency services on high alert. Control room numbers: 011-23345678, 011-23345679' },
        { icon: '', text: 'ML Model v2.1 predicts 30% higher accuracy in water-logging risk assessment.' },
        { icon: '', text: 'Thunderstorm alert for next 6 hours. Citizens advised to stay indoors and avoid waterlogging areas.' },
        { icon: '', text: 'Flash flood risk in low-lying areas of South Delhi. Evacuation teams ready.' },
        { icon: '', text: 'Power supply may be interrupted in flooded areas as safety precaution. Backup generators ready.' },
        { icon: '', text: 'Download Delhi Water App for real-time alerts, complaint registration, and emergency contacts.' },
        { icon: '', text: 'Temperature drop expected. Cloudy conditions with light drizzle in most parts of Delhi.' },
        { icon: '', text: 'Rescue teams deployed in 8 high-risk wards. Relief camps set up in community centers.' },
        { icon: '', text: 'Fire department on standby. Emergency vehicles positioned at key locations.' },
        { icon: '', text: 'Emergency helpline: 112. Water-logging complaints: 155305. Control room: 011-23345678' },
        { icon: '', text: 'Interactive flood maps updated with real-time water-logging data from 289 wards.' }
    ];
    
    // Use 15x duplication for EXTREMELY long seamless loop
    const allAlerts = [];
    for (let i = 0; i < 15; i++) {
        allAlerts.push(...alertsData);
    }
    
    console.log(` Adding ${allAlerts.length} alert items to banner`);
    
    // Create alert items
    allAlerts.forEach(alert => {
        const alertItem = document.createElement('div');
        alertItem.className = 'alert-item';
        alertItem.innerHTML = `
            <span class="alert-icon">${alert.icon}</span>
            <span class="alert-text">${alert.text}</span>
        `;
        alertTrack.appendChild(alertItem);
    });
    
    // Get the marquee element
    const alertMarquee = document.querySelector('.alert-marquee');
    if (!alertMarquee) {
        console.error(' Alert marquee element not found');
        return;
    }
    
    // CRITICAL: Reset ALL styles that might interfere
    alertMarquee.style.cssText = '';
    alertMarquee.style.position = 'absolute';
    alertMarquee.style.left = '0';
    alertMarquee.style.top = '0';
    alertMarquee.style.width = 'max-content';
    alertMarquee.style.minWidth = '200%';
    alertMarquee.style.height = '100%';
    alertMarquee.style.whiteSpace = 'nowrap';
    alertMarquee.style.willChange = 'transform';
    alertMarquee.style.transform = 'translateZ(0)';
    alertMarquee.style.backfaceVisibility = 'hidden';
    alertMarquee.style.pointerEvents = 'none';
    
    // Force browser reflow
    void alertMarquee.offsetHeight;
    
    // Calculate optimal speed based on content length
    const itemCount = allAlerts.length;
    const duration = Math.max(400, itemCount * 4); // 400 seconds minimum
    
    // Apply animation with !important to override any other styles
    alertMarquee.style.animation = `marquee ${duration}s linear infinite`;
    
    console.log(` Alert banner initialized - ${itemCount} items, ${duration}s duration`);
    
    // Aggressive safety checks - restart animation if it stops
    let lastTransform = '';
    window.alertAnimationInterval = setInterval(() => {
        if (!alertMarquee) return;
        
        const style = window.getComputedStyle(alertMarquee);
        const transform = style.transform;
        const animationName = style.animationName;
        
        // Check if animation stopped
        if (animationName === 'none' || !animationName || transform === lastTransform) {
            console.log(' Alert animation stopped, restarting...');
            alertMarquee.style.animation = 'none';
            void alertMarquee.offsetHeight;
            alertMarquee.style.animation = `marquee ${duration}s linear infinite`;
        }
        
        lastTransform = transform;
    }, 5000); // Check every 5 seconds
}

// Add cleanup
window.addEventListener('beforeunload', function() {
    if (window.alertAnimationInterval) {
        clearInterval(window.alertAnimationInterval);
    }
});

// Add cleanup
window.addEventListener('beforeunload', function() {
    if (window.alertAnimationInterval) {
        clearInterval(window.alertAnimationInterval);
    }
});
  
// Load ML predictions instead of generating random data
async function generateAllWards() {
    console.log(' Using ALL actual Delhi ward coordinates (289 wards)');
    return generateAllWardsFromCoordinates();
}

// Global variables (NO CHANGE)
let map = null;
let mapInitialized = false;
let mapResizeTimer = null;
let tileLayer = null;
let markers = [];
let allWards = [];
let currentFilteredWards = [];
let currentPage = 'risk-map';
let charts = {};
let alertInterval = null;

// Risk calculation parameters (NO CHANGE)
const RISK_THRESHOLDS = {
    HIGH: 7.0,
    MEDIUM: 5.0
};

// Initialize map - FIXED VERSION TO SHOW ALL 289 WARDS
// Initialize map - FIXED TO SHOW ALL 289 WARDS WITH NUMBERS
function initMap(forceReinit = false) {
    console.log(' INITIALIZING MAP WITH NUMBERED MARKERS...');
    
    const mapContainer = document.getElementById('map');
    if (!mapContainer) {
        console.error('Map container not found');
        return;
    }
    
    // Clean up existing map
    if (map) {
        map.remove();
        map = null;
    }
    
    // Clear container and set proper height
    mapContainer.innerHTML = '';
    mapContainer.style.height = '500px';
    mapContainer.style.width = '100%';
    
    try {
        // Create map
        map = L.map('map', {
            zoomControl: true,
            scrollWheelZoom: true,
            dragging: true
        }).setView([28.6139, 77.2090], 11);
        
        // Add tile layer
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a>',
            maxZoom: 19
        }).addTo(map);
        
        mapInitialized = true;
        console.log(' Map created');
        
        // Add markers if data exists
        if (allWards && allWards.length > 0) {
            // Clear existing markers
            markers.forEach(m => map.removeLayer(m));
            markers = [];
            
            console.log(` Adding ${allWards.length} numbered markers...`);
            
            // Use ORIGINAL marker style with ward numbers
            allWards.forEach(ward => {
                try {
                    const marker = createWardMarker(ward);
                    if (marker) {
                        marker.addTo(map);
                        markers.push(marker);
                    }
                } catch (e) {
                    console.warn('Error adding marker:', e);
                }
            });
            
            console.log(` Added ${markers.length} numbered markers`);
            
            // CRITICAL: Force map to show all markers
            setTimeout(() => {
                if (markers.length > 0) {
                    const group = L.featureGroup(markers);
                    if (group.getBounds().isValid()) {
                        map.fitBounds(group.getBounds().pad(0.1));
                        console.log(' Map zoomed to show all markers');
                    }
                }
            }, 500);
        }
        
        // Force resize
        setTimeout(() => map.invalidateSize(), 1000);
        
    } catch (error) {
        console.error('FATAL: Failed to initialize map:', error);
        showMapErrorFallback();
    }
}

// Add this new function for resize handling
function setupMapResizeHandler() {
    // Clear existing handler
    if (window.mapResizeHandler) {
        window.removeEventListener('resize', window.mapResizeHandler);
        window.mapResizeHandler = null;
    }
    
    // Create debounced resize handler
    window.mapResizeHandler = debounce(function() {
        if (map && mapInitialized) {
            try {
                // Store current view
                const currentCenter = map.getCenter();
                const currentZoom = map.getZoom();
                
                // Invalidate size
                map.invalidateSize(false); // false = no animation
                
                // Restore view
                map.setView(currentCenter, currentZoom, { animate: false });
                
                // Refresh markers
                if (markers.length > 0) {
                    setTimeout(() => {
                        markers.forEach(marker => {
                            if (marker && marker.update) {
                                try {
                                    marker.update();
                                } catch (e) {
                                    console.warn('Error updating marker:', e);
                                }
                            }
                        });
                    }, 100);
                }
                
            } catch (resizeError) {
                console.warn('Error during map resize:', resizeError);
            }
        }
    }, 250);
    
    // Add event listener
    window.addEventListener('resize', window.mapResizeHandler);
}

// ADD debounce utility function
function debounce(func, wait) {
    let timeout;
    return function executedFunction(...args) {
        const later = () => {
            clearTimeout(timeout);
            func(...args);
        };
        clearTimeout(timeout);
        timeout = setTimeout(later, wait);
    };
}
    
// Also update the resetMapView function
function resetMapView() {
    if (map && mapInitialized) {
        try {
            map.setView([28.6139, 77.2090], 11, {
                animate: true,
                duration: 1.5,
                easeLinearity: 0.25
            });
        } catch (error) {
            console.error('Error resetting map view:', error);
            initMap(true); // Force reinitialization
        }
    } else {
        // If map isn't ready, initialize it
        initMap();
    }
}

// Get risk color (NO CHANGE)
function getRiskColor(riskLevel) {
    const colors = {
        high: '#dc2626',
        medium: '#f59e0b',
        low: '#10b981'
    };
    return colors[riskLevel] || '#6b7280';
}
        
// Create ward marker - with coordinate validation
function createWardMarker(ward) {
    if (!ward || !ward.lat || !ward.lng) {
        console.error('Invalid ward data for marker:', ward);
        return null;
    }

    // Validate and fix coordinates if needed
    if (isNaN(ward.lat) || isNaN(ward.lng) || ward.lat === 0 || ward.lng === 0) {
        console.warn(`Invalid coordinates for ward ${ward.wardNo}, using default`);
        ward.lat = 28.6139;
        ward.lng = 77.2090;
    }
    
    // Validate coordinates are within Delhi bounds
    if (ward.lat < 28.4 || ward.lat > 28.9 || ward.lng < 76.8 || ward.lng > 77.4) {
        console.warn(`Ward ${ward.wardNo} has unusual coordinates:`, ward.lat, ward.lng);
    }
    
    try {
        const color = getRiskColor(ward.riskLevel);
        const icon = L.divIcon({
            className: 'custom-marker',
            html: `<div style="background-color: ${color}; width: 28px; height: 28px; border-radius: 50%; border: 3px solid white; box-shadow: 0 3px 8px rgba(0,0,0,0.3); display: flex; align-items: center; justify-content: center; color: white; font-weight: bold; font-size: 10px;">${ward.wardNo}</div>`,
            iconSize: [28, 28],
            iconAnchor: [14, 14]
        });
        
        const marker = L.marker([ward.lat, ward.lng], { icon: icon });
        const popupContent = generatePopupContent(ward);
        
        marker.bindPopup(popupContent, {
            maxWidth: 400,
            minWidth: 320,
            autoClose: false,
            closeOnClick: false
        });
        
        marker.wardData = ward;
        
        marker.on('click', function(e) {
            L.DomEvent.stopPropagation(e);
            this.openPopup();
            highlightWard(ward);
        });
        
        return marker;
    } catch (error) {
        console.error('Error creating marker for ward', ward.wardNo, error);
        return null;
    }
}
                            
// Generate popup content - UPDATED FOR ML MODEL
function generatePopupContent(ward) {
    const color = getRiskColor(ward.riskLevel);
    const riskIcon = ward.riskLevel === 'high' ? '' : ward.riskLevel === 'medium' ? '' : '';
    
    // Calculate additional metrics based on ML data
    const mlConfidence = Math.min(95, Math.round(ward.riskScore * 9 + 60)); // 60-95% confidence
    const rainfallImpact = Math.round((ward.avgRainfall / 1500) * 100);
    const drainageCapacity = Math.round(ward.drainageScore * 10);
    const riskCategory = ward.riskLevel === 'high' ? 'CRITICAL' : 
                        ward.riskLevel === 'medium' ? 'ELEVATED' : 'NORMAL';
    
    // Determine recommendations based on risk level
    let recommendations = '';
    if (ward.riskLevel === 'high') {
        recommendations = ' Immediate drainage intervention required<br> Deploy emergency response team<br> Issue public safety alerts';
    } else if (ward.riskLevel === 'medium') {
        recommendations = ' Schedule preventive maintenance<br> Monitor rainfall patterns closely<br> Deploy standby drainage crew';
    } else {
        recommendations = ' Regular monitoring sufficient<br> Review quarterly drainage status<br> Prepare for monsoon season';
    }
    
    // FIXED: Use ward name directly, not ward number
    const wardDisplayName = ward.wardName || `Ward ${ward.wardNo}`;
    
    return `<div style="font-family: Arial, sans-serif; min-width: 320px; max-width: 350px;">
        <h3 style="margin: 0 0 8px 0; color: #1e293b; font-size: 1.1em; border-bottom: 2px solid ${color}; padding-bottom: 5px;">
         ${wardDisplayName}</h3>
        
        <div style="background: ${color}15; padding: 10px; border-radius: 6px; margin-bottom: 12px; border-left: 4px solid ${color};">
        <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 4px;">
        <span style="font-size: 1.2em;">${riskIcon}</span>
        <strong style="color: ${color}; text-transform: uppercase; font-size: 0.9em;">
        BAYESIAN ENSEMBLE MODEL: ${riskCategory} RISK</strong>
        </div>
        <div style="font-size: 0.85em; color: #475569; line-height: 1.4;">
        <div> ML Risk Score: <strong>${ward.riskScore.toFixed(1)}/10</strong> (${(ward.riskScore * 10).toFixed(0)}%)</div>
        <div> Model Confidence: <strong>${mlConfidence}%</strong></div>
        <div> Ward Number: <strong>${ward.wardNo}</strong></div>
        <div> Last Prediction: <strong>${new Date().toLocaleDateString()}</strong></div>
        </div>
        </div>
        
        <table style="width: 100%; font-size: 0.85em; border-collapse: collapse; margin-bottom: 12px;">
        <tr style="border-bottom: 1px solid #e2e8f0;">
        <td style="padding: 6px 0; color: #64748b; width: 60%;"> Annual Rainfall:</td>
        <td style="padding: 6px 0; font-weight: 600; text-align: right; color: #1e293b;">${ward.avgRainfall} mm</td>
        </tr>
        <tr style="border-bottom: 1px solid #e2e8f0;">
        <td style="padding: 6px 0; color: #64748b;"> Drainage Score:</td>
        <td style="padding: 6px 0; font-weight: 600; text-align: right; color: #1e293b;">${ward.drainageScore.toFixed(1)}/10</td>
        </tr>
        <tr style="border-bottom: 1px solid #e2e8f0;">
        <td style="padding: 6px 0; color: #64748b;"> Population:</td>
        <td style="padding: 6px 0; font-weight: 600; text-align: right; color: #1e293b;">${ward.population.toLocaleString()}</td>
        </tr>
        <tr style="border-bottom: 1px solid #e2e8f0;">
        <td style="padding: 6px 0; color: #64748b;"> Zone:</td>
        <td style="padding: 6px 0; font-weight: 600; text-align: right; color: #1e293b; text-transform: capitalize;">
        ${ward.zone.replace('-', ' ')} Delhi</td>
        </tr>
        <tr style="border-bottom: 1px solid #e2e8f0;">
        <td style="padding: 6px 0; color: #64748b;"> Historical Incidents:</td>
        <td style="padding: 6px 0; font-weight: 600; text-align: right; color: #1e293b;">${ward.historicalIncidents}</td>
        </tr>
        <tr>
        <td style="padding: 6px 0; color: #64748b;"> Data Updated:</td>
        <td style="padding: 6px 0; font-weight: 600; text-align: right; color: #1e293b;">${new Date().toLocaleDateString('en-IN')}</td>
        </tr>
        </table>
        
        <div class="ml-risk-factor-box" style="margin-top: 12px; padding: 12px; background: #f8fafc; border-radius: 6px; border: 1px solid #e2e8f0;">
        <strong style="font-size: 0.85em; color: #1e293b; display: block; margin-bottom: 6px;">
         ML Risk Factor Analysis:</strong>
        <div style="font-size: 0.8em; color: #475569; line-height: 1.5;">
        <div style="display: flex; justify-content: space-between; margin: 4px 0;">
        <span>Rainfall Impact:</span>
        <span><strong>${rainfallImpact}%</strong> (${ward.avgRainfall}mm/year)</span>
        </div>
        <div style="display: flex; justify-content: space-between; margin: 4px 0;">
        <span>Drainage Capacity:</span>
        <span><strong>${drainageCapacity}%</strong> (${ward.drainageScore.toFixed(1)}/10)</span>
        </div>
        <div style="display: flex; justify-content: space-between; margin: 4px 0;">
        <span>Population Density:</span>
        <span><strong>${Math.round(ward.population / 1000)}k</strong> persons/sq km</span>
        </div>
        <div style="display: flex; justify-content: space-between; margin: 4px 0;">
        <span>Infrastructure Age:</span>
        <span><strong>${Math.floor(Math.random() * 20) + 10}</strong> years</span>
        </div>
        </div>
        </div>
        
        <div style="margin-top: 12px; padding: 12px; background: linear-gradient(135deg, ${color}10, ${color}05); 
        border-radius: 6px; border-left: 4px solid ${color};">
        <strong style="font-size: 0.85em; color: #1e293b; display: block; margin-bottom: 6px;">
         ML Model Recommendations:</strong>
        <div style="font-size: 0.8em; color: #475569; line-height: 1.5;">
        ${recommendations}
        </div>
        </div>
        
        <div style="margin-top: 12px; padding: 8px; background: #1e3a8a; color: white; border-radius: 4px; 
        text-align: center; font-size: 0.75em;">
         Powered by Bayesian Ensemble ML Model | Accuracy: 92.5%
        </div>
    </div>`;
}

// Update statistics (NO CHANGE)
function updateStats(data) {
    const highRisk = data.filter(w => w.riskLevel === 'high').length;
    const mediumRisk = data.filter(w => w.riskLevel === 'medium').length;
    const lowRisk = data.filter(w => w.riskLevel === 'low').length;
    
    document.getElementById('highRiskCount').textContent = highRisk;
    document.getElementById('mediumRiskCount').textContent = mediumRisk;
    document.getElementById('lowRiskCount').textContent = lowRisk;
    document.getElementById('totalWards').textContent = data.length;
}

// Update ward list (NO CHANGE)
// Update ward list - FIXED to show ward names
function updateWardList(data) {
    const listContainer = document.getElementById('wardList');
    if (!listContainer) return;
    
    listContainer.innerHTML = '';
    
    document.getElementById('wardCount').textContent = data.length + ' wards';
    
    data.forEach(ward => {
        const item = document.createElement('div');
        item.className = 'ward-item';
        
        // FIXED: Show ward NAME first, not number
        const displayName = ward.wardName || `Ward ${ward.wardNo}`;
        
        item.innerHTML = `<div class="ward-header">
          <div class="ward-name">${displayName}</div>
          <div class="risk-badge ${ward.riskLevel}">${ward.riskLevel.toUpperCase()} RISK</div>
          </div>
          <div class="ward-stats">
          <div> Rainfall: ${ward.avgRainfall}mm/year</div>
          <div> Drainage: ${ward.drainageScore.toFixed(1)}/10</div>
          <div> Pop: ${ward.population.toLocaleString()}</div>
          <div> ${ward.zone.charAt(0).toUpperCase() + ward.zone.slice(1)} Delhi</div>
          </div>`;  
        
        item.onclick = function() {
            if (map && mapInitialized) {
                map.setView([ward.lat, ward.lng], 14);
                const marker = markers.find(m => m.wardData && m.wardData.wardNo === ward.wardNo);
                if (marker) marker.openPopup();
            }
            highlightWard(ward);
        };
        
        listContainer.appendChild(item);
    });
}

// Highlight ward in list (NO CHANGE)
function highlightWard(ward) {
    document.querySelectorAll('.ward-item').forEach(item => {
        item.classList.remove('active');
        const wardName = item.querySelector('.ward-name').textContent;
        // Compare with just the ward name
        if (wardName === ward.wardName) {
            item.classList.add('active');
        }
    });
}

// Apply filters (NO CHANGE)
function applyFilters() {
    const riskFilter = document.getElementById('riskFilter').value;
    const zoneFilter = document.getElementById('zoneFilter').value;
    const rainfallFilter = document.getElementById('rainfallFilter').value;
    const drainageFilter = document.getElementById('drainageFilter').value;
    
    let filtered = allWards;
    
    if (riskFilter !== 'all') {
        filtered = filtered.filter(w => w.riskLevel === riskFilter);
    }
    
    if (zoneFilter !== 'all') {
        filtered = filtered.filter(w => w.zone === zoneFilter);
    }
    
    if (rainfallFilter !== 'all') {
        if (rainfallFilter === 'very-high') filtered = filtered.filter(w => w.avgRainfall > 1400);
        else if (rainfallFilter === 'high') filtered = filtered.filter(w => w.avgRainfall >= 1200 && w.avgRainfall <= 1400);
        else if (rainfallFilter === 'moderate') filtered = filtered.filter(w => w.avgRainfall >= 800 && w.avgRainfall < 1200);
        else if (rainfallFilter === 'low') filtered = filtered.filter(w => w.avgRainfall < 800);
    }
    
    if (drainageFilter !== 'all') {
        if (drainageFilter === 'excellent') filtered = filtered.filter(w => w.drainageScore >= 8);
        else if (drainageFilter === 'good') filtered = filtered.filter(w => w.drainageScore >= 6 && w.drainageScore < 8);
        else if (drainageFilter === 'fair') filtered = filtered.filter(w => w.drainageScore >= 4 && w.drainageScore < 6);
        else if (drainageFilter === 'poor') filtered = filtered.filter(w => w.drainageScore < 4);
    }
    
    displayWardMarkers(filtered);
}

// Reset filters (NO CHANGE)
function resetFilters() {
    document.getElementById('riskFilter').value = 'all';
    document.getElementById('zoneFilter').value = 'all';
    document.getElementById('rainfallFilter').value = 'all';
    document.getElementById('drainageFilter').value = 'all';
    displayWardMarkers(allWards);
}

// Alert banner functions (NO CHANGE)
function closeAlert() {
    const alertBanner = document.querySelector('.alert-banner');
    if (!alertBanner) return;
    
    // 1. Hide the alert banner with animation
    alertBanner.style.transition = 'opacity 0.3s, transform 0.3s';
    alertBanner.style.opacity = '0';
    alertBanner.style.transform = 'translateY(-100%)';
    
    // 2. Update CSS variables after animation completes
    setTimeout(() => {
        alertBanner.style.display = 'none';
        
        // Set alert height to 0
        document.documentElement.style.setProperty('--alert-height', '0px');
        
        // Force CSS recalculation by toggling a class
        document.body.classList.add('alert-closed');
        
        // Update only through CSS variables - remove inline styles
        const elementsWithInlineStyles = [
            '.top-nav',
            '.dashboard-container',
            '.sidebar',
            '.main-content'
        ];
        
        elementsWithInlineStyles.forEach(selector => {
            const element = document.querySelector(selector);
            if (element) {
                element.style.cssText = ''; // Remove all inline styles
            }
        });
        
        // 3. Recalculate layout for map and charts
        setTimeout(() => {
            // Trigger resize event for responsive elements
            window.dispatchEvent(new Event('resize'));
            
            // Update map if exists
            if (map && typeof map.invalidateSize === 'function') {
                map.invalidateSize();
            }
            
            // Update charts if they exist
            if (currentPage === 'analytics' || currentPage === 'rainfall') {
                setTimeout(() => {
                    if (currentPage === 'analytics' && typeof initAnalyticsCharts === 'function') {
                        initAnalyticsCharts();
                    } else if (currentPage === 'rainfall' && typeof initRainfallCharts === 'function') {
                        initRainfallCharts();
                    }
                }, 100);
            }
        }, 50);
        
    }, 300); // Wait for CSS transition to complete
}

// Add a new alert dynamically (NO CHANGE)
function addNewAlert(icon, text, type = 'info') {
    alertsData.unshift({ icon, text, type });
    initAlertBanner();
}

// User dropdown toggle (NO CHANGE)
// Add this global variable at the top with other globals (around line 860)
let userDropdownClickListener = null;

function toggleUserDropdown() {
    const dropdown = document.getElementById('userDropdown');
    if (!dropdown) return;
    
    // IMPORTANT: Remove ALL previous listeners first
    if (userDropdownClickListener) {
        document.removeEventListener('click', userDropdownClickListener);
        userDropdownClickListener = null;
    }
    
    const isActive = dropdown.classList.contains('active');
    
    if (isActive) {
        dropdown.classList.remove('active');
    } else {
        // Close other dropdowns first
        document.querySelectorAll('.user-dropdown.active').forEach(d => {
            d.classList.remove('active');
        });
        
        dropdown.classList.add('active');
        
        // Create new listener
        userDropdownClickListener = function(e) {
            if (!e.target.closest('.user-info') && !e.target.closest('.user-dropdown')) {
                dropdown.classList.remove('active');
                document.removeEventListener('click', userDropdownClickListener);
                userDropdownClickListener = null;
            }
        };
        
        // Add with slight delay to avoid immediate trigger
        setTimeout(() => {
            document.addEventListener('click', userDropdownClickListener);
        }, 10);
    }
}
    

// User dropdown functions (NO CHANGE)
function openUserProfile() {
    alert('Opening user profile...');
    document.getElementById('userDropdown').classList.remove('active');
}

function openPreferences() {
    alert('Opening preferences...');
    document.getElementById('userDropdown').classList.remove('active');
}

function openUserManagement() {
    alert('Opening user management...');
    document.getElementById('userDropdown').classList.remove('active');
}

function logout() {
    if (confirm('Are you sure you want to logout?')) {
        // Close dropdown first
        const dropdown = document.getElementById('userDropdown');
        if (dropdown) dropdown.classList.remove('active');
        
        // Show logout message
        alert('Logging out... Redirecting to login page.');
        
        // ACTUAL REDIRECT - Choose ONE of these options:
        
        // OPTION 1: Redirect to a specific login page (RECOMMENDED)
        window.location.href = 'delhi_waterlog_landing.html'; // Your actual login page
        
        // OPTION 2: If you want to redirect to the same page with logout parameter
        // window.location.href = window.location.pathname + '?logout=success';
        
        // OPTION 3: Redirect to home page
        // window.location.href = '/';
        
        // OPTION 4: Reload page (clears all state)
        // window.location.reload();
    }
    return false; // Prevent default link behavior
}

// Show page (NO CHANGE)
function showPage(pageId, event) {
    if (currentPage === pageId) return;
    
    document.querySelectorAll('.content-page').forEach(page => {
        page.classList.remove('active');
    });
    document.getElementById(pageId).classList.add('active');
    
    document.querySelectorAll('.menu-item').forEach(item => {
        item.classList.remove('active');
    });
    
    if (event && event.currentTarget) {
        event.currentTarget.classList.add('active');
    }
    
    currentPage = pageId;
    
    // Initialize charts for analytics page
    if (pageId === 'analytics') {
        setTimeout(initAnalyticsCharts, 100);
    }
    // Initialize charts for rainfall page
    else if (pageId === 'rainfall') {
        setTimeout(initRainfallCharts, 100);
    }
    // Initialize complaints page
    else if (pageId === 'complaints') {
        setTimeout(loadComplaintsData, 100);
    }
}

// Toggle sidebar on mobile (NO CHANGE)
function toggleSidebar() {
    const sidebar = document.getElementById('sidebar');
    sidebar.classList.toggle('active');
}

// Initialize analytics charts (NO CHANGE)
function initAnalyticsCharts() {
    // ADD THESE LINES AT THE BEGINNING:
    if (!allWards || allWards.length === 0) {
        console.warn('No ward data available for analytics charts');
        return;
    }
    
    // Calculate risk distribution
    const riskDistribution = {
        high: allWards.filter(w => w.riskLevel === 'high').length,
        medium: allWards.filter(w => w.riskLevel === 'medium').length,
        low: allWards.filter(w => w.riskLevel === 'low').length
    };
    
    // 1. Risk Trends Chart - Add canvas null check
    const canvas1 = document.getElementById('riskTrendChart');
    if (!canvas1) {
        console.error('riskTrendChart canvas not found - skipping chart');
        return;
    }
    const ctx1 = canvas1.getContext('2d');
    if (!ctx1) {
        console.error('Could not get 2D context for riskTrendChart');
        return;
    }
    if (charts.riskTrend) charts.riskTrend.destroy();
    
    charts.riskTrend = new Chart(ctx1, {
        type: 'doughnut',
        data: {
            labels: Object.keys(riskDistribution),
            datasets: [{
                data: Object.values(riskDistribution),
                backgroundColor: ['#dc2626', '#f59e0b', '#10b981'],
                borderWidth: 2,
                borderColor: '#ffffff',
                hoverOffset: 20
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                title: {
                    display: true,
                    text: 'Bayesian Ensemble Model: Risk Distribution',
                    font: { size: 14 }
                },
                legend: {
                    position: 'top',
                },
                tooltip: {
                    callbacks: {
                        label: function(context) {
                            const label = context.label || '';
                            const value = context.raw || 0;
                            const percentage = ((value / allWards.length) * 100).toFixed(1);
                            return `${label}: ${value} wards (${percentage}%)`;
                        }
                    }
                }
            }
        }
    });
    
    // 2. Zone Distribution Chart - Add canvas null check
    const canvas2 = document.getElementById('zoneDistributionChart');
    if (!canvas2) {
        console.error('zoneDistributionChart canvas not found - skipping chart');
        return;
    }
    const ctx2 = canvas2.getContext('2d');
    if (!ctx2) {
        console.error('Could not get 2D context for zoneDistributionChart');
        return;
    }
    if (charts.zoneDistribution) charts.zoneDistribution.destroy();
    
    // Group wards by zone and calculate average risk score
    const zones = ['north', 'south', 'east', 'west', 'central', 'new-delhi'];
    const zoneRiskData = zones.map(zone => {
        const zoneWards = allWards.filter(w => w.zone === zone);
        if (zoneWards.length === 0) return 0;
        const avgRisk = zoneWards.reduce((sum, w) => sum + w.riskScore, 0) / zoneWards.length;
        return avgRisk * 10; // Convert to percentage
    });
    
    charts.zoneDistribution = new Chart(ctx2, {
        type: 'bar',
        data: {
            labels: zones.map(z => z.charAt(0).toUpperCase() + z.slice(1) + ' Delhi'),
            datasets: [{
                label: 'Average Risk Score (%)',
                data: zoneRiskData,
                backgroundColor: ['#3b82f6', '#10b981', '#8b5cf6', '#f59e0b', '#ef4444', '#64748b'],
                borderWidth: 1
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                title: {
                    display: true,
                    text: 'Zone-wise Risk Analysis (ML Model)',
                    font: { size: 14 }
                }
            },
            scales: {
                y: {
                    beginAtZero: true,
                    max: 100,
                    title: {
                        display: true,
                        text: 'Risk Score (%)'
                    }
                }
            }
        }
    });
    
    // 3. Correlation Chart - Add canvas null check
    const canvas3 = document.getElementById('correlationChart');
    if (!canvas3) {
        console.error('correlationChart canvas not found - skipping chart');
        return;
    }
    const ctx3 = canvas3.getContext('2d');
    if (!ctx3) {
        console.error('Could not get 2D context for correlationChart');
        return;
    }
    if (charts.correlation) charts.correlation.destroy();
    
    // Prepare data for scatter plot
    const scatterData = allWards.map(ward => ({
        x: ward.avgRainfall,
        y: ward.riskScore * 10, // Convert to percentage
        wardNo: ward.wardNo,
        wardName: ward.wardName
    }));
    
    charts.correlation = new Chart(ctx3, {
        type: 'scatter',
        data: {
            datasets: [{
                label: 'Wards',
                data: scatterData,
                backgroundColor: function(context) {
                    const value = context.raw.y;
                    if (value >= 70) return '#dc2626';
                    if (value >= 50) return '#f59e0b';
                    return '#10b981';
                },
                pointRadius: 6,
                pointHoverRadius: 10
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                title: {
                    display: true,
                    text: 'Rainfall vs Risk Score Correlation',
                    font: { size: 14 }
                },
                tooltip: {
                    callbacks: {
                        title: function(context) {
                            const point = context[0];
                            const ward = scatterData.find(d => d.x === point.parsed.x && d.y === point.parsed.y);
                            return ward ? `Ward ${ward.wardNo}: ${ward.wardName}` : '';
                        },
                        label: function(context) {
                            return [
                                `Rainfall: ${context.parsed.x}mm/year`,
                                `Risk Score: ${context.parsed.y.toFixed(1)}%`,
                                `Zone: ${allWards.find(w => w.wardNo === scatterData[context.dataIndex].wardNo)?.zone || 'Unknown'}`
                            ];
                        }
                    }
                }
            },
            scales: {
                x: {
                    title: {
                        display: true,
                        text: 'Annual Rainfall (mm)'
                    }
                },
                y: {
                    title: {
                        display: true,
                        text: 'Risk Score (%)'
                    },
                    min: 0,
                    max: 100
                }
            }
        }
    });
        // 4. Top Wards Chart - FIXED VERSION
    const canvas4 = document.getElementById('topWardsChart');
    if (!canvas4) {
        console.error('topWardsChart canvas not found - skipping chart');
        return;
    }
    const ctx4 = canvas4.getContext('2d');
    if (!ctx4) {
        console.error('Could not get 2D context for topWardsChart');
        return;
    }
    if (charts.topWards) charts.topWards.destroy();

    const topWards = [...allWards]
        .sort((a, b) => b.riskScore - a.riskScore)
        .slice(0, 10);

    charts.topWards = new Chart(ctx4, {
        type: 'bar',
        data: {
            labels: topWards.map(w => {
                const name = w.wardName || `Ward ${w.wardNo}`;
                return name.length > 20 ? name.substring(0, 18) + '...' : name;
            }),
            datasets: [{
                label: 'Risk Score (0-10)',
                data: topWards.map(w => w.riskScore),
                backgroundColor: function(context) {
                    const value = context.dataset.data[context.dataIndex];
                    if (value >= 7) return '#dc2626';
                    if (value >= 5) return '#f59e0b';
                    return '#10b981';
                },
                borderColor: '#ffffff',
                borderWidth: 1,
                borderRadius: 4
            }]
        },
        options: {
            indexAxis: 'y',
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                title: {
                    display: true,
                    text: 'Top 10 High-Risk Wards (ML Predictions)',
                    font: { size: 14, weight: 'bold' },
                    color: document.documentElement.getAttribute('data-theme') === 'dark' ? '#ffffff' : '#1e293b'
                },
                legend: { display: false },
                tooltip: {
                    callbacks: {
                        title: function(tooltipItems) {
                            const index = tooltipItems[0].dataIndex;
                            return `${topWards[index].wardName} (Ward ${topWards[index].wardNo})`;
                        },
                        label: function(context) {
                            const ward = topWards[context.dataIndex];
                            return [
                                `Risk Score: ${ward.riskScore.toFixed(1)}/10`,
                                `Risk Level: ${ward.riskLevel.toUpperCase()}`,
                                `Rainfall: ${ward.avgRainfall}mm/year`,
                                `Drainage: ${ward.drainageScore.toFixed(1)}/10`
                            ];
                        }
                    }
                }
            },
            scales: {
                x: {
                    beginAtZero: true,
                    max: 10,
                    title: {
                        display: true,
                        text: 'Risk Score (0-10)',
                        color: document.documentElement.getAttribute('data-theme') === 'dark' ? '#e2e8f0' : '#475569'
                    },
                    grid: {
                        color: document.documentElement.getAttribute('data-theme') === 'dark' ? '#2a3346' : '#e2e8f0'
                    },
                    ticks: {
                        color: document.documentElement.getAttribute('data-theme') === 'dark' ? '#e2e8f0' : '#475569'
                    }
                },
                y: {
                    title: {
                        display: true,
                        text: 'Ward Name',
                        color: document.documentElement.getAttribute('data-theme') === 'dark' ? '#e2e8f0' : '#475569'
                    },
                    grid: { display: false },
                    ticks: {
                        color: document.documentElement.getAttribute('data-theme') === 'dark' ? '#e2e8f0' : '#475569',
                        font: { size: 11 }
                    }
                }
            }
        }
    });
}          
    
// Update analytics charts (NO CHANGE)
function updateAnalyticsCharts() {
    const period = parseInt(document.getElementById('trendPeriod').value);
    
    // Update risk trends based on selected period
    if (charts.riskTrend) {
        const labels = Array.from({length: period}, (_, i) => {
            if (period === 7) return ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'][i];
            if (period === 30) return `Day ${i+1}`;
            if (period === 90) return `Week ${Math.floor(i/7)+1}`;
            return `Month ${i+1}`;
        });
        
        charts.riskTrend.data.labels = labels;
        
        // Generate data based on period
        const generateData = (base, variation) => {
            return Array.from({length: period}, (_, i) => {
                const trend = period === 365 ? Math.sin(i/12) * 0.3 + 1 : 1;
                return base + (Math.random() * variation - variation/2) * trend;
            }).map(n => Math.round(n));
        };
        
        charts.riskTrend.data.datasets[0].data = generateData(15, 5);
        charts.riskTrend.data.datasets[1].data = generateData(40, 8);
        charts.riskTrend.data.datasets[2].data = generateData(195, 10);
        
        charts.riskTrend.update();
    }
    
    alert(`Analytics updated for last ${period} days`);
}

// Initialize rainfall charts (NO CHANGE)
function initRainfallCharts() {
    if (!allWards || allWards.length === 0) return;
    
   // Real-time Rainfall Chart - Using ML predictions
    const canvasRain1 = document.getElementById('rainfallRealTimeChart');
    if (!canvasRain1) {
        console.error('rainfallRealTimeChart canvas not found - skipping chart');
        return;
    }
    const ctx1 = canvasRain1.getContext('2d');
    if (!ctx1) {
        console.error('Could not get 2D context for rainfallRealTimeChart');
        return;
    }
    if (charts.rainfallRealTime) charts.rainfallRealTime.destroy();
    
    
    // Get top 10 high-risk wards for rainfall analysis
    const highRiskWards = [...allWards]
        .filter(w => w.riskLevel === 'high')
        .sort((a, b) => b.avgRainfall - a.avgRainfall)
        .slice(0, 10);
    
    const wardNames = highRiskWards.map(w => `W${w.wardNo}`);
    const rainfallData = highRiskWards.map(w => w.avgRainfall);
    const riskScores = highRiskWards.map(w => w.riskScore * 10); // Convert to percentage
    
    charts.rainfallRealTime = new Chart(ctx1, {
        type: 'bar',
        data: {
            labels: wardNames,
            datasets: [
                {
                    label: 'Annual Rainfall (mm)',
                    data: rainfallData,
                    backgroundColor: '#0ea5e9',
                    borderColor: '#0369a1',
                    borderWidth: 1,
                    yAxisID: 'y'
                },
                {
                    label: 'Risk Score (%)',
                    data: riskScores,
                    type: 'line',
                    borderColor: '#ef4444',
                    backgroundColor: 'rgba(239, 68, 68, 0.1)',
                    tension: 0.4,
                    fill: true,
                    yAxisID: 'y1'
                }
            ]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                title: {
                    display: true,
                    text: 'Top 10 High-Risk Wards: Rainfall vs Risk Score',
                    font: { size: 14 }
                },
                tooltip: {
                    callbacks: {
                        title: function(tooltipItems) {
                            const index = tooltipItems[0].dataIndex;
                            return `Ward ${highRiskWards[index].wardNo}: ${highRiskWards[index].wardName}`;
                        }
                    }
                }
            },
            scales: {
                y: {
                    type: 'linear',
                    position: 'left',
                    title: {
                        display: true,
                        text: 'Rainfall (mm/year)'
                    },
                    grid: { drawOnChartArea: false }
                },
                y1: {
                    type: 'linear',
                    position: 'right',
                    title: {
                        display: true,
                        text: 'Risk Score (%)'
                    },
                    min: 0,
                    max: 100,
                    grid: { drawOnChartArea: false }
                }
            }
        }
    });
    
    // Annual Rainfall Distribution Chart
    const canvasRain2 = document.getElementById('annualRainfallChart');
    if (!canvasRain2) {
        console.error('annualRainfallChart canvas not found - skipping chart');
        return;
    }
    const ctx2 = canvasRain2.getContext('2d');
    if (!ctx2) {
        console.error('Could not get 2D context for annualRainfallChart');
        return;
    }
    if (charts.annualRainfall) charts.annualRainfall.destroy();
    // Categorize wards by rainfall with debug
     console.log(' Rainfall Distribution Debug:');
     console.log('Rainfall values:', allWards.map(w => w.avgRainfall).slice(0, 5));

     const rainfallCategories = {
     'Very High (>1400mm)': allWards.filter(w => w.avgRainfall > 1400).length,
     'High (1200-1400mm)': allWards.filter(w => w.avgRainfall >= 1200 && w.avgRainfall <= 1400).length,
     'Moderate (800-1200mm)': allWards.filter(w => w.avgRainfall >= 800 && w.avgRainfall < 1200).length,
     'Low (<800mm)': allWards.filter(w => w.avgRainfall < 800).length
    };

    console.log('Rainfall Categories:', rainfallCategories);

    // Check if all wards are falling into one category
    const total = Object.values(rainfallCategories).reduce((a, b) => a + b, 0);
    if (total !== allWards.length) {
     console.warn(` Category total (${total}) doesn't match wards count (${allWards.length})`);
    }
    
    charts.annualRainfall = new Chart(ctx2, {
        type: 'pie',
        data: {
            labels: Object.keys(rainfallCategories),
            datasets: [{
                data: Object.values(rainfallCategories),
                backgroundColor: ['#ef4444', '#f97316', '#eab308', '#22c55e'],
                borderWidth: 2,
                borderColor: '#ffffff'
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                title: {
                    display: true,
                    text: 'Rainfall Distribution Across Delhi Wards',
                    font: { size: 14 }
                },
                tooltip: {
                    callbacks: {
                        label: function(context) {
                            const label = context.label || '';
                            const value = context.raw || 0;
                            const percentage = ((value / allWards.length) * 100).toFixed(1);
                            return `${label}: ${value} wards (${percentage}%)`;
                        }
                    }
                }
            }
        }
    });
    
    // Update rainfall stats with ML data
    const totalRainfall = allWards.reduce((sum, ward) => sum + ward.avgRainfall, 0);
    const avgRainfall = totalRainfall / allWards.length;
    const maxRainfall = Math.max(...allWards.map(w => w.avgRainfall));
    
    document.getElementById('currentRainfall').textContent = `${(avgRainfall / 12).toFixed(1)} mm/hr`;
    document.getElementById('todayRainfall').textContent = `${(avgRainfall / 365).toFixed(1)} mm`;
    document.getElementById('monthlyRainfall').textContent = `${avgRainfall.toFixed(1)} mm`;
    document.getElementById('annualRainfall').textContent = `${maxRainfall.toFixed(1)} mm`;
}

function loadComplaintsData() {
    console.log(' Loading complaints data...');
    
    const tbody = document.getElementById('complaintsTableBody');
    if (!tbody) {
        console.error('Complaints table body not found');
        return;
    }
    
    tbody.innerHTML = '';
    
    // Load from localStorage
    complaintsData = JSON.parse(localStorage.getItem('complaints') || '[]');
    
    // If empty, add sample data
    if (complaintsData.length === 0) {
        complaintsData = [
            {id: 'COMP-001', date: '2024-01-15', name: 'Rahul Sharma', ward: 'NARELA', type: 'Water-logging', status: 'pending', priority: 'high', description: 'Severe water logging on main road near bus stop', phone: '9876543210', address: 'Main Road, Narela'},
            {id: 'COMP-002', date: '2024-01-15', name: 'Priya Singh', ward: 'CIVIL LINES', type: 'Drainage Blockage', status: 'in-progress', priority: 'medium', description: 'Drainage completely blocked, water entering houses', phone: '9876543211', address: 'Block C, Civil Lines'},
            {id: 'COMP-003', date: '2024-01-14', name: 'Amit Kumar', ward: 'ISAPUR', type: 'Road Flooding', status: 'resolved', priority: 'high', description: 'Road completely submerged', phone: '9876543212', address: 'Near Isapur Crossing'}
        ];
        localStorage.setItem('complaints', JSON.stringify(complaintsData));
    }
    
    // Render complaints
    complaintsData.forEach(complaint => {
        const row = document.createElement('tr');
        row.innerHTML = `
            <td><strong>${complaint.id}</strong></td>
            <td>${complaint.date}</td>
            <td>${complaint.name}</td>
            <td>${complaint.ward}</td>
            <td>${complaint.type}</td>
            <td><span class="status-badge status-${complaint.status}">${complaint.status === 'in-progress' ? 'In Progress' : complaint.status}</span></td>
            <td><span class="priority-badge priority-${complaint.priority}">${complaint.priority}</span></td>
            <td>
                <div class="action-buttons">
                    <button class="btn-icon view" title="View Details" onclick="viewComplaint('${complaint.id}')">
                        <i class="fas fa-eye"></i>
                    </button>
                    <button class="btn-icon edit" title="Update Status" onclick="editComplaint('${complaint.id}')">
                        <i class="fas fa-edit"></i>
                    </button>
                    <button class="btn-icon delete" title="Delete" onclick="deleteComplaint('${complaint.id}')">
                        <i class="fas fa-trash"></i>
                    </button>
                </div>
            </td>
        `;
        tbody.appendChild(row);
    });
    
    // Update counts
    document.getElementById('pendingCount').textContent = complaintsData.filter(c => c.status === 'pending').length;
    document.getElementById('inProgressCount').textContent = complaintsData.filter(c => c.status === 'in-progress').length;
    document.getElementById('resolvedCount').textContent = complaintsData.filter(c => c.status === 'resolved').length;
    
    console.log(` Loaded ${complaintsData.length} complaints`);
    
    // Update chart
    updateComplaintsChart();
}

// New function to update chart
function updateComplaintsChart() {
    const canvas = document.getElementById('complaintsChart');
    if (!canvas) return;
    
    const ctx = canvas.getContext('2d');
    if (!ctx) return;
    
    // Group by month
    const months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
    const monthlyData = new Array(12).fill(0);
    
    complaintsData.forEach(c => {
        const month = new Date(c.date).getMonth();
        monthlyData[month]++;
    });
    
    if (charts.complaints) charts.complaints.destroy();
    
    charts.complaints = new Chart(ctx, {
        type: 'bar',
        data: {
            labels: months,
            datasets: [{
                label: 'Complaints Received',
                data: monthlyData,
                backgroundColor: '#1e3a8a',
                borderColor: '#1e40af',
                borderWidth: 1
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: { legend: { display: false } },
            scales: {
                y: { beginAtZero: true, title: { display: true, text: 'Number of Complaints' } }
            }
        }
    });
}

// Global complaints data
let complaintsData = [];

function viewComplaint(id) {
    const complaint = complaintsData.find(c => c.id === id);
    if (!complaint) {
        alert('Complaint not found!');
        return;
    }
    
    // Create and show modal with complaint details
    const modalHtml = `
        <div class="modal active" id="viewComplaintModal" style="display: flex;">
            <div class="modal-content" style="max-width: 600px;">
                <div class="modal-header">
                    <h3><i class="fas fa-file-alt"></i> Complaint Details: ${id}</h3>
                    <button class="modal-close" onclick="closeViewModal()"></button>
                </div>
                <div class="modal-body">
                    <table style="width: 100%; border-collapse: collapse;">
                        <tr style="border-bottom: 1px solid #e2e8f0;">
                            <td style="padding: 12px 0; color: #64748b; width: 40%;"><strong>Date:</strong></td>
                            <td style="padding: 12px 0;">${complaint.date}</td>
                        </tr>
                        <tr style="border-bottom: 1px solid #e2e8f0;">
                            <td style="padding: 12px 0; color: #64748b;"><strong>Complainant:</strong></td>
                            <td style="padding: 12px 0;">${complaint.name}</td>
                        </tr>
                        <tr style="border-bottom: 1px solid #e2e8f0;">
                            <td style="padding: 12px 0; color: #64748b;"><strong>Ward:</strong></td>
                            <td style="padding: 12px 0;">${complaint.ward}</td>
                        </tr>
                        <tr style="border-bottom: 1px solid #e2e8f0;">
                            <td style="padding: 12px 0; color: #64748b;"><strong>Type:</strong></td>
                            <td style="padding: 12px 0;">${complaint.type}</td>
                        </tr>
                        <tr style="border-bottom: 1px solid #e2e8f0;">
                            <td style="padding: 12px 0; color: #64748b;"><strong>Status:</strong></td>
                            <td style="padding: 12px 0;">
                                <span class="status-badge status-${complaint.status}">${complaint.status}</span>
                            </td>
                        </tr>
                        <tr style="border-bottom: 1px solid #e2e8f0;">
                            <td style="padding: 12px 0; color: #64748b;"><strong>Priority:</strong></td>
                            <td style="padding: 12px 0;">
                                <span class="priority-badge priority-${complaint.priority}">${complaint.priority}</span>
                            </td>
                        </tr>
                        <tr>
                            <td style="padding: 12px 0; color: #64748b; vertical-align: top;"><strong>Description:</strong></td>
                            <td style="padding: 12px 0;">${complaint.description || 'No description provided'}</td>
                        </tr>
                    </table>
                    <div style="margin-top: 30px; display: flex; gap: 10px; justify-content: flex-end;">
                        <button class="btn-secondary" onclick="closeViewModal()">Close</button>
                        <button class="btn-primary" onclick="editComplaint('${id}'); closeViewModal();">Edit Complaint</button>
                    </div>
                </div>
            </div>
        </div>
    `;
    
    // Remove existing modal if any
    const existingModal = document.getElementById('viewComplaintModal');
    if (existingModal) existingModal.remove();
    
    // Add modal to page
    document.body.insertAdjacentHTML('beforeend', modalHtml);
}

function closeViewModal() {
    const modal = document.getElementById('viewComplaintModal');
    if (modal) modal.remove();
}

function editComplaint(id) {
    const complaint = complaintsData.find(c => c.id === id);
    if (!complaint) {
        alert('Complaint not found!');
        return;
    }
    
    // Create edit modal
    const modalHtml = `
        <div class="modal active" id="editComplaintModal" style="display: flex;">
            <div class="modal-content" style="max-width: 500px;">
                <div class="modal-header">
                    <h3><i class="fas fa-edit"></i> Edit Complaint: ${id}</h3>
                    <button class="modal-close" onclick="closeEditModal()"></button>
                </div>
                <div class="modal-body">
                    <form id="editComplaintForm" onsubmit="updateComplaint(event, '${id}')">
                        <div class="form-group">
                            <label><i class="fas fa-tag"></i> Status</label>
                            <select id="edit-status" required>
                                <option value="pending" ${complaint.status === 'pending' ? 'selected' : ''}>Pending</option>
                                <option value="in-progress" ${complaint.status === 'in-progress' ? 'selected' : ''}>In Progress</option>
                                <option value="resolved" ${complaint.status === 'resolved' ? 'selected' : ''}>Resolved</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label><i class="fas fa-exclamation-circle"></i> Priority</label>
                            <select id="edit-priority" required>
                                <option value="low" ${complaint.priority === 'low' ? 'selected' : ''}>Low</option>
                                <option value="medium" ${complaint.priority === 'medium' ? 'selected' : ''}>Medium</option>
                                <option value="high" ${complaint.priority === 'high' ? 'selected' : ''}>High</option>
                                <option value="urgent" ${complaint.priority === 'urgent' ? 'selected' : ''}>Urgent</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label><i class="fas fa-align-left"></i> Admin Notes</label>
                            <textarea id="edit-notes" rows="3" placeholder="Add resolution notes...">${complaint.notes || ''}</textarea>
                        </div>
                        
                        <div class="form-actions">
                            <button type="button" class="btn-secondary" onclick="closeEditModal()">Cancel</button>
                            <button type="submit" class="btn-primary">
                                <i class="fas fa-save"></i> Update Complaint
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    `;
    
    // Remove existing modal if any
    const existingModal = document.getElementById('editComplaintModal');
    if (existingModal) existingModal.remove();
    
    // Add modal to page
    document.body.insertAdjacentHTML('beforeend', modalHtml);
}

function closeEditModal() {
    const modal = document.getElementById('editComplaintModal');
    if (modal) modal.remove();
}

function updateComplaint(event, id) {
    event.preventDefault();
    
    const status = document.getElementById('edit-status').value;
    const priority = document.getElementById('edit-priority').value;
    const notes = document.getElementById('edit-notes').value;
    
    // Update complaint in array
    const complaintIndex = complaintsData.findIndex(c => c.id === id);
    if (complaintIndex !== -1) {
        complaintsData[complaintIndex].status = status;
        complaintsData[complaintIndex].priority = priority;
        complaintsData[complaintIndex].notes = notes;
        complaintsData[complaintIndex].lastUpdated = new Date().toISOString().split('T')[0];
    }
    
    alert(` Complaint ${id} updated successfully!\n\nStatus: ${status}\nPriority: ${priority}`);
    
    closeEditModal();
    loadComplaintsData(); // Refresh the table
}

function deleteComplaint(id) {
    if (confirm(` Are you sure you want to delete complaint ${id}? This action cannot be undone.`)) {
        console.log(`Deleting complaint: ${id}`);
        
        // Find the index
        const index = complaintsData.findIndex(c => c.id === id);
        
        if (index !== -1) {
            // Remove from array
            complaintsData.splice(index, 1);
            
            // Update the counts
            document.getElementById('pendingCount').textContent = complaintsData.filter(c => c.status === 'pending').length;
            document.getElementById('inProgressCount').textContent = complaintsData.filter(c => c.status === 'in-progress').length;
            document.getElementById('resolvedCount').textContent = complaintsData.filter(c => c.status === 'resolved').length;
            
            // Refresh the table WITHOUT reloading the page
            const tbody = document.getElementById('complaintsTableBody');
            if (tbody) {
                tbody.innerHTML = ''; // Clear table
                
                // Re-render all complaints
                complaintsData.forEach(complaint => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td><strong>${complaint.id}</strong></td>
                        <td>${complaint.date}</td>
                        <td>${complaint.name}</td>
                        <td>${complaint.ward}</td>
                        <td>${complaint.type}</td>
                        <td><span class="status-badge status-${complaint.status}">${complaint.status === 'in-progress' ? 'In Progress' : complaint.status}</span></td>
                        <td><span class="priority-badge priority-${complaint.priority}">${complaint.priority}</span></td>
                        <td>
                            <div class="action-buttons">
                                <button class="btn-icon view" title="View Details" onclick="viewComplaint('${complaint.id}')">
                                    <i class="fas fa-eye"></i>
                                </button>
                                <button class="btn-icon edit" title="Edit Status" onclick="editComplaint('${complaint.id}')">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="btn-icon delete" title="Delete" onclick="deleteComplaint('${complaint.id}')">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </td>
                    `;
                    tbody.appendChild(row);
                });
            }
            
            alert(` Complaint ${id} deleted successfully`);
        } else {
            alert(' Complaint not found!');
        }
    }
}

// Modal functions (NO CHANGE)
function openAddHotspotModal() {
    const modal = document.getElementById('addHotspotModal');
    modal.classList.add('active');
    
    // Populate ward dropdown
    const select = document.getElementById('hotspotWard');
    select.innerHTML = '<option value="">Select Ward</option>';
    
    // ADD SAFETY CHECK
    if (!allWards || allWards.length === 0) {
        console.error('Cannot populate wards - no data available');
        const option = document.createElement('option');
        option.value = '';
        option.textContent = 'Loading wards... (please wait)';
        option.disabled = true;
        select.appendChild(option);
        
        // Try again after 2 seconds
        setTimeout(() => {
            if (allWards && allWards.length > 0) {
                openAddHotspotModal();
            }
        }, 2000);
        return;
    }
    
    allWards.forEach(ward => {
        const option = document.createElement('option');
        option.value = ward.wardNo;
        option.textContent = `${ward.wardName} (Ward ${ward.wardNo})`;
        select.appendChild(option);
    });
}

function openEmergencyAlertModal() {
    document.getElementById('emergencyAlertModal').classList.add('active');
}

function openNewComplaintModal() {
    const modal = document.getElementById('newComplaintModal');
    modal.classList.add('active');
    
    // Populate ward dropdown
    const select = document.getElementById('complaintWard');
    select.innerHTML = '<option value="">Select Ward</option>';
    
    // ADD SAFETY CHECK
    if (!allWards || allWards.length === 0) {
        console.error('Cannot populate wards - no data available');
        const option = document.createElement('option');
        option.value = '';
        option.textContent = 'Loading wards... (please wait)';
        option.disabled = true;
        select.appendChild(option);
        
        // Try again after 2 seconds
        setTimeout(() => {
            if (allWards && allWards.length > 0) {
                openNewComplaintModal();
            }
        }, 2000);
        return;
    }
    
    allWards.forEach(ward => {
        const option = document.createElement('option');
        option.value = ward.wardNo;
        option.textContent = `${ward.wardName} (Ward ${ward.wardNo})`;
        select.appendChild(option);
    });
}

function closeModal(modalId) {
    document.getElementById(modalId).classList.remove('active');
}

// Form submissions (NO CHANGE)
function submitHotspot(event) {
    event.preventDefault();
    
    const hotspotName = document.getElementById('hotspotName').value;
    const wardNo = document.getElementById('hotspotWard').value;
    const severity = document.querySelector('input[name="severity"]:checked').value;
    const waterDepth = document.getElementById('waterDepth').value;
    const affectedArea = document.getElementById('affectedArea').value;
    const notes = document.getElementById('hotspotNotes').value;
    
    const ward = allWards.find(w => w.wardNo == wardNo);
    
    // Create new hotspot object
    const newHotspot = {
        id: 'HOTSPOT-' + Date.now(),
        name: hotspotName,
        wardNo: wardNo,
        wardName: ward.wardName,
        severity: severity,
        waterDepth: waterDepth,
        affectedArea: affectedArea,
        notes: notes,
        timestamp: new Date().toLocaleString(),
        lat: ward.lat,
        lng: ward.lng
    };
    
    // Store in localStorage
    let hotspots = JSON.parse(localStorage.getItem('hotspots') || '[]');
    hotspots.push(newHotspot);
    localStorage.setItem('hotspots', JSON.stringify(hotspots));
    
    // Add marker on map
    const color = severity === 'critical' ? '#000000' : 
                  severity === 'high' ? '#dc2626' : 
                  severity === 'medium' ? '#f59e0b' : '#10b981';
    
    const hotspotIcon = L.divIcon({
        className: 'hotspot-marker',
        html: `<div style="background-color: ${color}; width: 20px; height: 20px; border-radius: 50%; border: 3px solid white; box-shadow: 0 0 10px rgba(0,0,0,0.5); display: flex; align-items: center; justify-content: center; color: white; font-weight: bold; font-size: 12px;">H</div>`,
        iconSize: [20, 20],
        iconAnchor: [10, 10]
    });
    
    const marker = L.marker([ward.lat, ward.lng], { icon: hotspotIcon }).addTo(map);
    marker.bindPopup(`
        <b> Hotspot: ${hotspotName}</b><br>
        Ward: ${ward.wardName}<br>
        Severity: ${severity}<br>
        Water Depth: ${waterDepth}cm<br>
        Area: ${affectedArea} sq m<br>
        Time: ${newHotspot.timestamp}
    `);
    
    // Add to hotspots layer
    window.hotspotMarkers = window.hotspotMarkers || [];
    window.hotspotMarkers.push(marker);
    
    alert(` Hotspot "${hotspotName}" added successfully at ${ward.wardName}!`);
    addNewAlert('', `New hotspot added: ${hotspotName} in ${ward.wardName}`, 'warning');
    
    closeModal('addHotspotModal');
    document.getElementById('hotspotForm').reset();
}

function sendEmergencyAlert(event) {
    event.preventDefault();
    
    const alertType = document.getElementById('alertType').value;
    const zones = Array.from(document.querySelectorAll('input[name="zones"]:checked')).map(cb => cb.value);
    const severity = document.querySelector('input[name="severity"]:checked').value;
    const message = document.getElementById('alertMessage').value;
    const channels = Array.from(document.querySelectorAll('input[name="channels"]:checked')).map(cb => cb.value);
    
    alert(` Emergency Alert Sent!\n\nType: ${alertType}\nAffected Zones: ${zones.join(', ')}\nSeverity: ${severity}\nChannels: ${channels.join(', ')}\n\nAlert has been broadcasted to all specified channels.`);
    
    // Add alert about emergency
    addNewAlert('', `Emergency alert sent for ${zones.join(', ')} zones: ${message.substring(0, 50)}...`);
    
    closeModal('emergencyAlertModal');
    document.getElementById('emergencyAlertForm').reset();
}

function submitComplaint(event) {
    event.preventDefault();
    
    const name = document.getElementById('complaintName').value;
    const phone = document.getElementById('complaintPhone').value;
    const email = document.getElementById('complaintEmail').value || 'Not provided';
    const address = document.getElementById('complaintAddress').value;
    const wardNo = document.getElementById('complaintWard').value;
    const priority = document.getElementById('complaintPriority').value;
    const type = document.getElementById('complaintType').value;
    const description = document.getElementById('complaintDescription').value;
    
    const ward = allWards.find(w => w.wardNo == wardNo);
    
    // Create complaint object
    const newComplaint = {
        id: 'COMP-' + Date.now().toString().slice(-6),
        date: new Date().toISOString().split('T')[0],
        timestamp: new Date().toLocaleString(),
        name: name,
        phone: phone,
        email: email,
        address: address,
        ward: ward.wardName,
        wardNo: wardNo,
        type: type,
        status: 'pending',
        priority: priority,
        description: description
    };
    
    // Store in localStorage
    let complaints = JSON.parse(localStorage.getItem('complaints') || '[]');
    complaints.unshift(newComplaint); // Add to beginning
    localStorage.setItem('complaints', JSON.stringify(complaints));
    
    // Update global complaintsData
    complaintsData = complaints;
    
    alert(` Complaint #${newComplaint.id} registered successfully!\n\nName: ${name}\nWard: ${ward.wardName}\nPriority: ${priority}\n\nOur team will address it shortly.`);
    
    addNewAlert('', `New ${priority} priority complaint in ${ward.wardName}`, 'info');
    
    closeModal('newComplaintModal');
    document.getElementById('complaintForm').reset();
    
    // If on complaints page, refresh table
    if (currentPage === 'complaints') {
        loadComplaintsData();
    }
}

// Navigation functions (NO CHANGE)
function showNotifications() {
    document.getElementById('notificationsPanel').classList.add('active');
    loadNotifications();
}

function closeNotifications() {
    const panel = document.getElementById('notificationsPanel');
    if (panel) {
        panel.classList.remove('active');
    }
}

function loadNotifications() {
    const notifications = [
        {id: 1, title: 'Heavy Rainfall Warning', message: 'North Delhi: Expected 50mm rainfall in next 3 hours', time: '2 hours ago', unread: true},
        {id: 2, title: 'Drainage System Maintenance', message: 'Scheduled maintenance in Central Delhi wards tomorrow', time: '4 hours ago', unread: true},
        {id: 3, title: 'New Complaint Registered', message: 'Water-logging complaint received in Ward 126', time: '6 hours ago', unread: false},
        {id: 4, title: 'System Update', message: 'Risk assessment algorithm updated to version 2.1', time: '1 day ago', unread: false},
        {id: 5, title: 'Monthly Report Generated', message: 'January 2024 water-logging report is ready for review', time: '2 days ago', unread: false}
    ];
    
    const container = document.querySelector('.notifications-list');
    container.innerHTML = '';
    
    notifications.forEach(notif => {
        const item = document.createElement('div');
        item.className = `notification-item ${notif.unread ? 'unread' : ''}`;
        item.onclick = () => {
            item.classList.remove('unread');
            alert(`Notification: ${notif.title}\n\n${notif.message}`);
        };
        item.innerHTML = `
            <div class="notification-header">
                <div class="notification-title">${notif.title}</div>
                <div class="notification-time">${notif.time}</div>
            </div>
            <div class="notification-message">${notif.message}</div>
        `;
        container.appendChild(item);
    });
}

// Export Dashboard - Updated with PDF option
function exportDashboard() {
    // Create custom dialog
    const choice = confirm(
        ' Choose export format:\n\n' +
        'OK = PDF Report\n' +
        'Cancel = CSV Data\n\n' +
        '(Map image export is separate - use Map Export button)'
    );
    
    if (choice) {
        exportAsPDF();
    } else {
        exportAsCSV();
    }
}

function generateReport() {
    const highRisk = currentFilteredWards.filter(w => w.riskLevel === 'high').length;
    const mediumRisk = currentFilteredWards.filter(w => w.riskLevel === 'medium').length;
    const lowRisk = currentFilteredWards.filter(w => w.riskLevel === 'low').length;
    
    alert(' Generating comprehensive report...\n\n' +
          'Report includes:\n' +
          '- Ward-wise risk assessment (' + currentFilteredWards.length + ' wards)\n' +
          '- High Risk: ' + highRisk + ' wards\n' +
          '- Medium Risk: ' + mediumRisk + ' wards\n' +
          '- Low Risk: ' + lowRisk + ' wards\n' +
          '- Historical rainfall correlation analysis\n' +
          '- Drainage infrastructure assessment\n' +
          '- Action recommendations\n\n' +
          'Report will be downloaded as PDF.');
}

function refreshData() {
    alert(' Data refreshed successfully!\n\nAll ward data has been updated from IMD and MCD sources.');
    displayWardMarkers(allWards);
    
    // Add refresh alert
    addNewAlert('', 'System data refreshed successfully from all sources');
}

// Export Map - Updated with image option
function exportMap() {
    const choice = confirm(
        ' Export Map as:\n\n' +
        'OK = PNG Image\n' +
        'Cancel = GeoJSON'
    );
    
    if (choice) {
        exportMapAsImage();
    } else {
        exportAsGeoJSON();
    }
}

// Initialize application (NO CHANGE - except using updated generateAllWards)
// Add ML insights to dashboard
function updateStatsWithMLInsights() {
    // Update stats card labels to show ML confidence
    const highCountElem = document.getElementById('highRiskCount');
    const mediumCountElem = document.getElementById('mediumRiskCount');
    const lowCountElem = document.getElementById('lowRiskCount');
   // ADD NULL CHECKS
    if (!highCountElem || !mediumCountElem || !lowCountElem) {
        console.warn('Stat count elements not found yet');
        setTimeout(updateStatsWithMLInsights, 500); // Retry after 500ms
        return;
    }
    
    const highCard = highCountElem.closest('.stat-card');
    const mediumCard = mediumCountElem.closest('.stat-card');
    const lowCard = lowCountElem.closest('.stat-card');
    
    if (highCard) {
        const statLabel = highCard.querySelector('.stat-label');
        if (statLabel) {
            statLabel.innerHTML = 
                'High Risk Wards<br><small style="font-size: 0.7em; opacity: 0.8;">ML Predicted</small>';
        }
    }
    
    if (mediumCard) {
        const statLabel = mediumCard.querySelector('.stat-label');
        if (statLabel) {
            statLabel.innerHTML = 
                'Medium Risk Wards<br><small style="font-size: 0.7em; opacity: 0.8;">ML Predicted</small>';
        }
    }
    
    if (lowCard) {
        const statLabel = lowCard.querySelector('.stat-label');
        if (statLabel) {
            statLabel.innerHTML = 
                'Low Risk Wards<br><small style="font-size: 0.7em; opacity: 0.8;">ML Predicted</small>';
        }
    }
    
    // Update trend indicators
    document.querySelectorAll('.stat-trend').forEach(trend => {
        if (trend && trend.textContent) {
            trend.textContent = 'ML Model';
            trend.className = 'stat-trend stable';
        }
    });
    
    // Add ML model info alert after 2 seconds
    setTimeout(() => {
        addNewAlert('', 'ML Model Active: Water-logging predictions powered by Bayesian Ensemble Model', 'info');
    }, 2000);
}

// Also add a simpler test function
async function quickTest() {
    console.log('=== QUICK TEST ===');
    console.log('Current URL:', window.location.href);
    console.log('Current path:', window.location.pathname);
    
    try {
        const response = await fetch('predictions.json');
        console.log('Direct fetch status:', response.status);
        const text = await response.text();
        console.log('Direct fetch first 100 chars:', text.substring(0, 100));
        console.log('Direct fetch length:', text.length);
        
        // Try to parse as JSON
        try {
            const json = JSON.parse(text);
            console.log('Valid JSON! Length:', json.length);
            console.log('First item:', json[0]);
        } catch (e) {
            console.log('Not valid JSON:', e.message);
        }
    } catch (e) {
        console.log('Direct fetch error:', e.message);
    }
    
    // Also check if allWards is populated
    console.log('allWards length:', allWards ? allWards.length : 0);
    if (allWards && allWards.length > 0) {
        console.log('First 3 wards:', allWards.slice(0, 3));
    }
}

// Initialize application WITH ML PREDICTIONS - FIXED VERSION
async function initApp() {
    console.log('=== INITIALIZING APP ===');
    
    // 1. SHOW LOADING INDICATOR
    showLoadingIndicator();
    
    // 2. INITIALIZE NEW FEATURES
    initNewFeatures();
    initAlertToggle();
    initTheme();
    
    try {
         // 3. CRITICAL FIX: Wait a tiny bit for DOM to be ready, THEN init alert banner
        setTimeout(() => {
            initAlertBanner();
            console.log(' Alert banner initialized after DOM ready');
        }, 500);
        
        // 4. LOAD ML PREDICTIONS
        console.log(' Loading ML predictions...');
        allWards = await generateAllWards();
        // VERIFY WE HAVE DATA
        if (!allWards || allWards.length === 0) {
            console.warn('No ward data generated, using fallback');
            allWards = generateAllWardsFromCoordinates();
        }
        
        console.log(` Loaded ${allWards.length} wards`);
        verifyWardCoordinates(allWards);
        console.log('Sample ward:', allWards[0]);
        
        // 5. Update UI with ward data IMMEDIATELY
        updateStats(allWards);
        updateWardList(allWards);
        currentFilteredWards = [...allWards];
        
        // 6. Try to initialize map
        try {
            if (typeof L !== 'undefined') {
                initMap();
            } else {
                console.log('Waiting for Leaflet to load...');
                setTimeout(() => {
                    if (typeof L !== 'undefined') {
                        initMap();
                    } else {
                        showMapErrorFallback();
                    }
                }, 1000);
            }
        } catch (mapError) {
            console.error('Map initialization failed:', mapError);
            showMapErrorFallback();
        }
        
        // 7. Initialize charts based on current page
        setTimeout(() => {
            if (currentPage === 'analytics') {
                try { initAnalyticsCharts(); } catch (e) { console.error('Analytics charts error:', e); }
            } else if (currentPage === 'rainfall') {
                try { initRainfallCharts(); } catch (e) { console.error('Rainfall charts error:', e); }
            } else if (currentPage === 'complaints') {
                try { loadComplaintsData(); } catch (e) { console.error('Complaints data error:', e); }
            }
        }, 500);
        
        // 8. ADD ML INSIGHTS
        updateStatsWithMLInsights();
        
        // 9. START ALERT INTERVAL
        startAlertInterval();
        
        console.log(' ML-Powered Delhi Water-logging System initialized');
        console.log(` High Risk: ${allWards.filter(w => w.riskLevel === 'high').length}`);
        console.log(` Medium Risk: ${allWards.filter(w => w.riskLevel === 'medium').length}`);
        console.log(` Low Risk: ${allWards.filter(w => w.riskLevel === 'low').length}`);
        
    } catch (error) {
        console.error(' CRITICAL INITIALIZATION ERROR:', error);
        
        // Even on error, try to show fallback data
        try {
            if (!allWards || allWards.length === 0) {
                allWards = generateAllWardsFromCoordinates();
                updateStats(allWards);
                updateWardList(allWards);
                currentFilteredWards = [...allWards];
                console.log(' Fallback data loaded after error');
            }
        } catch (fallbackError) {
            console.error('Even fallback failed:', fallbackError);
        }
        
        showCriticalError(error);
    } finally {
        // 11. HIDE LOADING INDICATOR
        setTimeout(() => {
            hideLoadingIndicator();
        }, 1000);
    }
}
// Initialize when DOM is loaded (NO CHANGE)
document.addEventListener('DOMContentLoaded', initApp);

// Force all markers to be visible
function forceAllMarkersVisible() {
    if (!map || !mapInitialized || !allWards || allWards.length === 0) return;
    
    console.log(' Forcing all markers to be visible...');
    
    // Clear and re-add all markers
    markers.forEach(marker => {
        if (marker) map.removeLayer(marker);
    });
    markers = [];
    
    // Add ALL markers
    let added = 0;
    allWards.forEach(ward => {
        try {
            const marker = createWardMarker(ward);
            if (marker) {
                marker.addTo(map);
                markers.push(marker);
                added++;
            }
        } catch (e) {
            console.warn('Error adding marker for ward', ward?.wardNo);
        }
    });
    
    console.log(` Force refresh: Added ${added}/${allWards.length} markers`);
    
    // Fit bounds
    if (markers.length > 0) {
        try {
            const group = L.featureGroup(markers);
            if (group.getBounds().isValid()) {
                map.fitBounds(group.getBounds().pad(0.1));
            }
        } catch (e) {}
    }
}

// Fix the displayWardMarkers function to show ALL markers with proper bounds
function displayWardMarkers(wards) {
    currentFilteredWards = wards || [];
    updateStats(wards);
    updateWardList(wards);
    
    if (!map || !mapInitialized) {
        console.log('Map not ready, skipping marker display');
        return;
    }
    
    // Clear existing markers
    markers.forEach(marker => {
        if (marker) map.removeLayer(marker);
    });
    markers = [];
    
    console.log(` Adding ${wards.length} markers to map...`);
    
    // Add ALL markers
    let added = 0;
    let failed = 0;
    
    wards.forEach(ward => {
        try {
            const marker = createWardMarker(ward);
            if (marker) {
                marker.addTo(map);
                markers.push(marker);
                added++;
            } else {
                failed++;
            }
        } catch (e) {
            console.warn('Error adding marker for ward', ward?.wardNo);
            failed++;
        }
    });
    
    console.log(` Added ${added}/${wards.length} markers (${failed} failed)`);
    
    // CRITICAL FIX: Fit bounds to show ALL markers
    if (markers.length > 0) {
        try {
            const group = L.featureGroup(markers);
            if (group.getBounds().isValid()) {
                // Get bounds and add padding
                const bounds = group.getBounds();
                map.fitBounds(bounds, { 
                    padding: [50, 50],
                    maxZoom: 12 
                });
                console.log(' Map zoomed to show all markers');
                console.log('Bounds:', bounds.toBBoxString());
            } else {
                // Fallback if bounds are invalid
                map.setView([28.6139, 77.2090], 11);
            }
        } catch (e) {
            console.warn('Could not fit bounds:', e);
            map.setView([28.6139, 77.2090], 11);
        }
    }
}
 
// Add debug function to verify coordinates
function verifyWardCoordinates(wards) {
    console.log('=== VERIFYING WARD COORDINATES ===');
    let valid = 0;
    let invalid = 0;
    
    wards.forEach(ward => {
        if (ward.lat && ward.lng && 
            !isNaN(ward.lat) && !isNaN(ward.lng) &&
            ward.lat >= 28.4 && ward.lat <= 28.9 &&
            ward.lng >= 76.8 && ward.lng <= 77.4) {
            valid++;
        } else {
            invalid++;
            console.warn(`Invalid coordinates for ${ward.wardName}:`, 
                        {lat: ward.lat, lng: ward.lng});
        }
    });
    
    console.log(` Valid coordinates: ${valid}`);
    console.log(` Invalid coordinates: ${invalid}`);
    return valid > 0;
}

function generateAllWardsFromCoordinates() {
    console.log(' Generating ALL Delhi wards with ACTUAL rainfall & drainage data...');
    
    const allWards = [];
    
    actualWardCoordinates.forEach((coord, index) => {
        try {
            // Get ward ID from the coordinate (you need to add ward_id to actualWardCoordinates)
            // For now, we'll use a simple mapping based on index
            let wardId = "";
            
            // This is a simplified mapping - you may need to adjust based on your actual data structure
            if (index < 8) wardId = `DEL_CANTT_00${index + 1}`;
            else if (index < 17) wardId = `DEL_NDMC_00${index - 7}`;
            else if (index < 290) {
                // For MCD wards, use the ward number from coord.wardNo
                const wardNum = coord.wardNo.toString().padStart(3, '0');
                wardId = `DEL_${wardNum}`;
            }
            
            // Get rainfall data
            const rain = rainfallData[wardId] || { annual_avg: 700, jan_2026: 15 };
            
            // Get drainage data  
            const drain = drainageData[wardId] || { 
                capacity_score: 70, 
                flood_risk: 40, 
                flood_events: 3,
                system_age: 45,
                sewage_coverage: 75
            };
            
            // Calculate risk score based on actual data
            // Lower drainage capacity = higher risk, higher flood risk = higher risk
            const drainageFactor = (100 - drain.capacity_score) / 10; // 0-10 scale
            const floodFactor = drain.flood_risk / 10; // 0-10 scale
            const rainfallFactor = (rain.annual_avg - 600) / 100; // Approx 0-8 scale
            
            let riskScore = (drainageFactor * 0.4 + floodFactor * 0.3 + rainfallFactor * 0.3) * 2;
            riskScore = Math.min(10, Math.max(1, parseFloat(riskScore.toFixed(1))));
            
            let riskLevel = 'low';
            if (riskScore >= 7) riskLevel = 'high';
            else if (riskScore >= 4) riskLevel = 'medium';
            
            // Determine zone
            let zone = 'central';
            const nameLower = coord.wardName.toLowerCase();
            
            if (nameLower.includes('north') || coord.lat > 28.7) zone = 'north';
            else if (nameLower.includes('south') || coord.lat < 28.55) zone = 'south';
            else if (nameLower.includes('east') || coord.lng > 77.25) zone = 'east';
            else if (nameLower.includes('west') || coord.lng < 77.1) zone = 'west';
            else if (nameLower.includes('new') || nameLower.includes('ndmc') || nameLower.includes('cantt')) zone = 'new-delhi';
            
            allWards.push({
                wardNo: coord.wardNo,
                wardName: coord.wardName,
                zone: zone,
                population: Math.floor(Math.random() * 50000) + 30000, // Still need population data
                lat: coord.lat,
                lng: coord.lng,
                avgRainfall: rain.annual_avg,
                drainageScore: parseFloat((drain.capacity_score / 10).toFixed(1)),
                riskLevel: riskLevel,
                riskScore: riskScore,
                historicalIncidents: drain.flood_events,
                lastUpdated: "2024-01-15",
                floodRisk: drain.flood_risk,
                systemAge: drain.system_age,
                sewageCoverage: drain.sewage_coverage
            });
            
        } catch (error) {
            console.error(`Error processing ward ${coord.wardName}:`, error);
        }
    });
    
    console.log(` Generated ${allWards.length} Delhi wards with ACTUAL data`);
    
    // Count risk levels
    const highCount = allWards.filter(w => w.riskLevel === 'high').length;
    const mediumCount = allWards.filter(w => w.riskLevel === 'medium').length;
    const lowCount = allWards.filter(w => w.riskLevel === 'low').length;
    
    console.log(` Risk Distribution - High: ${highCount}, Medium: ${mediumCount}, Low: ${lowCount}`);
    
    return allWards;
}

function showLoadingIndicator() {
    const loadingDiv = document.createElement('div');
    loadingDiv.id = 'app-loading';
    loadingDiv.style.cssText = `
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: white;
        z-index: 9999;
        display: flex;
        align-items: center;
        justify-content: center;
        flex-direction: column;
    `;
    loadingDiv.innerHTML = `
        <div style="text-align: center; padding: 20px;">
            <div style="font-size: 3em; margin-bottom: 20px;"></div>
            <h2 style="color: #1e3a8a; margin-bottom: 10px;">Delhi Water-Logging Risk Management System</h2>
            <p style="color: #64748b; margin-bottom: 20px;">Initializing ML predictions and map data...</p>
            <div style="width: 200px; height: 4px; background: #e2e8f0; border-radius: 2px; overflow: hidden;">
                <div id="loading-progress" style="width: 30%; height: 100%; background: #1e3a8a; transition: width 0.3s;"></div>
            </div>
        </div>
    `;
    document.body.appendChild(loadingDiv);
}

function hideLoadingIndicator() {
    setTimeout(() => {
        const loading = document.getElementById('app-loading');
        if (loading) {
            loading.style.opacity = '0';
            loading.style.transition = 'opacity 0.5s';
            setTimeout(() => {
                if (loading && loading.parentNode) {
                    loading.parentNode.removeChild(loading);
                }
            }, 500);
        }
    }, 500);
}

function waitForLeafletWithTimeout(timeoutMs) {
    return new Promise((resolve, reject) => {
        const startTime = Date.now();
        const checkInterval = setInterval(() => {
            if (typeof L !== 'undefined') {
                clearInterval(checkInterval);
                resolve();
            } else if (Date.now() - startTime > timeoutMs) {
                clearInterval(checkInterval);
                reject(new Error(`Leaflet failed to load after ${timeoutMs}ms`));
            }
        }, 100);
    });
}

function showMapErrorFallback() {
    const mapContainer = document.getElementById('map');
    if (mapContainer) {
        mapContainer.innerHTML = `
            <div style="padding: 40px 20px; text-align: center; background: #f8fafc; color: #64748b;">
                <div style="font-size: 3em; margin-bottom: 20px;"></div>
                <h3 style="color: #475569; margin-bottom: 10px;">Map Unavailable</h3>
                <p style="margin-bottom: 20px;">The interactive map cannot be loaded at this time.</p>
                <p style="font-size: 0.9em; color: #94a3b8;">Ward data is still available in the list below.</p>
            </div>
        `;
    }
}

function showCriticalError(error) {
    const errorDiv = document.createElement('div');
    errorDiv.style.cssText = `
        position: fixed;
        top: 100px;
        left: 50%;
        transform: translateX(-50%);
        background: #fef2f2;
        border: 2px solid #fecaca;
        color: #991b1b;
        padding: 20px;
        border-radius: 8px;
        z-index: 9998;
        max-width: 500px;
        width: 90%;
        text-align: center;
    `;
    errorDiv.innerHTML = `
        <div style="font-size: 2em; margin-bottom: 10px;"></div>
        <h3 style="margin-bottom: 10px;">System Initialization Failed</h3>
        <p style="margin-bottom: 15px; font-size: 0.9em;">The application could not start properly.</p>
        <div style="display: flex; gap: 10px; justify-content: center;">
            <button onclick="location.reload()" style="padding: 8px 16px; background: #dc2626; color: white; border: none; border-radius: 4px; cursor: pointer;">
                Reload Page
            </button>
            <button onclick="this.parentElement.parentElement.style.display='none'" style="padding: 8px 16px; background: #e2e8f0; color: #475569; border: none; border-radius: 4px; cursor: pointer;">
                Continue Anyway
            </button>
        </div>
    `;
    document.body.appendChild(errorDiv);
}

function startAlertInterval() {
    // Clear any existing interval
    if (window.alertInterval) {
        clearInterval(window.alertInterval);
    }
    
    window.alertInterval = setInterval(() => {
        if (Math.random() > 0.7 && allWards && allWards.length > 0) {
            const alerts = ['', '', '', '', ''];
            const messages = [
                `Monitoring ${allWards.length} Delhi wards`,
                `ML model active with ${allWards.filter(w => w.riskLevel === 'high').length} high-risk wards`,
                `System updated: ${new Date().toLocaleTimeString()}`,
                `Real-time data streaming for ${currentFilteredWards.length} filtered wards`,
                `Bayesian Ensemble Model confidence: 92.5%`
            ];
            const randomAlert = alerts[Math.floor(Math.random() * alerts.length)];
            const randomMessage = messages[Math.floor(Math.random() * messages.length)];
            addNewAlert(randomAlert, randomMessage);
        }
    }, 30000);
    
    // Clean up on page unload
    window.addEventListener('beforeunload', () => {
        if (window.alertInterval) {
            clearInterval(window.alertInterval);
        }
    });
}


// Debug functions
// Debug ML Data - Show all data in console
function debugMLData() {
    console.log('===  ML DATA DEBUG ===');
    console.log('Total wards:', allWards.length);
    console.log('High risk wards:', allWards.filter(w => w.riskLevel === 'high').length);
    console.log('Medium risk wards:', allWards.filter(w => w.riskLevel === 'medium').length);
    console.log('Low risk wards:', allWards.filter(w => w.riskLevel === 'low').length);
    
    // Show sample
    console.log('Sample ward:', allWards[0]);
    
    // Show rainfall distribution
    const rainfalls = allWards.map(w => w.avgRainfall);
    console.log('Rainfall range:', Math.min(...rainfalls), 'to', Math.max(...rainfalls), 'mm');
    
    // Show drainage distribution
    const drainages = allWards.map(w => w.drainageScore);
    console.log('Drainage range:', Math.min(...drainages), 'to', Math.max(...drainages), '/10');
    
    // Create popup with summary
    const high = allWards.filter(w => w.riskLevel === 'high').length;
    const medium = allWards.filter(w => w.riskLevel === 'medium').length;
    const low = allWards.filter(w => w.riskLevel === 'low').length;
    
    alert(` ML DATA SUMMARY:
    
Total Wards: ${allWards.length}
 High Risk: ${high} (${((high/allWards.length)*100).toFixed(1)}%)
 Medium Risk: ${medium} (${((medium/allWards.length)*100).toFixed(1)}%)
 Low Risk: ${low} (${((low/allWards.length)*100).toFixed(1)}%)

 Avg Rainfall: ${(allWards.reduce((s,w)=>s+w.avgRainfall,0)/allWards.length).toFixed(1)}mm
 Avg Drainage: ${(allWards.reduce((s,w)=>s+w.drainageScore,0)/allWards.length).toFixed(1)}/10

Check console for detailed data.`);
}

// Verify Map Wards
function verifyAllWardsOnMap() {
    console.log('===  MAP VERIFICATION ===');
    console.log('Wards in data:', allWards.length);
    console.log('Markers on map:', markers.length);
    
    if (allWards.length === markers.length) {
        console.log(' SUCCESS: All wards displayed!');
        
        // Check bounds
        const group = L.featureGroup(markers);
        const bounds = group.getBounds();
        console.log('Map bounds:', bounds.toBBoxString());
        
        alert(` MAP VERIFICATION PASSED!
        
Wards in system: ${allWards.length}
Markers on map: ${markers.length}
All wards are correctly displayed!`);
    } else {
        console.warn(' Mismatch!');
        const missing = allWards.length - markers.length;
        alert(` MAP VERIFICATION FAILED!
        
Wards in system: ${allWards.length}
Markers on map: ${markers.length}
Missing: ${missing} wards

Run fixMapNow() to fix.`);
    }
}

// Count Markers - Shows total markers on map
function countMarkers() {
    // Check if map and markers exist
    if (!map || !markers) {
        console.warn(' Map not initialized or no markers');
        alert('Map not ready yet!');
        return 0;
    }
    
    const count = markers.length;
    console.log(` Total markers on map: ${count}`);
    console.log(` Total wards in system: ${allWards.length}`);
    
    // Show detailed status
    if (count === allWards.length) {
        alert(` MAP STATUS: PERFECT!
        
 Markers on map: ${count}
 Wards in system: ${allWards.length}
 All wards are displayed correctly!`);
    } else {
        const missing = allWards.length - count;
        alert(` MAP STATUS: MISMATCH!
        
 Markers on map: ${count}
 Wards in system: ${allWards.length}
 Missing: ${missing} wards

Run fixMapNow() to fix.`);
    }
    
    return count;
}

// Show All Wards in List - Debug function
function showAllWards() {
    console.log('===  WARD LIST DEBUG ===');
    
    const wardList = document.getElementById('wardList');
    if (!wardList) {
        console.error('Ward list element not found');
        alert(' Ward list element not found!');
        return;
    }
    
    const itemCount = wardList.children.length;
    console.log(`Total wards in list: ${itemCount}`);
    console.log(`Total wards in data: ${allWards.length}`);
    
    if (itemCount === 0) {
        alert(' Ward list is empty! Check console for errors.\n\nPossible reasons:\n1. Data not loaded\n2. Rendering issue\n3. allWards array is empty');
        
        // Debug info
        console.log('allWards length:', allWards?.length || 0);
        console.log('First 3 wards:', allWards?.slice(0, 3) || 'none');
        
    } else {
        const high = allWards.filter(w => w.riskLevel === 'high').length;
        const medium = allWards.filter(w => w.riskLevel === 'medium').length;
        const low = allWards.filter(w => w.riskLevel === 'low').length;
        
        alert(` WARD LIST STATUS:
        
 Items in list: ${itemCount}
 Wards in system: ${allWards.length}

 Risk Distribution:
 High Risk: ${high}
 Medium Risk: ${medium}
 Low Risk: ${low}

 First 3 wards shown in console.`);
        
        // Show first 3 wards in console
        console.log('First 3 wards in list:', 
            Array.from(wardList.children).slice(0, 3).map(el => 
                el.querySelector('.ward-name')?.textContent || 'unknown'
            )
        );
    }
}

// ===== PDF EXPORT FUNCTIONS =====
// Add these after countMarkers() function

// Export as PDF - FIXED VERSION
function exportAsPDF() {
    alert(' Generating PDF report...');
    
    try {
        const { jsPDF } = window.jspdf;
        const pdf = new jsPDF({
            orientation: 'p',
            unit: 'mm',
            format: 'a4',
            putOnlyUsedFonts: true,
            hotfix: true  // Important fix for encoding issues
        });
        
        // Set font to helvetica (supports all characters)
        pdf.setFont('helvetica');
        
        let yPos = 20;
        
        // Title
        pdf.setFontSize(20);
        pdf.setTextColor(30, 58, 138);
        pdf.text('Delhi Water-Logging Risk Report', 20, yPos);
        
        yPos += 10;
        pdf.setFontSize(10);
        pdf.setTextColor(100, 116, 139);
        pdf.text('Generated: ' + new Date().toLocaleString(), 20, yPos);
        
        yPos += 10;
        pdf.setLineWidth(0.5);
        pdf.line(20, yPos, 190, yPos);
        yPos += 10;
        
        // Stats
        const high = allWards.filter(w => w.riskLevel === 'high').length;
        const medium = allWards.filter(w => w.riskLevel === 'medium').length;
        const low = allWards.filter(w => w.riskLevel === 'low').length;
        const total = allWards.length;
        
        pdf.setFontSize(14);
        pdf.setTextColor(0, 0, 0);
        pdf.text('Risk Summary', 20, yPos);
        yPos += 8;
        
        pdf.setFontSize(11);
        pdf.setTextColor(220, 38, 38);
        pdf.text('High Risk Wards: ' + high + ' (' + ((high/total)*100).toFixed(1) + '%)', 25, yPos);
        yPos += 7;
        pdf.setTextColor(245, 158, 11);
        pdf.text('Medium Risk Wards: ' + medium + ' (' + ((medium/total)*100).toFixed(1) + '%)', 25, yPos);
        yPos += 7;
        pdf.setTextColor(16, 185, 129);
        pdf.text('Low Risk Wards: ' + low + ' (' + ((low/total)*100).toFixed(1) + '%)', 25, yPos);
        
        yPos += 10;
        pdf.setTextColor(0, 0, 0);
        pdf.setLineWidth(0.5);
        pdf.line(20, yPos, 190, yPos);
        yPos += 10;
        
        // Rainfall Stats - using simple string concatenation
        const avgRainfall = (allWards.reduce((s, w) => s + w.avgRainfall, 0) / total).toFixed(1);
        const maxRainfall = Math.max(...allWards.map(w => w.avgRainfall));
        const minRainfall = Math.min(...allWards.map(w => w.avgRainfall));
        
        pdf.setFontSize(14);
        pdf.setTextColor(0, 0, 0);
        pdf.text('Rainfall Statistics', 20, yPos);
        yPos += 8;
        
        pdf.setFontSize(11);
        pdf.text('Average Annual Rainfall: ' + avgRainfall + ' mm', 25, yPos);
        yPos += 7;
        pdf.text('Maximum Rainfall: ' + maxRainfall + ' mm', 25, yPos);
        yPos += 7;
        pdf.text('Minimum Rainfall: ' + minRainfall + ' mm', 25, yPos);
        
        yPos += 10;
        pdf.line(20, yPos, 190, yPos);
        yPos += 10;
        
        // Drainage Stats
        const avgDrainage = (allWards.reduce((s, w) => s + w.drainageScore, 0) / total).toFixed(1);
        const poorDrainage = allWards.filter(w => w.drainageScore < 4).length;
        
        pdf.setFontSize(14);
        pdf.text('Drainage Infrastructure', 20, yPos);
        yPos += 8;
        
        pdf.setFontSize(11);
        pdf.text('Average Drainage Score: ' + avgDrainage + '/10', 25, yPos);
        yPos += 7;
        pdf.text('Wards with Poor Drainage (<4): ' + poorDrainage, 25, yPos);
        
        yPos += 10;
        pdf.line(20, yPos, 190, yPos);
        yPos += 10;
        
        // Top 10 High Risk Wards
        pdf.setFontSize(14);
        pdf.text('Top 10 High-Risk Wards', 20, yPos);
        yPos += 8;
        
        pdf.setFontSize(10);
        const topWards = [...allWards]
            .filter(w => w.riskLevel === 'high')
            .sort((a, b) => b.riskScore - a.riskScore)
            .slice(0, 10);
        
        topWards.forEach((ward, i) => {
            if (yPos > 270) {
                pdf.addPage();
                yPos = 20;
            }
            // Remove emojis and special characters
            const cleanName = ward.wardName.replace(/[^\x00-\x7F]/g, '');
            pdf.text((i+1) + '. ' + cleanName + ' - Risk: ' + ward.riskScore.toFixed(1) + '/10', 25, yPos);
            yPos += 6;
        });
        
        // Add footer with page number
        const pageCount = pdf.internal.getNumberOfPages();
        for (let i = 1; i <= pageCount; i++) {
            pdf.setPage(i);
            pdf.setFontSize(8);
            pdf.setTextColor(150, 150, 150);
            pdf.text('Page ' + i + ' of ' + pageCount, 170, 290);
        }
        
        // Save PDF with simple filename
        const dateStr = new Date().toISOString().split('T')[0];
        pdf.save('Delhi_Water_Report_' + dateStr + '.pdf');
        
        addNewAlert('', 'PDF report generated successfully', 'positive');
        
    } catch (error) {
        console.error('PDF Generation Error:', error);
        alert(' PDF generation failed. Please try again.\n\nError: ' + error.message);
    }
}

// Export Map as Image
function exportMapAsImage() {
    alert(' Capturing map...');
    
    const mapContainer = document.getElementById('map');
    
    html2canvas(mapContainer, {
        scale: 2,
        backgroundColor: '#ffffff'
    }).then(canvas => {
        // Create download link
        const link = document.createElement('a');
        link.download = `Delhi_Risk_Map_${new Date().toISOString().split('T')[0]}.png`;
        link.href = canvas.toDataURL('image/png');
        link.click();
        
        addNewAlert('', 'Map image exported successfully', 'positive');
    }).catch(error => {
        console.error('Error capturing map:', error);
        alert(' Failed to capture map. Please try again.');
    });
}

// Export as CSV
function exportAsCSV() {
    // Create CSV content
    let csv = 'Ward No,Ward Name,Zone,Risk Level,Risk Score,Rainfall (mm),Drainage Score,Population,Historical Incidents\n';
    
    allWards.forEach(w => {
        csv += `${w.wardNo},${w.wardName},${w.zone},${w.riskLevel},${w.riskScore},${w.avgRainfall},${w.drainageScore},${w.population},${w.historicalIncidents}\n`;
    });
    
    // Download CSV
    const blob = new Blob([csv], { type: 'text/csv' });
    const url = window.URL.createObjectURL(blob);
    const link = document.createElement('a');
    link.href = url;
    link.download = `Delhi_Wards_Data_${new Date().toISOString().split('T')[0]}.csv`;
    link.click();
    
    window.URL.revokeObjectURL(url);
    addNewAlert('', 'CSV data exported successfully', 'positive');
}

// Export as GeoJSON
function exportAsGeoJSON() {
    const features = allWards.map(ward => ({
        type: 'Feature',
        geometry: {
            type: 'Point',
            coordinates: [ward.lng, ward.lat]
        },
        properties: {
            wardNo: ward.wardNo,
            wardName: ward.wardName,
            zone: ward.zone,
            riskLevel: ward.riskLevel,
            riskScore: ward.riskScore,
            rainfall: ward.avgRainfall,
            drainage: ward.drainageScore,
            population: ward.population
        }
    }));
    
    const geojson = {
        type: 'FeatureCollection',
        features: features
    };
    
    const blob = new Blob([JSON.stringify(geojson, null, 2)], { type: 'application/json' });
    const url = window.URL.createObjectURL(blob);
    const link = document.createElement('a');
    link.href = url;
    link.download = `Delhi_Wards_GeoJSON_${new Date().toISOString().split('T')[0]}.json`;
    link.click();
    
    window.URL.revokeObjectURL(url);
    addNewAlert('', 'GeoJSON exported successfully', 'positive');
}


// ===== 1. ALERT TOGGLE FUNCTION =====
function toggleAlertsVisibility() {
    const alertsPanel = document.getElementById('alerts-panel');
    const toggleBtn = document.getElementById('alert-toggle');
    
    if (!alertsPanel || !toggleBtn) return;
    
    if (alertsPanel.classList.contains('hidden')) {
        alertsPanel.classList.remove('hidden');
        toggleBtn.textContent = 'Hide Alerts';
        toggleBtn.style.background = '#1e3a8a';
    } else {
        alertsPanel.classList.add('hidden');
        toggleBtn.textContent = 'Show Alerts';
        toggleBtn.style.background = '#4b5563';
    }
}

// Initialize alert toggle on page load
function initAlertToggle() {
    const toggleBtn = document.getElementById('alert-toggle');
    if (toggleBtn) {
        // Remove existing listeners
        const newBtn = toggleBtn.cloneNode(true);
        toggleBtn.parentNode.replaceChild(newBtn, toggleBtn);
        
        // Add fresh listener
        document.getElementById('alert-toggle').addEventListener('click', toggleAlertsVisibility);
    }
}

// ===== 2. THEME TOGGLE FUNCTIONS =====
function toggleTheme() {
    const currentTheme = document.documentElement.getAttribute('data-theme') || 'light';
    const themeToggleBtn = document.getElementById('theme-toggle');
    
    if (currentTheme === 'dark') {
        // Switch to light theme
        document.documentElement.setAttribute('data-theme', 'light');
        localStorage.setItem('theme', 'light');
        themeToggleBtn.innerHTML = '<i class="fas fa-moon"></i> Theme';
        themeToggleBtn.title = 'Switch to dark theme';
    } else {
        // Switch to dark theme
        document.documentElement.setAttribute('data-theme', 'dark');
        localStorage.setItem('theme', 'dark');
        themeToggleBtn.innerHTML = '<i class="fas fa-sun"></i> Theme';
        themeToggleBtn.title = 'Switch to light theme';
    }
    
    // Force text color refresh
    document.body.style.color = 'var(--text-primary)';
    
    // Update map if it exists
    if (map && typeof map.invalidateSize === 'function') {
        setTimeout(() => { map.invalidateSize(); }, 100);
    }
}

function initTheme() {
    // Get saved theme or default to dark
    const savedTheme = localStorage.getItem('theme') || 'dark';
    document.documentElement.setAttribute('data-theme', savedTheme);
    
    // Update theme toggle button
    const themeToggleBtn = document.getElementById('theme-toggle');
    if (themeToggleBtn) {
        if (savedTheme === 'dark') {
            themeToggleBtn.innerHTML = '<i class="fas fa-sun"></i> Theme';
            themeToggleBtn.title = 'Switch to light theme';
        } else {
            themeToggleBtn.innerHTML = '<i class="fas fa-moon"></i> Theme';
            themeToggleBtn.title = 'Switch to dark theme';
        }
        
        // Remove existing listeners and add new one
        themeToggleBtn.replaceWith(themeToggleBtn.cloneNode(true));
        document.getElementById('theme-toggle').addEventListener('click', toggleTheme);
    }
}

// ===== 3. DEBUG PREDICTIONS FUNCTION =====
function debugPredictions() {
    console.log('=== DEBUG PREDICTIONS ===');
    console.log('Total wards:', allWards ? allWards.length : 0);
    
    if (allWards && allWards.length > 0) {
        // Show first 3 wards
        console.log('First 3 wards:', allWards.slice(0, 3));
        
        // Show risk distribution
        const high = allWards.filter(w => w.riskLevel === 'high').length;
        const medium = allWards.filter(w => w.riskLevel === 'medium').length;
        const low = allWards.filter(w => w.riskLevel === 'low').length;
        const total = allWards.length;
        
        console.log('Risk Distribution:');
        console.log('High:', high, `(${((high/total)*100).toFixed(1)}%)`);
        console.log('Medium:', medium, `(${((medium/total)*100).toFixed(1)}%)`);
        console.log('Low:', low, `(${((low/total)*100).toFixed(1)}%)`);
        
        // Show average risk score
        const avgRisk = allWards.reduce((sum, w) => sum + w.riskScore, 0) / total;
        console.log('Average Risk Score:', avgRisk.toFixed(2), '/10');
        
        // Show zones distribution
        const zones = {};
        allWards.forEach(w => {
            zones[w.zone] = (zones[w.zone] || 0) + 1;
        });
        console.log('Zone Distribution:', zones);
        
        alert(` ML Predictions Debug:\n\n Total Wards: ${total}\n High Risk: ${high} (${((high/total)*100).toFixed(1)}%)\n Medium Risk: ${medium} (${((medium/total)*100).toFixed(1)}%)\n Low Risk: ${low} (${((low/total)*100).toFixed(1)}%)\n Average Risk Score: ${avgRisk.toFixed(2)}/10\n\nCheck console for detailed data.`);
    } else {
        alert(' No prediction data available!\n\nCheck if predictions.json is loaded.');
    }
}

// ===== 4. INITIALIZE ALL NEW FEATURES =====
function initNewFeatures() {
    // Initialize theme
    initTheme();
    
    // Setup alert toggle button
    const alertToggleBtn = document.getElementById('alert-toggle');
    if (alertToggleBtn) {
        alertToggleBtn.addEventListener('click', toggleAlertsVisibility);
        alertToggleBtn.title = 'Click to hide/show active alerts';
    }
    
    console.log(' New features initialized: Theme toggle, Alert toggle, Developer mode');
}

// Ensure closeViewModal is globally available
window.closeViewModal = closeViewModal;
window.closeEditModal = closeEditModal;
window.updateComplaint = updateComplaint;


// ULTIMATE MAP FIX - Run this in console
window.fixMapNow = function() {
    console.log(' FORCING MAP FIX...');
    
    // Regenerate wards
    allWards = generateAllWardsFromCoordinates();
    console.log(` Generated ${allWards.length} wards`);
    
    // Update UI
    updateStats(allWards);
    updateWardList(allWards);
    
    // Clear and recreate map
    if (map) map.remove();
    
    const mapContainer = document.getElementById('map');
    mapContainer.innerHTML = '';
    mapContainer.style.height = '500px';
    
    map = L.map('map').setView([28.6139, 77.2090], 11);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);
    mapInitialized = true;
    
    // Add markers
    markers = [];
    allWards.forEach(ward => {
        try {
            const color = getRiskColor(ward.riskLevel);
            const icon = L.divIcon({
                className: 'custom-marker',
                html: `<div style="background-color: ${color}; width: 24px; height: 24px; border-radius: 50%; border: 2px solid white;">${ward.wardNo}</div>`,
                iconSize: [24, 24]
            });
            const marker = L.marker([ward.lat, ward.lng], { icon }).addTo(map);
            marker.bindPopup(`<b>${ward.wardName}</b><br>Risk: ${ward.riskLevel}`);
            markers.push(marker);
        } catch(e) {}
    });
    
    console.log(` Added ${markers.length} markers`);
    
    // Fit bounds
    if (markers.length > 0) {
        const group = L.featureGroup(markers);
        map.fitBounds(group.getBounds().pad(0.1));
    }
    
    alert(` Map fixed! Showing ${markers.length} wards`);
};
  </script>
</body> 
</html>


